!function($){function Inputmask(e,t){return this instanceof Inputmask?("object"==typeof e?t=e:(t=t||{},t.alias=e),this.el=void 0,this.opts=$.extend(!0,{},this.defaults,t),this.noMasksCache=t&&void 0!==t.definitions,this.userOptions=t||{},void resolveAlias(this.opts.alias,t,this.opts)):new Inputmask(e,t)}function isInputEventSupported(e){var t=document.createElement("input"),i="on"+e,r=i in t;return r||(t.setAttribute(i,"return;"),r="function"==typeof t[i]),t=null,r}function isInputTypeSupported(e){var t="text"===e||"tel"===e||"password"===e;if(!t){var i=document.createElement("input");i.setAttribute("type",e),t="text"===i.type,i=null}return t}function resolveAlias(e,t,i){var r=i.aliases[e];return r?(r.alias&&resolveAlias(r.alias,void 0,i),$.extend(!0,i,r),$.extend(!0,i,t),!0):(null===i.mask&&(i.mask=e),!1)}function importAttributeOptions(npt,opts,userOptions){function importOption(option,optionData){optionData=void 0!==optionData?optionData:npt.getAttribute("data-inputmask-"+option),null!==optionData&&("string"!=typeof optionData||0!==option.indexOf("on")&&"false"!==optionData&&"true"!==optionData||(optionData=eval("("+optionData+")")),"mask"===option&&0===optionData.indexOf("[")?(userOptions[option]=optionData.replace(/[\s[\]]/g,"").split(","),userOptions[option][0]=userOptions[option][0].replace("'",""),userOptions[option][userOptions[option].length-1]=userOptions[option][userOptions[option].length-1].replace("'","")):userOptions[option]=optionData)}var attrOptions=npt.getAttribute("data-inputmask"),option,dataoptions,optionData;if(attrOptions&&""!==attrOptions)try{attrOptions=attrOptions.replace(new RegExp("'","g"),'"'),dataoptions=$.parseJSON("{"+attrOptions+"}")}catch(ex){}for(option in opts){if(dataoptions){optionData=void 0;for(var p in dataoptions)if(p.toLowerCase()===option.toLowerCase()){optionData=dataoptions[p];break}}importOption(option,optionData)}if(userOptions.alias){resolveAlias(userOptions.alias,userOptions,opts);for(option in opts)importOption(option)}return $.extend(!0,opts,userOptions),opts}function generateMaskSet(e,t){function i(t){function i(e,t,i,r){this.matches=[],this.isGroup=e||!1,this.isOptional=t||!1,this.isQuantifier=i||!1,this.isAlternator=r||!1,this.quantifier={min:1,max:1}}function r(t,i,r){var s=e.definitions[i];r=void 0!==r?r:t.matches.length;var a=t.matches[r-1];if(s&&!g){s.placeholder=$.isFunction(s.placeholder)?s.placeholder(e):s.placeholder;for(var n=s.prevalidator,o=n?n.length:0,l=1;l<s.cardinality;l++){var c=o>=l?n[l-1]:[],d=c.validator,h=c.cardinality;t.matches.splice(r++,0,{fn:d?"string"==typeof d?new RegExp(d):new function(){this.test=d}:new RegExp("."),cardinality:h?h:1,optionality:t.isOptional,newBlockMarker:void 0===a||a.def!==(s.definitionSymbol||i),casing:s.casing,def:s.definitionSymbol||i,placeholder:s.placeholder,mask:i}),a=t.matches[r-1]}t.matches.splice(r++,0,{fn:s.validator?"string"==typeof s.validator?new RegExp(s.validator):new function(){this.test=s.validator}:new RegExp("."),cardinality:s.cardinality,optionality:t.isOptional,newBlockMarker:void 0===a||a.def!==(s.definitionSymbol||i),casing:s.casing,def:s.definitionSymbol||i,placeholder:s.placeholder,mask:i})}else t.matches.splice(r++,0,{fn:null,cardinality:0,optionality:t.isOptional,newBlockMarker:void 0===a||a.def!==i,casing:null,def:i,placeholder:void 0,mask:i}),g=!1}function s(t,i){t.isGroup&&(t.isGroup=!1,r(t,e.groupmarker.start,0),i!==!0&&r(t,e.groupmarker.end))}function a(e,t,i,a){t.matches.length>0&&(void 0===a||a)&&(i=t.matches[t.matches.length-1],s(i)),r(t,e)}function n(){if(b.length>0){if(h=b[b.length-1],a(c,h,p,!h.isAlternator),h.isAlternator){u=b.pop();for(var e=0;e<u.matches.length;e++)u.matches[e].isGroup=!1;b.length>0?(h=b[b.length-1],h.matches.push(u)):v.matches.push(u)}}else a(c,v,p)}function o(t){function i(t){return t===e.optionalmarker.start?t=e.optionalmarker.end:t===e.optionalmarker.end?t=e.optionalmarker.start:t===e.groupmarker.start?t=e.groupmarker.end:t===e.groupmarker.end&&(t=e.groupmarker.start),t}t.matches=t.matches.reverse();for(var r in t.matches){var s=parseInt(r);if(t.matches[r].isQuantifier&&t.matches[s+1]&&t.matches[s+1].isGroup){var a=t.matches[r];t.matches.splice(r,1),t.matches.splice(s+1,0,a)}void 0!==t.matches[r].matches?t.matches[r]=o(t.matches[r]):t.matches[r]=i(t.matches[r])}return t}for(var l,c,d,h,u,p,f,m=/(?:[?*+]|\{[0-9\+\*]+(?:,[0-9\+\*]*)?\})|[^.?*+^${[]()|\\]+|./g,g=!1,v=new i,b=[],k=[];l=m.exec(t);)if(c=l[0],g)n();else switch(c.charAt(0)){case e.escapeChar:g=!0;break;case e.optionalmarker.end:case e.groupmarker.end:if(d=b.pop(),void 0!==d)if(b.length>0){if(h=b[b.length-1],h.matches.push(d),h.isAlternator){u=b.pop();for(var y=0;y<u.matches.length;y++)u.matches[y].isGroup=!1;b.length>0?(h=b[b.length-1],h.matches.push(u)):v.matches.push(u)}}else v.matches.push(d);else n();break;case e.optionalmarker.start:b.push(new i(!1,!0));break;case e.groupmarker.start:b.push(new i(!0));break;case e.quantifiermarker.start:var x=new i(!1,!1,!0);c=c.replace(/[{}]/g,"");var w=c.split(","),C=isNaN(w[0])?w[0]:parseInt(w[0]),T=1===w.length?C:isNaN(w[1])?w[1]:parseInt(w[1]);if(("*"===T||"+"===T)&&(C="*"===T?0:1),x.quantifier={min:C,max:T},b.length>0){var E=b[b.length-1].matches;l=E.pop(),l.isGroup||(f=new i(!0),f.matches.push(l),l=f),E.push(l),E.push(x)}else l=v.matches.pop(),l.isGroup||(f=new i(!0),f.matches.push(l),l=f),v.matches.push(l),v.matches.push(x);break;case e.alternatormarker:b.length>0?(h=b[b.length-1],p=h.matches.pop()):p=v.matches.pop(),p.isAlternator?b.push(p):(u=new i(!1,!1,!1,!0),u.matches.push(p),b.push(u));break;default:n()}for(;b.length>0;)d=b.pop(),s(d,!0),v.matches.push(d);return v.matches.length>0&&(p=v.matches[v.matches.length-1],s(p),k.push(v)),e.numericInput&&o(k[0]),k}function r(r,s){if(null===r||""===r)return void 0;if(1===r.length&&e.greedy===!1&&0!==e.repeat&&(e.placeholder=""),e.repeat>0||"*"===e.repeat||"+"===e.repeat){var a="*"===e.repeat?0:"+"===e.repeat?1:e.repeat;r=e.groupmarker.start+r+e.groupmarker.end+e.quantifiermarker.start+a+","+e.repeat+e.quantifiermarker.end}var n;return void 0===Inputmask.prototype.masksCache[r]||t===!0?(n={mask:r,maskToken:i(r),validPositions:{},_buffer:void 0,buffer:void 0,tests:{},metadata:s},t!==!0&&(Inputmask.prototype.masksCache[e.numericInput?r.split("").reverse().join(""):r]=n)):n=$.extend(!0,{},Inputmask.prototype.masksCache[r]),n}function s(e){return e=e.toString()}var a;if($.isFunction(e.mask)&&(e.mask=e.mask(e)),$.isArray(e.mask)){if(e.mask.length>1){e.keepStatic=null===e.keepStatic?!0:e.keepStatic;var n="(";return $.each(e.numericInput?e.mask.reverse():e.mask,function(e,t){n.length>1&&(n+=")|("),n+=s(void 0===t.mask||$.isFunction(t.mask)?t:t.mask)}),n+=")",r(n,e.mask)}e.mask=e.mask.pop()}return e.mask&&(a=void 0===e.mask.mask||$.isFunction(e.mask.mask)?r(s(e.mask),e.mask):r(s(e.mask.mask),e.mask)),a}function maskScope(e,t,i){function r(e,t,i){t=t||0;var r,a,n,o=[],l=0;do{if(e===!0&&s().validPositions[l]){var d=s().validPositions[l];a=d.match,r=d.locator.slice(),o.push(i===!0?d.input:E(l,a))}else n=c(l,r,l-1),a=n.match,r=n.locator.slice(),o.push(E(l,a));l++}while((void 0===se||se>l-1)&&null!==a.fn||null===a.fn&&""!==a.def||t>=l);return o.pop(),o}function s(){return t}function a(e){var t=s();t.buffer=void 0,t.tests={},e!==!0&&(t._buffer=void 0,t.validPositions={},t.p=0)}function n(e,t){var i=s(),r=-1,a=i.validPositions;void 0===e&&(e=-1);var n=r,o=r;for(var l in a){var c=parseInt(l);a[c]&&(t||null!==a[c].match.fn)&&(e>=c&&(n=c),c>=e&&(o=c))}return r=-1!==n&&e-n>1||e>o?n:o}function o(e,t,r){if(i.insertMode&&void 0!==s().validPositions[e]&&void 0===r){var a,o=$.extend(!0,{},s().validPositions),l=n();for(a=e;l>=a;a++)delete s().validPositions[a];s().validPositions[e]=t;var c,d=!0,p=s().validPositions;for(a=c=e;l>=a;a++){var f=o[a];if(void 0!==f)for(var m=c,g=-1;m<y()&&(null==f.match.fn&&p[a]&&(p[a].match.optionalQuantifier===!0||p[a].match.optionality===!0)||null!=f.match.fn);){if(null===f.match.fn||!i.keepStatic&&p[a]&&(void 0!==p[a+1]&&u(a+1,p[a].locator.slice(),a).length>1||void 0!==p[a].alternation)?m++:m=x(c),h(m,f.match.def)){d=b(m,f.input,!0,!0)!==!1,c=m;break}if(d=null==f.match.fn,g===m)break;g=m}if(!d)break}if(!d)return s().validPositions=$.extend(!0,{},o),!1}else s().validPositions[e]=t;return!0}function l(e,t,r,o){var l,c=e;for(s().p=e,l=c;t>l;l++)void 0!==s().validPositions[l]&&(r===!0||i.canClearPosition(s(),l,n(),o,i)!==!1)&&delete s().validPositions[l];for(a(!0),l=c+1;l<=n();){for(;void 0!==s().validPositions[c];)c++;var d=s().validPositions[c];c>l&&(l=c+1);var u=s().validPositions[l];void 0!==u&&k(l)&&void 0===d?(h(c,u.match.def)&&b(c,u.input,!0)!==!1&&(delete s().validPositions[l],l++),c++):l++}var p=n(),f=y();for(o!==!0&&r!==!0&&void 0!==s().validPositions[p]&&s().validPositions[p].input===i.radixPoint&&delete s().validPositions[p],l=p+1;f>=l;l++)s().validPositions[l]&&delete s().validPositions[l];a(!0)}function c(e,t,r){var a=s().validPositions[e];if(void 0===a)for(var o=u(e,t,r),l=n(),c=s().validPositions[l]||u(0)[0],d=void 0!==c.alternation?c.locator[c.alternation].toString().split(","):[],h=0;h<o.length&&(a=o[h],!(a.match&&(i.greedy&&a.match.optionalQuantifier!==!0||(a.match.optionality===!1||a.match.newBlockMarker===!1)&&a.match.optionalQuantifier!==!0)&&(void 0===c.alternation||c.alternation!==a.alternation||void 0!==a.locator[c.alternation]&&v(a.locator[c.alternation].toString().split(","),d))));h++);return a}function d(e){return s().validPositions[e]?s().validPositions[e].match:u(e)[0].match}function h(e,t){for(var i=!1,r=u(e),s=0;s<r.length;s++)if(r[s].match&&r[s].match.def===t){i=!0;break}return i}function u(e,t,i,r){function a(t,i,r,l){function d(r,l,p){if(c>1e4)throw"Inputmask: There is probably an error in your mask definition or in the code. Create an issue on github with an example of the mask you are using. "+s().mask;if(c===e&&void 0===r.matches)return h.push({match:r,locator:l.reverse()}),!0;if(void 0!==r.matches){if(r.isGroup&&p!==r){if(r=d(t.matches[$.inArray(r,t.matches)+1],l))return!0}else if(r.isOptional){var f=r;if(r=a(r,i,l,p)){if(n=h[h.length-1].match,o=0===$.inArray(n,f.matches),!o)return!0;u=!0,c=e}}else if(r.isAlternator){var m,g=r,v=[],b=h.slice(),k=l.length,y=i.length>0?i.shift():-1;if(-1===y||"string"==typeof y){var x=c,w=i.slice(),C=[];"string"==typeof y&&(C=y.split(","));for(var T=0;T<g.matches.length;T++){if(h=[],r=d(g.matches[T],[T].concat(l),p)||r,r!==!0&&void 0!==r&&C[C.length-1]<g.matches.length){var E=t.matches.indexOf(r)+1;t.matches.length>E&&(r=d(t.matches[E],[E].concat(l.slice(1,l.length)),p),r&&(C.push(E.toString()),$.each(h,function(e,t){t.alternation=l.length-1})))}m=h.slice(),c=x,h=[];for(var A=0;A<w.length;A++)i[A]=w[A];for(var S=0;S<m.length;S++){var P=m[S];P.alternation=P.alternation||k;for(var R=0;R<v.length;R++){var O=v[R];if(P.match.mask===O.match.mask&&("string"!=typeof y||-1!==$.inArray(P.locator[P.alternation].toString(),C))){m.splice(S,1),S--,O.locator[P.alternation]=O.locator[P.alternation]+","+P.locator[P.alternation],O.alternation=P.alternation;break}}}v=v.concat(m)}"string"==typeof y&&(v=$.map(v,function(e,t){if(isFinite(t)){var i,r=e.alternation,s=e.locator[r].toString().split(",");e.locator[r]=void 0,e.alternation=void 0;for(var a=0;a<s.length;a++)i=-1!==$.inArray(s[a],C),i&&(void 0!==e.locator[r]?(e.locator[r]+=",",e.locator[r]+=s[a]):e.locator[r]=parseInt(s[a]),e.alternation=r);if(void 0!==e.locator[r])return e}})),h=b.concat(v),c=e,u=h.length>0}else r=g.matches[y]?d(g.matches[y],[y].concat(l),p):!1;if(r)return!0}else if(r.isQuantifier&&p!==t.matches[$.inArray(r,t.matches)-1])for(var I=r,B=i.length>0?i.shift():0;B<(isNaN(I.quantifier.max)?B+1:I.quantifier.max)&&e>=c;B++){var D=t.matches[$.inArray(I,t.matches)-1];if(r=d(D,[B].concat(l),D)){if(n=h[h.length-1].match,n.optionalQuantifier=B>I.quantifier.min-1,o=0===$.inArray(n,D.matches)){if(B>I.quantifier.min-1){u=!0,c=e;break}return!0}return!0}}else if(r=a(r,i,l,p))return!0}else c++}for(var p=i.length>0?i.shift():0;p<t.matches.length;p++)if(t.matches[p].isQuantifier!==!0){var f=d(t.matches[p],[p].concat(r),l);if(f&&c===e)return f;if(c>e)break}}var n,o,l=s().maskToken,c=t?i:0,d=t||[0],h=[],u=!1;if(r===!0&&s().tests[e])return s().tests[e];if(void 0===t){for(var p,f=e-1;void 0===(p=s().validPositions[f])&&f>-1&&(!s().tests[f]||void 0===(p=s().tests[f][0]));)f--;void 0!==p&&f>-1&&(c=f,d=p.locator.slice())}for(var m=d.shift();m<l.length;m++){var g=a(l[m],d,[m]);if(g&&c===e||c>e)break}return(0===h.length||u)&&h.push({match:{fn:null,cardinality:0,optionality:!0,casing:null,def:""},locator:[]}),s().tests[e]=$.extend(!0,[],h),s().tests[e]}function p(){return void 0===s()._buffer&&(s()._buffer=r(!1,1)),s()._buffer}function f(){return void 0===s().buffer&&(s().buffer=r(!0,n(),!0)),s().buffer}function m(e,t,r){var n;if(r=r||f().slice(),e===!0)a(),e=0,t=r.length;else for(n=e;t>n;n++)delete s().validPositions[n],delete s().tests[n];for(n=e;t>n;n++)a(!0),r[n]!==i.skipOptionalPartCharacter&&b(n,r[n],!0,!0)}function g(e,t){switch(t.casing){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e}function v(e,t){for(var r=i.greedy?t:t.slice(0,1),s=!1,a=0;a<e.length;a++)if(-1!==$.inArray(e[a],r)){s=!0;break}return s}function b(e,t,r,d){function h(e,t,r,c){var d=!1;return $.each(u(e),function(h,u){for(var p=u.match,v=t?1:0,k="",y=p.cardinality;y>v;y--)k+=C(e-(y-1));if(t&&(k+=t),d=null!=p.fn?p.fn.test(k,s(),e,r,i):t!==p.def&&t!==i.skipOptionalPartCharacter||""===p.def?!1:{c:p.def,pos:e},d!==!1){var x=void 0!==d.c?d.c:t;x=x===i.skipOptionalPartCharacter&&null===p.fn?p.def:x;var w=e,T=f();if(void 0!==d.remove&&($.isArray(d.remove)||(d.remove=[d.remove]),$.each(d.remove.sort(function(e,t){return t-e}),function(e,t){l(t,t+1,!0)})),void 0!==d.insert&&($.isArray(d.insert)||(d.insert=[d.insert]),$.each(d.insert.sort(function(e,t){return e-t}),function(e,t){b(t.pos,t.c,!0)})),d.refreshFromBuffer){var E=d.refreshFromBuffer;if(r=!0,m(E===!0?E:E.start,E.end,T),void 0===d.pos&&void 0===d.c)return d.pos=n(),!1;if(w=void 0!==d.pos?d.pos:e,w!==e)return d=$.extend(d,b(w,x,!0)),!1}else if(d!==!0&&void 0!==d.pos&&d.pos!==e&&(w=d.pos,m(e,w),w!==e))return d=$.extend(d,b(w,x,!0)),!1;return d!==!0&&void 0===d.pos&&void 0===d.c?!1:(h>0&&a(!0),o(w,$.extend({},u,{input:g(x,p)}),c)||(d=!1),!1)}}),d}function p(e,t,r,o){for(var l,d,h,u,p,f,m=$.extend(!0,{},s().validPositions),g=n();g>=0&&(u=s().validPositions[g],!u||void 0===u.alternation||(l=g,d=s().validPositions[l].alternation,c(l).locator[u.alternation]===u.locator[u.alternation]));g--);if(void 0!==d){l=parseInt(l);for(var v in s().validPositions)if(v=parseInt(v),u=s().validPositions[v],v>=l&&void 0!==u.alternation){var k=s().validPositions[l].locator[d].toString().split(","),y=u.locator[d]||k[0];y.length>0&&(y=y.split(",")[0]);for(var x=0;x<k.length;x++)if(y<k[x]){for(var w,C,T=v;T>=0;T--)if(w=s().validPositions[T],void 0!==w){C=w.locator[d],w.locator[d]=parseInt(k[x]);break}if(y!==w.locator[d]){var E=[],A=0;for(p=v+1;p<n()+1;p++)f=s().validPositions[p],f&&(null!=f.match.fn?E.push(f.input):e>p&&A++),delete s().validPositions[p],delete s().tests[p];for(a(!0),i.keepStatic=!i.keepStatic,h=!0;E.length>0;){var S=E.shift();if(S!==i.skipOptionalPartCharacter&&!(h=b(n()+1,S,!1,!0)))break}if(w.alternation=d,w.locator[d]=C,h){var P=n(e)+1,R=0;for(p=v+1;p<n()+1;p++)f=s().validPositions[p],f&&null==f.match.fn&&e>p&&R++;e+=R-A,h=b(e>P?P:e,t,r,o)}if(i.keepStatic=!i.keepStatic,h)return h;a(),s().validPositions=$.extend(!0,{},m)}}break}}return!1}function w(e,t){for(var i=s().validPositions[t],r=i.locator,a=r.length,n=e;t>n;n++)if(!k(n)){var l=u(n),c=l[0],d=-1;$.each(l,function(e,t){for(var i=0;a>i;i++)t.locator[i]&&v(t.locator[i].toString().split(","),r[i].toString().split(","))&&i>d&&(d=i,c=t)}),o(n,$.extend({},c,{input:c.match.def}),!0)}}r=r===!0;for(var T=f(),A=e-1;A>-1&&!s().validPositions[A];A--);for(A++;e>A;A++)void 0===s().validPositions[A]&&((!k(A)||T[A]!==E(A))&&u(A).length>1||T[A]===i.radixPoint||"0"===T[A]&&$.inArray(i.radixPoint,T)<A)&&h(A,T[A],!0);var S=e,P=!1,R=$.extend(!0,{},s().validPositions);if(S<y()&&(f(),P=h(S,t,r,d),(!r||d)&&P===!1)){var O=s().validPositions[S];if(!O||null!==O.match.fn||O.match.def!==t&&t!==i.skipOptionalPartCharacter){if((i.insertMode||void 0===s().validPositions[x(S)])&&!k(S))for(var B=S+1,D=x(S);D>=B;B++)if(P=h(B,t,r,d),P!==!1){w(S,B),S=B;break}}else P={caret:x(S)}}if(P===!1&&i.keepStatic&&I(T)&&(P=p(e,t,r,d)),P===!0&&(P={pos:S}),$.isFunction(i.postValidation)&&P!==!1&&!r){a(!0);var F=i.postValidation(f(),i);if(F){if(F.refreshFromBuffer){var M=F.refreshFromBuffer;m(M===!0?M:M.start,M.end,F.buffer),a(!0),P=F}}else a(!0),s().validPositions=$.extend(!0,{},R),P=!1}return P}function k(e){var t=d(e);if(null!=t.fn)return t.fn;if(e>-1&&!i.keepStatic&&void 0===s().validPositions[e]){for(var r=u(e),a=!0,n=0;n<r.length;n++)if(""!==r[n].match.def&&(void 0===r[n].alternation||r[n].locator[r[n].alternation].length>1)){a=!1;break}return a}return!1}function y(){var e;se=void 0!==ie?ie.maxLength:void 0,-1===se&&(se=void 0);var t,i=n(),r=s().validPositions[i],a=void 0!==r?r.locator.slice():void 0;for(t=i+1;void 0===r||null!==r.match.fn||null===r.match.fn&&""!==r.match.def;t++)r=c(t,a,t-1),a=r.locator.slice();var o=d(t-1);return e=""!==o.def?t:t-1,void 0===se||se>e?e:se}function x(e,t){var r=y();if(e>=r)return r;for(var s=e;++s<r&&(t===!0&&(d(s).newBlockMarker!==!0||!k(s))||t!==!0&&!k(s)&&(i.nojumps!==!0||i.nojumpsThreshold>s)););return s}function w(e,t){var i=e;if(0>=i)return 0;for(;--i>0&&(t===!0&&d(i).newBlockMarker!==!0||t!==!0&&!k(i)););return i}function C(e){return void 0===s().validPositions[e]?E(e):s().validPositions[e].input}function T(e,t,r,s,n){if(s&&$.isFunction(i.onBeforeWrite)){var o=i.onBeforeWrite.call(e,s,t,r,i);if(o){if(o.refreshFromBuffer){var l=o.refreshFromBuffer;m(l===!0?l:l.start,l.end,o.buffer||t),a(!0),t=f()}void 0!==r&&(r=void 0!==o.caret?o.caret:r)}}e.inputmask._valueSet(t.join("")),void 0===r||void 0!==s&&"blur"===s.type||P(e,r),n===!0&&(le=!0,$(e).trigger("input"))}function E(e,t){if(t=t||d(e),void 0!==t.placeholder)return t.placeholder;if(null===t.fn){if(e>-1&&!i.keepStatic&&void 0===s().validPositions[e]){for(var r,a=u(e),n=!1,o=0;o<a.length;o++){if(r&&""!==a[o].match.def&&a[o].match.def!==r.match.def&&(void 0===a[o].alternation||a[o].alternation===r.alternation)){n=!0;break}a[o].match.optionality!==!0&&a[o].match.optionalQuantifier!==!0&&(r=a[o])}if(n)return i.placeholder.charAt(e%i.placeholder.length)}return t.def}return i.placeholder.charAt(e%i.placeholder.length)}function A(e,t,r,o){function l(){var e=!1,t=p().slice(u,x(u)).join("").indexOf(h);if(-1!==t&&!k(u)){e=!0;for(var i=p().slice(u,u+t),r=0;r<i.length;r++)if(" "!==i[r]){e=!1;break}}return e}var d=o.slice(),h="",u=0;if(a(),s().p=x(-1),!r)if(i.autoUnmask!==!0){var m=p().slice(0,x(-1)).join(""),g=d.join("").match(new RegExp("^"+Inputmask.escapeRegex(m),"g"));g&&g.length>0&&(d.splice(0,g.length*m.length),u=x(u))}else u=x(u);$.each(d,function(t,a){var o=$.Event("keypress");o.which=a.charCodeAt(0),h+=a;var d=n(void 0,!0),p=s().validPositions[d],f=c(d+1,p?p.locator.slice():void 0,d);if(!l()||r||i.autoUnmask){var m=r?t:null==f.match.fn&&f.match.optionality&&d+1<s().p?d+1:s().p;L.call(e,o,!0,!1,r,m),u=m+1,h=""}else L.call(e,o,!0,!1,!0,d+1)}),t&&T(e,f(),document.activeElement===e?x(n(0)):void 0,$.Event("checkval"))}function S(e){if(e&&void 0===e.inputmask)return e.value;var t=[],r=s().validPositions;for(var a in r)r[a].match&&null!=r[a].match.fn&&t.push(r[a].input);var n=0===t.length?null:(ne?t.reverse():t).join("");if(null!==n){var o=(ne?f().slice().reverse():f()).join("");$.isFunction(i.onUnMask)&&(n=i.onUnMask.call(e,o,n,i)||n)}return n}function P(e,t,r){function s(e){if(ne&&"number"==typeof e&&(!i.greedy||""!==i.placeholder)){var t=f().join("").length;e=t-e}return e}var a;if("number"!=typeof t)return e.setSelectionRange?(t=e.selectionStart,r=e.selectionEnd):window.getSelection?(a=window.getSelection().getRangeAt(0),(a.commonAncestorContainer.parentNode===e||a.commonAncestorContainer===e)&&(t=a.startOffset,r=a.endOffset)):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),t=0-a.duplicate().moveStart("character",-1e5),r=t+a.text.length),{begin:s(t),end:s(r)};t=s(t),r=s(r),r="number"==typeof r?r:t;var n=parseInt(((e.ownerDocument.defaultView||window).getComputedStyle?(e.ownerDocument.defaultView||window).getComputedStyle(e,null):e.currentStyle).fontSize)*r;if(e.scrollLeft=n>e.scrollWidth?n:0,androidchrome||i.insertMode!==!1||t!==r||r++,e.setSelectionRange)e.selectionStart=t,e.selectionEnd=r;else if(window.getSelection){if(a=document.createRange(),void 0===e.firstChild){var o=document.createTextNode("");e.appendChild(o)}a.setStart(e.firstChild,t<e.inputmask._valueGet().length?t:e.inputmask._valueGet().length),a.setEnd(e.firstChild,r<e.inputmask._valueGet().length?r:e.inputmask._valueGet().length),a.collapse(!0);var l=window.getSelection();l.removeAllRanges(),l.addRange(a)}else e.createTextRange&&(a=e.createTextRange(),a.collapse(!0),a.moveEnd("character",r),a.moveStart("character",t),a.select())}function R(e){var t,i,r=f(),a=r.length,o=n(),l={},d=s().validPositions[o],h=void 0!==d?d.locator.slice():void 0;for(t=o+1;t<r.length;t++)i=c(t,h,t-1),h=i.locator.slice(),l[t]=$.extend(!0,{},i);var p=d&&void 0!==d.alternation?d.locator[d.alternation]:void 0;for(t=a-1;t>o&&(i=l[t],(i.match.optionality||i.match.optionalQuantifier||p&&(p!==l[t].locator[d.alternation]&&null!=i.match.fn||null===i.match.fn&&i.locator[d.alternation]&&v(i.locator[d.alternation].toString().split(","),p.toString().split(","))&&""!==u(t)[0].def))&&r[t]===E(t,i.match));t--)a--;return e?{l:a,def:l[a]?l[a].match:void 0}:a}function O(e){for(var t=R(),i=e.length-1;i>t&&!k(i);i--);return e.splice(t,i+1-t),e}function I(e){if($.isFunction(i.isComplete))return i.isComplete.call(ie,e,i);if("*"===i.repeat)return void 0;var t=!1,r=R(!0),a=w(r.l);if(void 0===r.def||r.def.newBlockMarker||r.def.optionality||r.def.optionalQuantifier){t=!0;for(var n=0;a>=n;n++){var o=c(n).match;if(null!==o.fn&&void 0===s().validPositions[n]&&o.optionality!==!0&&o.optionalQuantifier!==!0||null===o.fn&&e[n]!==E(n,o)){t=!1;break}}}return t}function B(e,t){return ne?e-t>1||e-t===1&&i.insertMode:t-e>1||t-e===1&&i.insertMode}function D(e){return function(t){var r=!1,s=!1;if(void 0===this.inputmask){var a=$.data(this,"_inputmask_opts");a?new Inputmask(a).mask(this):$(this).off(".inputmask")}else{if("setvalue"===t.type||!(this.disabled||this.readOnly&&!("keydown"===t.type&&t.ctrlKey&&67===t.keyCode||i.tabThrough===!1&&t.keyCode===Inputmask.keyCode.TAB))){switch(t.type){case"input":if(le===!0||r===!0)return le=!1,t.preventDefault();s=!1;break;case"keydown":oe=!1,r=!1,s=!0;break;case"keypress":if(oe===!0)return t.preventDefault();oe=!0;break;case"compositionstart":r=!0;break;case"compositionupdate":le=s;break;case"compositionend":r=!1,s=!1;break;case"cut":le=!0}return e.apply(this,arguments)}t.preventDefault()}}}function F(e){function t(e){if($.valHooks&&(void 0===$.valHooks[e]||$.valHooks[e].inputmaskpatch!==!0)){var t=$.valHooks[e]&&$.valHooks[e].get?$.valHooks[e].get:function(e){return e.value},i=$.valHooks[e]&&$.valHooks[e].set?$.valHooks[e].set:function(e,t){return e.value=t,e};$.valHooks[e]={get:function(e){if(e.inputmask){if(e.inputmask.opts.autoUnmask)return e.inputmask.unmaskedvalue();var i=t(e),r=e.inputmask.maskset,s=r._buffer;return s=s?s.join(""):"",i!==s?i:""}return t(e)},set:function(e,t){var r,s=$(e);return r=i(e,t),e.inputmask&&s.trigger("setvalue.inputmask"),r},inputmaskpatch:!0}}}function r(){return this.inputmask?this.inputmask.opts.autoUnmask?this.inputmask.unmaskedvalue():n.call(this)!==p().join("")?document.activeElement===this&&i.clearMaskOnLostFocus?(ne?O(f()).reverse():O(f())).join(""):n.call(this):"":n.call(this)}function s(e){o.call(this,e),this.inputmask&&$(this).trigger("setvalue.inputmask")}function a(e){$(e).on("mouseenter.inputmask",D(function(e){var t=$(this),i=this,r=i.inputmask._valueGet();""!==r&&r!==f().join("")&&t.trigger("setvalue.inputmask")}))}var n,o;e.inputmask.__valueGet||(Object.getOwnPropertyDescriptor&&void 0===e.value?(n=function(){return this.textContent},o=function(e){this.textContent=e},Object.defineProperty(e,"value",{get:r,set:s})):document.__lookupGetter__&&e.__lookupGetter__("value")?(n=e.__lookupGetter__("value"),o=e.__lookupSetter__("value"),e.__defineGetter__("value",r),e.__defineSetter__("value",s)):(n=function(){return e.value},o=function(t){e.value=t},t(e.type),a(e)),e.inputmask.__valueGet=n,e.inputmask._valueGet=function(e){return ne&&e!==!0?n.call(this.el).split("").reverse().join(""):n.call(this.el)},e.inputmask.__valueSet=o,e.inputmask._valueSet=function(e,t){o.call(this.el,null===e||void 0===e?"":t!==!0&&ne?e.split("").reverse().join(""):e)})}function M(e,t,r,o){function d(){if(i.keepStatic){a(!0);var t,r=[],o=$.extend(!0,{},s().validPositions);for(t=n();t>=0;t--){var l=s().validPositions[t];if(l&&(null!=l.match.fn&&r.push(l.input),delete s().validPositions[t],void 0!==l.alternation&&l.locator[l.alternation]===c(t).locator[l.alternation]))break}if(t>-1)for(;r.length>0;){s().p=x(n());var d=$.Event("keypress");d.which=r.pop().charCodeAt(0),L.call(e,d,!0,!1,!1,s().p)}else s().validPositions=$.extend(!0,{},o)}}if((i.numericInput||ne)&&(t===Inputmask.keyCode.BACKSPACE?t=Inputmask.keyCode.DELETE:t===Inputmask.keyCode.DELETE&&(t=Inputmask.keyCode.BACKSPACE),ne)){var h=r.end;r.end=r.begin,r.begin=h}t===Inputmask.keyCode.BACKSPACE&&(r.end-r.begin<1||i.insertMode===!1)?(r.begin=w(r.begin),void 0===s().validPositions[r.begin]||s().validPositions[r.begin].input!==i.groupSeparator&&s().validPositions[r.begin].input!==i.radixPoint||r.begin--):t===Inputmask.keyCode.DELETE&&r.begin===r.end&&(r.end=k(r.end)?r.end+1:x(r.end)+1,void 0===s().validPositions[r.begin]||s().validPositions[r.begin].input!==i.groupSeparator&&s().validPositions[r.begin].input!==i.radixPoint||r.end++),l(r.begin,r.end,!1,o),o!==!0&&d();var u=n(r.begin);u<r.begin?(-1===u&&a(),s().p=x(u)):o!==!0&&(s().p=r.begin)}function N(e){var t=this,r=$(t),a=e.keyCode,o=P(t);a===Inputmask.keyCode.BACKSPACE||a===Inputmask.keyCode.DELETE||iphone&&127===a||e.ctrlKey&&88===a&&!isInputEventSupported("cut")?(e.preventDefault(),88===a&&(ee=f().join("")),M(t,a,o),T(t,f(),s().p,e,ee!==f().join("")),t.inputmask._valueGet()===p().join("")?r.trigger("cleared"):I(f())===!0&&r.trigger("complete"),i.showTooltip&&(t.title=i.tooltip||s().mask)):a===Inputmask.keyCode.END||a===Inputmask.keyCode.PAGE_DOWN?setTimeout(function(){var r=x(n());i.insertMode||r!==y()||e.shiftKey||r--,P(t,e.shiftKey?o.begin:r,r)},0):a===Inputmask.keyCode.HOME&&!e.shiftKey||a===Inputmask.keyCode.PAGE_UP?P(t,0,e.shiftKey?o.begin:0):(i.undoOnEscape&&a===Inputmask.keyCode.ESCAPE||90===a&&e.ctrlKey)&&e.altKey!==!0?(A(t,!0,!1,ee.split("")),r.trigger("click")):a!==Inputmask.keyCode.INSERT||e.shiftKey||e.ctrlKey?i.tabThrough===!0&&a===Inputmask.keyCode.TAB?(e.shiftKey===!0?(null===d(o.begin).fn&&(o.begin=x(o.begin)),o.end=w(o.begin,!0),o.begin=w(o.end,!0)):(o.begin=x(o.begin,!0),o.end=x(o.begin,!0),o.end<y()&&o.end--),o.begin<y()&&(e.preventDefault(),P(t,o.begin,o.end))):i.insertMode!==!1||e.shiftKey||(a===Inputmask.keyCode.RIGHT?setTimeout(function(){var e=P(t);P(t,e.begin)},0):a===Inputmask.keyCode.LEFT&&setTimeout(function(){var e=P(t);P(t,ne?e.begin+1:e.begin-1)},0)):(i.insertMode=!i.insertMode,P(t,i.insertMode||o.begin!==y()?o.begin:o.begin-1)),i.onKeyDown(e,f(),P(t).begin,i),ce=-1!==$.inArray(a,i.ignorables)}function L(e,t,r,n,l){var c=this,d=$(c),h=e.which||e.charCode||e.keyCode;if(!(t===!0||e.ctrlKey&&e.altKey)&&(e.ctrlKey||e.metaKey||ce))return h===Inputmask.keyCode.ENTER&&ee!==f().join("")&&(ee=f().join(""),e.preventDefault(),setTimeout(function(){d.trigger("change")},0)),!0;if(h){46===h&&e.shiftKey===!1&&","===i.radixPoint&&(h=44);var p,g=t?{begin:l,end:l}:P(c),v=String.fromCharCode(h),k=B(g.begin,g.end);k&&(s().undoPositions=$.extend(!0,{},s().validPositions),M(c,Inputmask.keyCode.DELETE,g,!0),g.begin=s().p,i.insertMode||(i.insertMode=!i.insertMode,o(g.begin,n),i.insertMode=!i.insertMode),k=!i.multi),s().writeOutBuffer=!0;var y=ne&&!k?g.end:g.begin,C=b(y,v,n);if(C!==!1){if(C!==!0&&(y=void 0!==C.pos?C.pos:y,v=void 0!==C.c?C.c:v),a(!0),void 0!==C.caret)p=C.caret;else{var E=s().validPositions;p=!i.keepStatic&&(void 0!==E[y+1]&&u(y+1,E[y].locator.slice(),y).length>1||void 0!==E[y].alternation)?y+1:x(y)}s().p=p}if(r!==!1){var A=this;if(setTimeout(function(){i.onKeyValidation.call(A,C,i)},0),s().writeOutBuffer&&C!==!1){var S=f();T(c,S,t?void 0:i.numericInput?w(p):p,e,t!==!0),t!==!0&&setTimeout(function(){I(S)===!0&&d.trigger("complete")},0)}else k&&(s().buffer=void 0,s().validPositions=s().undoPositions)}else k&&(s().buffer=void 0,s().validPositions=s().undoPositions);if(i.showTooltip&&(c.title=i.tooltip||s().mask),t&&$.isFunction(i.onBeforeWrite)){var R=i.onBeforeWrite(e,f(),p,i);if(R&&R.refreshFromBuffer){var O=R.refreshFromBuffer;m(O===!0?O:O.start,O.end,R.buffer),a(!0),R.caret&&(s().p=R.caret)}}if(e.preventDefault(),t)return C}}function H(e){var t=this,r=e.originalEvent||e,s=$(t),a=t.inputmask._valueGet(!0),n=P(t);if("propertychange"===e.type&&t.inputmask._valueGet().length<=y())return!0;if("paste"===e.type){var o=a.substr(0,n.begin),l=a.substr(n.end,a.length);o===p().slice(0,n.begin).join("")&&(o=""),l===p().slice(n.end).join("")&&(l=""),window.clipboardData&&window.clipboardData.getData?a=o+window.clipboardData.getData("Text")+l:r.clipboardData&&r.clipboardData.getData&&(a=o+r.clipboardData.getData("text/plain")+l)}var c=a;if($.isFunction(i.onBeforePaste)){if(c=i.onBeforePaste.call(t,a,i),c===!1)return e.preventDefault(),!1;c||(c=a)}return A(t,!1,!1,ne?c.split("").reverse():c.toString().split("")),T(t,f(),void 0,e,!0),s.trigger("click"),I(f())===!0&&s.trigger("complete"),!1}function _(e){var t=this;A(t,!0,!1,t.inputmask._valueGet().split("")),I(f())===!0&&$(t).trigger("complete"),e.preventDefault()}function j(e){var t=this,r=P(t),s=t._valueGet();s=s.replace(new RegExp("("+Inputmask.escapeRegex(p().join(""))+")*"),""),r.begin>s.length&&(P(t,s.length),r=P(t)),f().length-s.length!==1||s.charAt(r.begin)===f()[r.begin]||s.charAt(r.begin+1)===f()[r.begin]||k(r.begin)?_.call(this,e):(e.keyCode=i.keyCode.BACKSPACE,N.call(t,e)),e.preventDefault()}function z(e){var t=e.originalEvent||e;ee=f().join(""),""===te||0!==t.data.indexOf(te)}function W(e){var t=this,r=e.originalEvent||e;0===r.data.indexOf(te)&&(a(),s().p=x(-1),le=!0);for(var n=r.data,o=0;o<n.length;o++){var l=$.Event("keypress");l.which=n.charCodeAt(o),oe=!1,ce=!1,L.call(t,l,!0,!1,!1,s().p)}setTimeout(function(){var e=s().p;T(t,f(),i.numericInput?w(e):e)},0),te=r.data}function U(e){}function q(e){var t=this,r=t.inputmask._valueGet();A(t,!0,!1,($.isFunction(i.onBeforeMask)?i.onBeforeMask.call(t,r,i)||r:r).split("")),ee=f().join(""),(i.clearMaskOnLostFocus||i.clearIncomplete)&&t.inputmask._valueGet()===p().join("")&&t.inputmask._valueSet("")}function K(e){var t=this,r=t.inputmask._valueGet();i.showMaskOnFocus&&(!i.showMaskOnHover||i.showMaskOnHover&&""===r)?t.inputmask._valueGet()!==f().join("")&&T(t,f(),x(n())):de===!1&&P(t,x(n())),i.positionCaretOnTab===!0&&setTimeout(function(){P(t,x(n()))},0),ee=f().join("")}function G(e){var t=this;if(de=!1,i.clearMaskOnLostFocus){var r=f().slice(),s=t.inputmask._valueGet();document.activeElement!==t&&s!==t.getAttribute("placeholder")&&""!==s&&(-1===n()&&s===p().join("")?r=[]:O(r),T(t,r))}}function V(e){function t(e){if(i.radixFocus&&""!==i.radixPoint){var t=s().validPositions;if(void 0===t[e]||t[e].input===E(e)){if(e<x(-1))return!0;var r=$.inArray(i.radixPoint,f());if(-1!==r){for(var a in t)if(a>r&&t[a].input!==E(a))return!1;return!0}}}return!1}var r=this;if(document.activeElement===r){var a=P(r);if(a.begin===a.end)if(t(a.begin))P(r,$.inArray(i.radixPoint,f()));else{var o=a.begin,l=n(o),c=x(l);c>o?P(r,k(o)||k(o-1)?o:x(o)):P(r,i.numericInput?0:c)}}}function Q(e){var t=this;setTimeout(function(){P(t,0,x(n()))},0)}function Y(e){var t=this,r=$(t),a=P(t),n=e.originalEvent||e,o=window.clipboardData||n.clipboardData,l=ne?f().slice(a.end,a.begin):f().slice(a.begin,a.end);
o.setData("text",ne?l.reverse().join(""):l.join("")),document.execCommand&&document.execCommand("copy"),M(t,Inputmask.keyCode.DELETE,a),T(t,f(),s().p,e,ee!==f().join("")),t.inputmask._valueGet()===p().join("")&&r.trigger("cleared"),i.showTooltip&&(t.title=i.tooltip||s().mask)}function X(e){var t=$(this),r=this;if(r.inputmask){var s=r.inputmask._valueGet(),o=f().slice();ee!==o.join("")&&setTimeout(function(){t.trigger("change"),ee=o.join("")},0),""!==s&&(i.clearMaskOnLostFocus&&(-1===n()&&s===p().join("")?o=[]:O(o)),I(o)===!1&&(setTimeout(function(){t.trigger("incomplete")},0),i.clearIncomplete&&(a(),o=i.clearMaskOnLostFocus?[]:p().slice())),T(r,o,void 0,e))}}function Z(e){var t=this;de=!0,document.activeElement!==t&&i.showMaskOnHover&&t.inputmask._valueGet()!==f().join("")&&T(t,f())}function J(e){ie=e,re=$(ie),i.showTooltip&&(ie.title=i.tooltip||s().mask),("rtl"===ie.dir||i.rightAlign)&&(ie.style.textAlign="right"),("rtl"===ie.dir||i.numericInput)&&(ie.dir="ltr",ie.removeAttribute("dir"),ie.inputmask.isRTL=!0,ne=!0),re.off(".inputmask"),F(ie),("INPUT"===ie.tagName&&isInputTypeSupported(ie.getAttribute("type"))||ie.isContentEditable)&&($(ie.form).on("submit",function(){ee!==f().join("")&&re.trigger("change"),i.clearMaskOnLostFocus&&-1===n()&&ie.inputmask._valueGet&&ie.inputmask._valueGet()===p().join("")&&ie.inputmask._valueSet(""),i.removeMaskOnSubmit&&(ie.inputmask._valueSet(ie.inputmask.unmaskedvalue(),!0),setTimeout(function(){T(ie,f())},0))}).on("reset",function(){setTimeout(function(){re.trigger("setvalue.inputmask")},0)}),re.on("mouseenter.inputmask",D(Z)).on("blur.inputmask",D(X)).on("focus.inputmask",D(K)).on("mouseleave.inputmask",D(G)).on("click.inputmask",D(V)).on("dblclick.inputmask",D(Q)).on(PasteEventType+".inputmask dragdrop.inputmask drop.inputmask",D(H)).on("cut.inputmask",D(Y)).on("complete.inputmask",D(i.oncomplete)).on("incomplete.inputmask",D(i.onincomplete)).on("cleared.inputmask",D(i.oncleared)).on("keydown.inputmask",D(N)).on("keypress.inputmask",D(L)),androidfirefox||re.on("compositionstart.inputmask",D(z)).on("compositionupdate.inputmask",D(W)).on("compositionend.inputmask",D(U)),"paste"===PasteEventType&&re.on("input.inputmask",D(_)),(android||androidfirefox||androidchrome||kindle)&&(re.off("input.inputmask"),re.on("input.inputmask",D(j)))),re.on("setvalue.inputmask",D(q));var t=$.isFunction(i.onBeforeMask)?i.onBeforeMask.call(ie,ie.inputmask._valueGet(),i)||ie.inputmask._valueGet():ie.inputmask._valueGet();A(ie,!0,!1,t.split(""));var r=f().slice();ee=r.join("");var o;try{o=document.activeElement}catch(l){}I(r)===!1&&i.clearIncomplete&&a(),i.clearMaskOnLostFocus&&(r.join("")===p().join("")?r=[]:O(r)),T(ie,r),o===ie&&P(ie,x(n()))}var ee,te,ie,re,se,ae,ne=!1,oe=!1,le=!1,ce=!1,de=!0;if(void 0!==e)switch(e.action){case"isComplete":return ie=e.el,I(f());case"unmaskedvalue":return ie=e.el,void 0!==ie&&void 0!==ie.inputmask?(t=ie.inputmask.maskset,i=ie.inputmask.opts,ne=ie.inputmask.isRTL,ae=ne?ie.inputmask._valueGet().split("").reverse().join(""):ie.inputmask._valueGet()):ae=e.value,i.numericInput&&(ne=!0),ae=($.isFunction(i.onBeforeMask)?i.onBeforeMask(ae,i)||ae:ae).split(""),A(void 0,!1,!1,ne?ae.reverse():ae),$.isFunction(i.onBeforeWrite)&&i.onBeforeWrite(void 0,f(),0,i),S(ie);case"mask":ie=e.el,t=ie.inputmask.maskset,i=ie.inputmask.opts,ne=ie.inputmask.isRTL,ee=f().join(""),J(ie);break;case"format":return i.numericInput&&(ne=!0),ae=($.isFunction(i.onBeforeMask)?i.onBeforeMask(e.value,i)||e.value:e.value).split(""),A(void 0,!1,!1,ne?ae.reverse():ae),$.isFunction(i.onBeforeWrite)&&i.onBeforeWrite(void 0,f(),0,i),e.metadata?{value:ne?f().slice().reverse().join(""):f().join(""),metadata:maskScope({action:"getmetadata"},t,i)}:ne?f().slice().reverse().join(""):f().join("");case"isValid":i.numericInput&&(ne=!0),ae=e.value.split(""),A(void 0,!1,!0,ne?ae.reverse():ae);for(var he=f(),ue=R(),pe=he.length-1;pe>ue&&!k(pe);pe--);return he.splice(ue,pe+1-ue),I(he)&&e.value===he.join("");case"getemptymask":return p();case"remove":ie=e.el,re=$(ie),t=ie.inputmask.maskset,i=ie.inputmask.opts,ie.inputmask._valueSet(S(ie)),re.off(".inputmask");var fe;Object.getOwnPropertyDescriptor&&(fe=Object.getOwnPropertyDescriptor(ie,"value")),fe&&fe.get?ie.inputmask.__valueGet&&Object.defineProperty(ie,"value",{get:ie.inputmask.__valueGet,set:ie.inputmask.__valueSet}):document.__lookupGetter__&&ie.__lookupGetter__("value")&&ie.inputmask.__valueGet&&(ie.__defineGetter__("value",ie.inputmask.__valueGet),ie.__defineSetter__("value",ie.inputmask.__valueSet)),ie.inputmask=void 0;break;case"getmetadata":if($.isArray(t.metadata)){for(var me,ge=n(),ve=ge;ve>=0;ve--)if(s().validPositions[ve]&&void 0!==s().validPositions[ve].alternation){me=s().validPositions[ve].alternation;break}return void 0!==me?t.metadata[s().validPositions[ge].locator[me]]:t.metadata[0]}return t.metadata}}Inputmask.prototype={defaults:{placeholder:"_",optionalmarker:{start:"[",end:"]"},quantifiermarker:{start:"{",end:"}"},groupmarker:{start:"(",end:")"},alternatormarker:"|",escapeChar:"\\",mask:null,oncomplete:$.noop,onincomplete:$.noop,oncleared:$.noop,repeat:0,greedy:!0,autoUnmask:!1,removeMaskOnSubmit:!1,clearMaskOnLostFocus:!0,insertMode:!0,clearIncomplete:!1,aliases:{},alias:null,onKeyDown:$.noop,onBeforeMask:null,onBeforePaste:function(e,t){return $.isFunction(t.onBeforeMask)?t.onBeforeMask(e,t):e},onBeforeWrite:null,onUnMask:null,showMaskOnFocus:!0,showMaskOnHover:!0,onKeyValidation:$.noop,skipOptionalPartCharacter:" ",showTooltip:!1,tooltip:void 0,numericInput:!1,rightAlign:!1,undoOnEscape:!0,radixPoint:"",groupSeparator:"",radixFocus:!1,nojumps:!1,nojumpsThreshold:0,keepStatic:null,positionCaretOnTab:!1,tabThrough:!1,supportsInputType:[],definitions:{9:{validator:"[0-9]",cardinality:1,definitionSymbol:"*"},a:{validator:"[A-Za-zА-яЁёÀ-ÿµ]",cardinality:1,definitionSymbol:"*"},"*":{validator:"[0-9A-Za-zА-яЁёÀ-ÿµ]",cardinality:1}},ignorables:[8,9,13,19,27,33,34,35,36,37,38,39,40,45,46,93,112,113,114,115,116,117,118,119,120,121,122,123],isComplete:null,canClearPosition:$.noop,postValidation:null},masksCache:{},mask:function(e){var t=this;return e=void 0===e.length?[e]:e,$.each(e,function(e,i){var r=$.extend(!0,{},t.opts);importAttributeOptions(i,r,$.extend(!0,{},t.userOptions));var s=generateMaskSet(r,t.noMasksCache);void 0!==s&&(void 0!==i.inputmask&&i.inputmask.remove(),i.inputmask=new Inputmask,i.inputmask.opts=r,i.inputmask.noMasksCache=t.noMasksCache,i.inputmask.userOptions=$.extend(!0,{},t.userOptions),i.inputmask.el=i,i.inputmask.maskset=s,i.inputmask.isRTL=!1,$.data(i,"_inputmask_opts",r),maskScope({action:"mask",el:i}))}),e?e[0].inputmask||this:this},option:function(e){return"string"==typeof e?this.opts[e]:"object"==typeof e?($.extend(this.opts,e),$.extend(this.userOptions,e),this.el&&(void 0!==e.mask||void 0!==e.alias?this.mask(this.el):($.data(this.el,"_inputmask_opts",this.opts),maskScope({action:"mask",el:this.el}))),this):void 0},unmaskedvalue:function(e){return maskScope({action:"unmaskedvalue",el:this.el,value:e},this.el&&this.el.inputmask?this.el.inputmask.maskset:generateMaskSet(this.opts,this.noMasksCache),this.opts)},remove:function(){return this.el?(maskScope({action:"remove",el:this.el}),this.el.inputmask=void 0,this.el):void 0},getemptymask:function(){return maskScope({action:"getemptymask"},this.maskset||generateMaskSet(this.opts,this.noMasksCache),this.opts)},hasMaskedValue:function(){return!this.opts.autoUnmask},isComplete:function(){return maskScope({action:"isComplete",el:this.el},this.maskset||generateMaskSet(this.opts,this.noMasksCache),this.opts)},getmetadata:function(){return maskScope({action:"getmetadata"},this.maskset||generateMaskSet(this.opts,this.noMasksCache),this.opts)},isValid:function(e){return maskScope({action:"isValid",value:e},this.maskset||generateMaskSet(this.opts,this.noMasksCache),this.opts)},format:function(e,t){return maskScope({action:"format",value:e,metadata:t},this.maskset||generateMaskSet(this.opts,this.noMasksCache),this.opts)}},Inputmask.extendDefaults=function(e){$.extend(!0,Inputmask.prototype.defaults,e)},Inputmask.extendDefinitions=function(e){$.extend(!0,Inputmask.prototype.defaults.definitions,e)},Inputmask.extendAliases=function(e){$.extend(!0,Inputmask.prototype.defaults.aliases,e)},Inputmask.format=function(e,t,i){return Inputmask(t).format(e,i)},Inputmask.unmask=function(e,t){return Inputmask(t).unmaskedvalue(e)},Inputmask.isValid=function(e,t){return Inputmask(t).isValid(e)},Inputmask.escapeRegex=function(e){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\","$","^"];return e.replace(new RegExp("(\\"+t.join("|\\")+")","gim"),"\\$1")},Inputmask.keyCode={ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91};var ua=navigator.userAgent,iphone=null!==ua.match(new RegExp("iphone","i")),android=null!==ua.match(new RegExp("android.*safari.*","i")),androidchrome=null!==ua.match(new RegExp("android.*chrome.*","i")),androidfirefox=null!==ua.match(new RegExp("android.*firefox.*","i")),kindle=/Kindle/i.test(ua)||/Silk/i.test(ua)||/KFTT/i.test(ua)||/KFOT/i.test(ua)||/KFJWA/i.test(ua)||/KFJWI/i.test(ua)||/KFSOWI/i.test(ua)||/KFTHWA/i.test(ua)||/KFTHWI/i.test(ua)||/KFAPWA/i.test(ua)||/KFAPWI/i.test(ua),PasteEventType=isInputEventSupported("paste")?"paste":isInputEventSupported("input")?"input":"propertychange";return window.Inputmask=Inputmask,Inputmask}(jQuery),function(e,t){return void 0===e.fn.inputmask&&(e.fn.inputmask=function(i,r){var s,a;if(r=r||{},"string"==typeof i)switch(i){case"mask":return s=new t(r),this.each(function(){s.mask(this)});case"unmaskedvalue":return a=this.jquery&&this.length>0?this[0]:this,a.inputmask?a.inputmask.unmaskedvalue():e(a).val();case"remove":return this.each(function(){this.inputmask&&this.inputmask.remove()});case"getemptymask":return a=this.jquery&&this.length>0?this[0]:this,a.inputmask?a.inputmask.getemptymask():"";case"hasMaskedValue":return a=this.jquery&&this.length>0?this[0]:this,a.inputmask?a.inputmask.hasMaskedValue():!1;case"isComplete":return a=this.jquery&&this.length>0?this[0]:this,a.inputmask?a.inputmask.isComplete():!0;case"getmetadata":return a=this.jquery&&this.length>0?this[0]:this,a.inputmask?a.inputmask.getmetadata():void 0;case"setvalue":a=this.jquery&&this.length>0?this[0]:this,e(a).val(r),void 0!==a.inputmask&&e(a).triggerHandler("setvalue.inputmask");break;case"option":if("string"!=typeof r)return this.each(function(){return void 0!==this.inputmask?this.inputmask.option(r):void 0});if(a=this.jquery&&this.length>0?this[0]:this,void 0!==a.inputmask)return a.inputmask.option(r);break;default:return r.alias=i,s=new t(r),this.each(function(){s.mask(this)})}else{if("object"==typeof i)return s=new t(i),void 0===i.mask&&void 0===i.alias?this.each(function(){return void 0!==this.inputmask?this.inputmask.option(i):void s.mask(this)}):this.each(function(){s.mask(this)});if(void 0===i)return this.each(function(){s=new t(r),s.mask(this)})}}),e.fn.inputmask}(jQuery,Inputmask),function(e,t){return t.extendDefinitions({h:{validator:"[01][0-9]|2[0-3]",cardinality:2,prevalidator:[{validator:"[0-2]",cardinality:1}]},s:{validator:"[0-5][0-9]",cardinality:2,prevalidator:[{validator:"[0-5]",cardinality:1}]},d:{validator:"0[1-9]|[12][0-9]|3[01]",cardinality:2,prevalidator:[{validator:"[0-3]",cardinality:1}]},m:{validator:"0[1-9]|1[012]",cardinality:2,prevalidator:[{validator:"[01]",cardinality:1}]},y:{validator:"(19|20)\\d{2}",cardinality:4,prevalidator:[{validator:"[12]",cardinality:1},{validator:"(19|20)",cardinality:2},{validator:"(19|20)\\d",cardinality:3}]}}),t.extendAliases({"dd/mm/yyyy":{mask:"1/2/y",placeholder:"dd/mm/yyyy",regex:{val1pre:new RegExp("[0-3]"),val1:new RegExp("0[1-9]|[12][0-9]|3[01]"),val2pre:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|[12][0-9]|3[01])"+i+"[01])")},val2:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|[12][0-9])"+i+"(0[1-9]|1[012]))|(30"+i+"(0[13-9]|1[012]))|(31"+i+"(0[13578]|1[02]))")}},leapday:"29/02/",separator:"/",yearrange:{minyear:1900,maxyear:2099},isInYearRange:function(e,t,i){if(isNaN(e))return!1;var r=parseInt(e.concat(t.toString().slice(e.length))),s=parseInt(e.concat(i.toString().slice(e.length)));return(isNaN(r)?!1:r>=t&&i>=r)||(isNaN(s)?!1:s>=t&&i>=s)},determinebaseyear:function(e,t,i){var r=(new Date).getFullYear();if(e>r)return e;if(r>t){for(var s=t.toString().slice(0,2),a=t.toString().slice(2,4);s+i>t;)s--;var n=s+a;return e>n?e:n}return r},onKeyDown:function(i,r,s,a){var n=e(this);if(i.ctrlKey&&i.keyCode===t.keyCode.RIGHT){var o=new Date;n.val(o.getDate().toString()+(o.getMonth()+1).toString()+o.getFullYear().toString()),n.trigger("setvalue.inputmask")}},getFrontValue:function(e,t,i){for(var r=0,s=0,a=0;a<e.length&&"2"!==e.charAt(a);a++){var n=i.definitions[e.charAt(a)];n?(r+=s,s=n.cardinality):s++}return t.join("").substr(r,s)},definitions:{1:{validator:function(e,t,i,r,s){var a=s.regex.val1.test(e);return r||a||e.charAt(1)!==s.separator&&-1==="-./".indexOf(e.charAt(1))||!(a=s.regex.val1.test("0"+e.charAt(0)))?a:(t.buffer[i-1]="0",{refreshFromBuffer:{start:i-1,end:i},pos:i,c:e.charAt(0)})},cardinality:2,prevalidator:[{validator:function(e,t,i,r,s){var a=e;isNaN(t.buffer[i+1])||(a+=t.buffer[i+1]);var n=1===a.length?s.regex.val1pre.test(a):s.regex.val1.test(a);if(!r&&!n){if(n=s.regex.val1.test(e+"0"))return t.buffer[i]=e,t.buffer[++i]="0",{pos:i,c:"0"};if(n=s.regex.val1.test("0"+e))return t.buffer[i]="0",i++,{pos:i}}return n},cardinality:1}]},2:{validator:function(e,t,i,r,s){var a=s.getFrontValue(t.mask,t.buffer,s);-1!==a.indexOf(s.placeholder[0])&&(a="01"+s.separator);var n=s.regex.val2(s.separator).test(a+e);if(!r&&!n&&(e.charAt(1)===s.separator||-1!=="-./".indexOf(e.charAt(1)))&&(n=s.regex.val2(s.separator).test(a+"0"+e.charAt(0))))return t.buffer[i-1]="0",{refreshFromBuffer:{start:i-1,end:i},pos:i,c:e.charAt(0)};if(s.mask.indexOf("2")===s.mask.length-1&&n){var o=t.buffer.join("").substr(4,4)+e;if(o!==s.leapday)return!0;var l=parseInt(t.buffer.join("").substr(0,4),10);return l%4===0?l%100===0?l%400===0?!0:!1:!0:!1}return n},cardinality:2,prevalidator:[{validator:function(e,t,i,r,s){isNaN(t.buffer[i+1])||(e+=t.buffer[i+1]);var a=s.getFrontValue(t.mask,t.buffer,s);-1!==a.indexOf(s.placeholder[0])&&(a="01"+s.separator);var n=1===e.length?s.regex.val2pre(s.separator).test(a+e):s.regex.val2(s.separator).test(a+e);return r||n||!(n=s.regex.val2(s.separator).test(a+"0"+e))?n:(t.buffer[i]="0",i++,{pos:i})},cardinality:1}]},y:{validator:function(e,t,i,r,s){if(s.isInYearRange(e,s.yearrange.minyear,s.yearrange.maxyear)){var a=t.buffer.join("").substr(0,6);if(a!==s.leapday)return!0;var n=parseInt(e,10);return n%4===0?n%100===0?n%400===0?!0:!1:!0:!1}return!1},cardinality:4,prevalidator:[{validator:function(e,t,i,r,s){var a=s.isInYearRange(e,s.yearrange.minyear,s.yearrange.maxyear);if(!r&&!a){var n=s.determinebaseyear(s.yearrange.minyear,s.yearrange.maxyear,e+"0").toString().slice(0,1);if(a=s.isInYearRange(n+e,s.yearrange.minyear,s.yearrange.maxyear))return t.buffer[i++]=n.charAt(0),{pos:i};if(n=s.determinebaseyear(s.yearrange.minyear,s.yearrange.maxyear,e+"0").toString().slice(0,2),a=s.isInYearRange(n+e,s.yearrange.minyear,s.yearrange.maxyear))return t.buffer[i++]=n.charAt(0),t.buffer[i++]=n.charAt(1),{pos:i}}return a},cardinality:1},{validator:function(e,t,i,r,s){var a=s.isInYearRange(e,s.yearrange.minyear,s.yearrange.maxyear);if(!r&&!a){var n=s.determinebaseyear(s.yearrange.minyear,s.yearrange.maxyear,e).toString().slice(0,2);if(a=s.isInYearRange(e[0]+n[1]+e[1],s.yearrange.minyear,s.yearrange.maxyear))return t.buffer[i++]=n.charAt(1),{pos:i};if(n=s.determinebaseyear(s.yearrange.minyear,s.yearrange.maxyear,e).toString().slice(0,2),s.isInYearRange(n+e,s.yearrange.minyear,s.yearrange.maxyear)){var o=t.buffer.join("").substr(0,6);if(o!==s.leapday)a=!0;else{var l=parseInt(e,10);a=l%4===0?l%100===0?l%400===0?!0:!1:!0:!1}}else a=!1;if(a)return t.buffer[i-1]=n.charAt(0),t.buffer[i++]=n.charAt(1),t.buffer[i++]=e.charAt(0),{refreshFromBuffer:{start:i-3,end:i},pos:i}}return a},cardinality:2},{validator:function(e,t,i,r,s){return s.isInYearRange(e,s.yearrange.minyear,s.yearrange.maxyear)},cardinality:3}]}},insertMode:!1,autoUnmask:!1},"mm/dd/yyyy":{placeholder:"mm/dd/yyyy",alias:"dd/mm/yyyy",regex:{val2pre:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[13-9]|1[012])"+i+"[0-3])|(02"+i+"[0-2])")},val2:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|1[012])"+i+"(0[1-9]|[12][0-9]))|((0[13-9]|1[012])"+i+"30)|((0[13578]|1[02])"+i+"31)")},val1pre:new RegExp("[01]"),val1:new RegExp("0[1-9]|1[012]")},leapday:"02/29/",onKeyDown:function(i,r,s,a){var n=e(this);if(i.ctrlKey&&i.keyCode===t.keyCode.RIGHT){var o=new Date;n.val((o.getMonth()+1).toString()+o.getDate().toString()+o.getFullYear().toString()),n.trigger("setvalue.inputmask")}}},"yyyy/mm/dd":{mask:"y/1/2",placeholder:"yyyy/mm/dd",alias:"mm/dd/yyyy",leapday:"/02/29",onKeyDown:function(i,r,s,a){var n=e(this);if(i.ctrlKey&&i.keyCode===t.keyCode.RIGHT){var o=new Date;n.val(o.getFullYear().toString()+(o.getMonth()+1).toString()+o.getDate().toString()),n.trigger("setvalue.inputmask")}}},"dd.mm.yyyy":{mask:"1.2.y",placeholder:"dd.mm.yyyy",leapday:"29.02.",separator:".",alias:"dd/mm/yyyy"},"dd-mm-yyyy":{mask:"1-2-y",placeholder:"dd-mm-yyyy",leapday:"29-02-",separator:"-",alias:"dd/mm/yyyy"},"mm.dd.yyyy":{mask:"1.2.y",placeholder:"mm.dd.yyyy",leapday:"02.29.",separator:".",alias:"mm/dd/yyyy"},"mm-dd-yyyy":{mask:"1-2-y",placeholder:"mm-dd-yyyy",leapday:"02-29-",separator:"-",alias:"mm/dd/yyyy"},"yyyy.mm.dd":{mask:"y.1.2",placeholder:"yyyy.mm.dd",leapday:".02.29",separator:".",alias:"yyyy/mm/dd"},"yyyy-mm-dd":{mask:"y-1-2",placeholder:"yyyy-mm-dd",leapday:"-02-29",separator:"-",alias:"yyyy/mm/dd"},datetime:{mask:"1/2/y h:s",placeholder:"dd/mm/yyyy hh:mm",alias:"dd/mm/yyyy",regex:{hrspre:new RegExp("[012]"),hrs24:new RegExp("2[0-4]|1[3-9]"),hrs:new RegExp("[01][0-9]|2[0-4]"),ampm:new RegExp("^[a|p|A|P][m|M]"),mspre:new RegExp("[0-5]"),ms:new RegExp("[0-5][0-9]")},timeseparator:":",hourFormat:"24",definitions:{h:{validator:function(e,t,i,r,s){if("24"===s.hourFormat&&24===parseInt(e,10))return t.buffer[i-1]="0",t.buffer[i]="0",{refreshFromBuffer:{start:i-1,end:i},c:"0"};var a=s.regex.hrs.test(e);if(!r&&!a&&(e.charAt(1)===s.timeseparator||-1!=="-.:".indexOf(e.charAt(1)))&&(a=s.regex.hrs.test("0"+e.charAt(0))))return t.buffer[i-1]="0",t.buffer[i]=e.charAt(0),i++,{refreshFromBuffer:{start:i-2,end:i},pos:i,c:s.timeseparator};if(a&&"24"!==s.hourFormat&&s.regex.hrs24.test(e)){var n=parseInt(e,10);return 24===n?(t.buffer[i+5]="a",t.buffer[i+6]="m"):(t.buffer[i+5]="p",t.buffer[i+6]="m"),n-=12,10>n?(t.buffer[i]=n.toString(),t.buffer[i-1]="0"):(t.buffer[i]=n.toString().charAt(1),t.buffer[i-1]=n.toString().charAt(0)),{refreshFromBuffer:{start:i-1,end:i+6},c:t.buffer[i]}}return a},cardinality:2,prevalidator:[{validator:function(e,t,i,r,s){var a=s.regex.hrspre.test(e);return r||a||!(a=s.regex.hrs.test("0"+e))?a:(t.buffer[i]="0",i++,{pos:i})},cardinality:1}]},s:{validator:"[0-5][0-9]",cardinality:2,prevalidator:[{validator:function(e,t,i,r,s){var a=s.regex.mspre.test(e);return r||a||!(a=s.regex.ms.test("0"+e))?a:(t.buffer[i]="0",i++,{pos:i})},cardinality:1}]},t:{validator:function(e,t,i,r,s){return s.regex.ampm.test(e+"m")},casing:"lower",cardinality:1}},insertMode:!1,autoUnmask:!1},datetime12:{mask:"1/2/y h:s t\\m",placeholder:"dd/mm/yyyy hh:mm xm",alias:"datetime",hourFormat:"12"},"mm/dd/yyyy hh:mm xm":{mask:"1/2/y h:s t\\m",placeholder:"mm/dd/yyyy hh:mm xm",alias:"datetime12",regex:{val2pre:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[13-9]|1[012])"+i+"[0-3])|(02"+i+"[0-2])")},val2:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|1[012])"+i+"(0[1-9]|[12][0-9]))|((0[13-9]|1[012])"+i+"30)|((0[13578]|1[02])"+i+"31)")},val1pre:new RegExp("[01]"),val1:new RegExp("0[1-9]|1[012]")},leapday:"02/29/",onKeyDown:function(i,r,s,a){var n=e(this);if(i.ctrlKey&&i.keyCode===t.keyCode.RIGHT){var o=new Date;n.val((o.getMonth()+1).toString()+o.getDate().toString()+o.getFullYear().toString()),n.trigger("setvalue.inputmask")}}},"hh:mm t":{mask:"h:s t\\m",placeholder:"hh:mm xm",alias:"datetime",hourFormat:"12"},"h:s t":{mask:"h:s t\\m",placeholder:"hh:mm xm",alias:"datetime",hourFormat:"12"},"hh:mm:ss":{mask:"h:s:s",placeholder:"hh:mm:ss",alias:"datetime",autoUnmask:!1},"hh:mm":{mask:"h:s",placeholder:"hh:mm",alias:"datetime",autoUnmask:!1},date:{alias:"dd/mm/yyyy"},"mm/yyyy":{mask:"1/y",placeholder:"mm/yyyy",leapday:"donotuse",separator:"/",alias:"mm/dd/yyyy"},shamsi:{regex:{val2pre:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|1[012])"+i+"[0-3])")},val2:function(e){var i=t.escapeRegex.call(this,e);return new RegExp("((0[1-9]|1[012])"+i+"(0[1-9]|[12][0-9]))|((0[1-9]|1[012])"+i+"30)|((0[1-6])"+i+"31)")},val1pre:new RegExp("[01]"),val1:new RegExp("0[1-9]|1[012]")},yearrange:{minyear:1300,maxyear:1499},mask:"y/1/2",leapday:"/12/30",placeholder:"yyyy/mm/dd",alias:"mm/dd/yyyy",clearIncomplete:!0}}),t}(jQuery,Inputmask),function(e,t){return t.extendDefinitions({A:{validator:"[A-Za-zА-яЁёÀ-ÿµ]",cardinality:1,casing:"upper"},"&":{validator:"[0-9A-Za-zА-яЁёÀ-ÿµ]",cardinality:1,casing:"upper"},"#":{validator:"[0-9A-Fa-f]",cardinality:1,casing:"upper"}}),t.extendAliases({url:{mask:"ir",placeholder:"",separator:"",defaultPrefix:"http://",regex:{urlpre1:new RegExp("[fh]"),urlpre2:new RegExp("(ft|ht)"),urlpre3:new RegExp("(ftp|htt)"),urlpre4:new RegExp("(ftp:|http|ftps)"),urlpre5:new RegExp("(ftp:/|ftps:|http:|https)"),urlpre6:new RegExp("(ftp://|ftps:/|http:/|https:)"),urlpre7:new RegExp("(ftp://|ftps://|http://|https:/)"),urlpre8:new RegExp("(ftp://|ftps://|http://|https://)")},definitions:{i:{validator:function(e,t,i,r,s){return!0},cardinality:8,prevalidator:function(){for(var e=[],t=8,i=0;t>i;i++)e[i]=function(){var e=i;return{validator:function(t,i,r,s,a){if(a.regex["urlpre"+(e+1)]){var n,o=t;e+1-t.length>0&&(o=i.buffer.join("").substring(0,e+1-t.length)+""+o);var l=a.regex["urlpre"+(e+1)].test(o);if(!s&&!l){for(r-=e,n=0;n<a.defaultPrefix.length;n++)i.buffer[r]=a.defaultPrefix[n],r++;for(n=0;n<o.length-1;n++)i.buffer[r]=o[n],r++;return{pos:r}}return l}return!1},cardinality:e}}();return e}()},r:{validator:".",cardinality:50}},insertMode:!1,autoUnmask:!1},ip:{mask:"i[i[i]].i[i[i]].i[i[i]].i[i[i]]",definitions:{i:{validator:function(e,t,i,r,s){return i-1>-1&&"."!==t.buffer[i-1]?(e=t.buffer[i-1]+e,e=i-2>-1&&"."!==t.buffer[i-2]?t.buffer[i-2]+e:"0"+e):e="00"+e,new RegExp("25[0-5]|2[0-4][0-9]|[01][0-9][0-9]").test(e)},cardinality:1}},onUnMask:function(e,t,i){return e}},email:{mask:"*{1,64}[.*{1,64}][.*{1,64}][.*{1,64}]@*{1,64}[.*{2,64}][.*{2,6}][.*{1,2}]",greedy:!1,onBeforePaste:function(e,t){return e=e.toLowerCase(),e.replace("mailto:","")},definitions:{"*":{validator:"[0-9A-Za-z!#$%&'*+/=?^_`{|}~-]",cardinality:1,casing:"lower"}},onUnMask:function(e,t,i){return e}},mac:{mask:"##:##:##:##:##:##"}}),t}(jQuery,Inputmask),function(e,t){return t.extendAliases({numeric:{mask:function(e){function t(t){for(var i="",r=0;r<t.length;r++)i+=e.definitions[t.charAt(r)]?"\\"+t.charAt(r):t.charAt(r);return i}if(0!==e.repeat&&isNaN(e.integerDigits)&&(e.integerDigits=e.repeat),e.repeat=0,e.groupSeparator===e.radixPoint&&("."===e.radixPoint?e.groupSeparator=",":","===e.radixPoint?e.groupSeparator=".":e.groupSeparator="")," "===e.groupSeparator&&(e.skipOptionalPartCharacter=void 0),e.autoGroup=e.autoGroup&&""!==e.groupSeparator,e.autoGroup&&("string"==typeof e.groupSize&&isFinite(e.groupSize)&&(e.groupSize=parseInt(e.groupSize)),isFinite(e.integerDigits))){var i=Math.floor(e.integerDigits/e.groupSize),r=e.integerDigits%e.groupSize;e.integerDigits=parseInt(e.integerDigits)+(0===r?i-1:i),e.integerDigits<1&&(e.integerDigits="*")}e.placeholder.length>1&&(e.placeholder=e.placeholder.charAt(0)),e.radixFocus=e.radixFocus&&""!==e.placeholder&&e.integerOptional===!0,e.definitions[";"]=e.definitions["~"],e.definitions[";"].definitionSymbol="~",e.numericInput===!0&&(e.radixFocus=!1,e.digitsOptional=!1,isNaN(e.digits)&&(e.digits=2),e.decimalProtect=!1);var s=t(e.prefix);return s+="[+]",s+=e.integerOptional===!0?"~{1,"+e.integerDigits+"}":"~{"+e.integerDigits+"}",void 0!==e.digits&&(isNaN(e.digits)||parseInt(e.digits)>0)&&(s+=e.digitsOptional?"["+(e.decimalProtect?":":e.radixPoint)+";{1,"+e.digits+"}]":(e.decimalProtect?":":e.radixPoint)+";{"+e.digits+"}"),""!==e.negationSymbol.back&&(s+="[-]"),s+=t(e.suffix),e.greedy=!1,s},placeholder:"",greedy:!1,digits:"*",digitsOptional:!0,radixPoint:".",radixFocus:!0,groupSize:3,groupSeparator:"",autoGroup:!1,allowPlus:!0,allowMinus:!0,negationSymbol:{front:"-",back:""},integerDigits:"+",integerOptional:!0,prefix:"",suffix:"",rightAlign:!0,decimalProtect:!0,min:null,max:null,step:1,insertMode:!0,autoUnmask:!1,unmaskAsNumber:!1,postFormat:function(i,r,s,a){a.numericInput===!0&&(i=i.reverse(),isFinite(r)&&(r=i.join("").length-r-1));var n,o,l=!1;i.length>=a.suffix.length&&i.join("").indexOf(a.suffix)===i.length-a.suffix.length&&(i.length=i.length-a.suffix.length,l=!0),r=r>=i.length?i.length-1:r<a.prefix.length?a.prefix.length:r;var c=!1,d=i[r];if(""===a.groupSeparator||a.numericInput!==!0&&-1!==e.inArray(a.radixPoint,i)&&r>e.inArray(a.radixPoint,i)||new RegExp("["+t.escapeRegex(a.negationSymbol.front)+"+]").test(d)){if(l)for(n=0,o=a.suffix.length;o>n;n++)i.push(a.suffix.charAt(n));return{pos:r}}var h=i.slice();d===a.groupSeparator&&(h.splice(r--,1),d=h[r]),s?d!==a.radixPoint&&(h[r]="?"):h.splice(r,0,"?");var u=h.join(""),p=u;if(u.length>0&&a.autoGroup||s&&-1!==u.indexOf(a.groupSeparator)){var f=t.escapeRegex(a.groupSeparator);c=0===u.indexOf(a.groupSeparator),u=u.replace(new RegExp(f,"g"),"");var m=u.split(a.radixPoint);if(u=""===a.radixPoint?u:m[0],u!==a.prefix+"?0"&&u.length>=a.groupSize+a.prefix.length)for(var g=new RegExp("([-+]?[\\d?]+)([\\d?]{"+a.groupSize+"})");g.test(u);)u=u.replace(g,"$1"+a.groupSeparator+"$2"),u=u.replace(a.groupSeparator+a.groupSeparator,a.groupSeparator);""!==a.radixPoint&&m.length>1&&(u+=a.radixPoint+m[1])}for(c=p!==u,i.length=u.length,n=0,o=u.length;o>n;n++)i[n]=u.charAt(n);var v=e.inArray("?",i);if(-1===v&&d===a.radixPoint&&(v=e.inArray(a.radixPoint,i)),s?i[v]=d:i.splice(v,1),!c&&l)for(n=0,o=a.suffix.length;o>n;n++)i.push(a.suffix.charAt(n));return v=a.numericInput&&isFinite(r)?i.join("").length-v-1:v,a.numericInput&&(i=i.reverse(),e.inArray(a.radixPoint,i)<v&&i.join("").length-a.suffix.length!==v&&(v-=1)),{pos:v,refreshFromBuffer:c,buffer:i}},onBeforeWrite:function(i,r,s,a){if(i&&("blur"===i.type||"checkval"===i.type)){var n=r.join(""),o=n.replace(a.prefix,"");if(o=o.replace(a.suffix,""),o=o.replace(new RegExp(t.escapeRegex(a.groupSeparator),"g"),""),","===a.radixPoint&&(o=o.replace(t.escapeRegex(a.radixPoint),".")),isFinite(o)&&isFinite(a.min)&&parseFloat(o)<parseFloat(a.min))return e.extend(!0,{refreshFromBuffer:!0,buffer:(a.prefix+a.min).split("")},a.postFormat((a.prefix+a.min).split(""),0,!0,a));if(a.numericInput!==!0){var l=""!==a.radixPoint?r.join("").split(a.radixPoint):[r.join("")],c=l[0].match(a.regex.integerPart(a)),d=2===l.length?l[1].match(a.regex.integerNPart(a)):void 0;if(c){c[0]!==a.negationSymbol.front+"0"&&c[0]!==a.negationSymbol.front&&"+"!==c[0]||void 0!==d&&!d[0].match(/^0+$/)||r.splice(c.index,1);var h=e.inArray(a.radixPoint,r);if(-1!==h){if(isFinite(a.digits)&&!a.digitsOptional){for(var u=1;u<=a.digits;u++)(void 0===r[h+u]||r[h+u]===a.placeholder.charAt(0))&&(r[h+u]="0");return{refreshFromBuffer:n!==r.join(""),buffer:r}}if(h===r.length-a.suffix.length-1)return r.splice(h,1),{refreshFromBuffer:!0,buffer:r}}}}}if(a.autoGroup){var p=a.postFormat(r,a.numericInput?s:s-1,!0,a);return p.caret=s<=a.prefix.length?p.pos:p.pos+1,p}},regex:{integerPart:function(e){return new RegExp("["+t.escapeRegex(e.negationSymbol.front)+"+]?\\d+")},integerNPart:function(e){return new RegExp("[\\d"+t.escapeRegex(e.groupSeparator)+"]+")}},signHandler:function(e,t,i,r,s){if(!r&&s.allowMinus&&"-"===e||s.allowPlus&&"+"===e){var a=t.buffer.join("").match(s.regex.integerPart(s));if(a&&a[0].length>0)return t.buffer[a.index]===("-"===e?"+":s.negationSymbol.front)?"-"===e?""!==s.negationSymbol.back?{pos:a.index,c:s.negationSymbol.front,remove:a.index,caret:i,insert:{pos:t.buffer.length-s.suffix.length-1,c:s.negationSymbol.back}}:{pos:a.index,c:s.negationSymbol.front,remove:a.index,caret:i}:""!==s.negationSymbol.back?{pos:a.index,c:"+",remove:[a.index,t.buffer.length-s.suffix.length-1],caret:i}:{pos:a.index,c:"+",remove:a.index,caret:i}:t.buffer[a.index]===("-"===e?s.negationSymbol.front:"+")?"-"===e&&""!==s.negationSymbol.back?{remove:[a.index,t.buffer.length-s.suffix.length-1],caret:i-1}:{remove:a.index,caret:i-1}:"-"===e?""!==s.negationSymbol.back?{pos:a.index,c:s.negationSymbol.front,caret:i+1,insert:{pos:t.buffer.length-s.suffix.length,c:s.negationSymbol.back}}:{pos:a.index,c:s.negationSymbol.front,caret:i+1}:{pos:a.index,c:e,caret:i+1}}return!1},radixHandler:function(t,i,r,s,a){if(!s&&(-1!==e.inArray(t,[",","."])&&(t=a.radixPoint),t===a.radixPoint&&void 0!==a.digits&&(isNaN(a.digits)||parseInt(a.digits)>0))){var n=e.inArray(a.radixPoint,i.buffer),o=i.buffer.join("").match(a.regex.integerPart(a));if(-1!==n&&i.validPositions[n])return i.validPositions[n-1]?{caret:n+1}:{pos:o.index,c:o[0],caret:n+1};if(!o||"0"===o[0]&&o.index+1!==r)return i.buffer[o?o.index:r]="0",{pos:(o?o.index:r)+1,c:a.radixPoint}}return!1},leadingZeroHandler:function(t,i,r,s,a){if(a.numericInput===!0){if("0"===i.buffer[i.buffer.length-a.prefix.length-1])return{pos:r,remove:i.buffer.length-a.prefix.length-1}}else{var n=i.buffer.join("").match(a.regex.integerNPart(a)),o=e.inArray(a.radixPoint,i.buffer);if(n&&!s&&(-1===o||o>=r))if(0===n[0].indexOf("0")){r<a.prefix.length&&(r=n.index);var l=e.inArray(a.radixPoint,i._buffer),c=i._buffer&&i.buffer.slice(o).join("")===i._buffer.slice(l).join("")||0===parseInt(i.buffer.slice(o+1).join("")),d=i._buffer&&i.buffer.slice(n.index,o).join("")===i._buffer.slice(a.prefix.length,l).join("")||"0"===i.buffer.slice(n.index,o).join("");if(-1===o||c&&d)return i.buffer.splice(n.index,1),r=r>n.index?r-1:n.index,{pos:r,remove:n.index};if(n.index+1===r||"0"===t)return i.buffer.splice(n.index,1),r=n.index,{pos:r,remove:n.index}}else if("0"===t&&r<=n.index&&n[0]!==a.groupSeparator)return!1}return!0},postValidation:function(i,r){var s=!0,a=i.join(""),n=a.replace(r.prefix,"");return n=n.replace(r.suffix,""),n=n.replace(new RegExp(t.escapeRegex(r.groupSeparator),"g"),""),","===r.radixPoint&&(n=n.replace(t.escapeRegex(r.radixPoint),".")),n=n.replace(new RegExp("^"+t.escapeRegex(r.negationSymbol.front)),"-"),n=n.replace(new RegExp(t.escapeRegex(r.negationSymbol.back)+"$"),""),n=n===r.negationSymbol.front?n+"0":n,isFinite(n)&&(null!==r.max&&isFinite(r.max)&&(s=parseFloat(n)<=parseFloat(r.max)),s&&null!==r.min&&isFinite(r.min)&&(0>=n||n.toString().length>=r.min.toString().length)&&(s=parseFloat(n)>=parseFloat(r.min),s||(s=e.extend(!0,{refreshFromBuffer:!0,buffer:(r.prefix+r.min).split("")},r.postFormat((r.prefix+r.min).split(""),0,!0,r)),s.refreshFromBuffer=!0))),s},definitions:{"~":{validator:function(i,r,s,a,n){var o=n.signHandler(i,r,s,a,n);if(!o&&(o=n.radixHandler(i,r,s,a,n),!o&&(o=a?new RegExp("[0-9"+t.escapeRegex(n.groupSeparator)+"]").test(i):new RegExp("[0-9]").test(i),o===!0&&(o=n.leadingZeroHandler(i,r,s,a,n),o===!0)))){var l=e.inArray(n.radixPoint,r.buffer);o=-1!==l&&n.digitsOptional===!1&&n.numericInput!==!0&&s>l&&!a?{pos:s,remove:s}:{pos:s}}return o},cardinality:1,prevalidator:null},"+":{validator:function(e,t,i,r,s){var a=s.signHandler(e,t,i,r,s);return!a&&(r&&s.allowMinus&&e===s.negationSymbol.front||s.allowMinus&&"-"===e||s.allowPlus&&"+"===e)&&(a="-"===e?""!==s.negationSymbol.back?{
pos:i,c:"-"===e?s.negationSymbol.front:"+",caret:i+1,insert:{pos:t.buffer.length,c:s.negationSymbol.back}}:{pos:i,c:"-"===e?s.negationSymbol.front:"+",caret:i+1}:!0),a},cardinality:1,prevalidator:null,placeholder:""},"-":{validator:function(e,t,i,r,s){var a=s.signHandler(e,t,i,r,s);return!a&&r&&s.allowMinus&&e===s.negationSymbol.back&&(a=!0),a},cardinality:1,prevalidator:null,placeholder:""},":":{validator:function(e,i,r,s,a){var n=a.signHandler(e,i,r,s,a);if(!n){var o="["+t.escapeRegex(a.radixPoint)+",\\.]";n=new RegExp(o).test(e),n&&i.validPositions[r]&&i.validPositions[r].match.placeholder===a.radixPoint&&(n={caret:r+1})}return n?{c:a.radixPoint}:n},cardinality:1,prevalidator:null,placeholder:function(e){return e.radixPoint}}},onUnMask:function(e,i,r){var s=e.replace(r.prefix,"");return s=s.replace(r.suffix,""),s=s.replace(new RegExp(t.escapeRegex(r.groupSeparator),"g"),""),r.unmaskAsNumber?(""!==r.radixPoint&&-1!==s.indexOf(r.radixPoint)&&(s=s.replace(t.escapeRegex.call(this,r.radixPoint),".")),Number(s)):s},isComplete:function(e,i){var r=e.join(""),s=e.slice();if(i.postFormat(s,0,!0,i),s.join("")!==r)return!1;var a=r.replace(i.prefix,"");return a=a.replace(i.suffix,""),a=a.replace(new RegExp(t.escapeRegex(i.groupSeparator),"g"),""),","===i.radixPoint&&(a=a.replace(t.escapeRegex(i.radixPoint),".")),isFinite(a)},onBeforeMask:function(e,i){if(""!==i.radixPoint&&isFinite(e))e=e.toString().replace(".",i.radixPoint);else{var r=e.match(/,/g),s=e.match(/\./g);s&&r?s.length>r.length?(e=e.replace(/\./g,""),e=e.replace(",",i.radixPoint)):r.length>s.length?(e=e.replace(/,/g,""),e=e.replace(".",i.radixPoint)):e=e.indexOf(".")<e.indexOf(",")?e.replace(/\./g,""):e=e.replace(/,/g,""):e=e.replace(new RegExp(t.escapeRegex(i.groupSeparator),"g"),"")}if(0===i.digits&&(-1!==e.indexOf(".")?e=e.substring(0,e.indexOf(".")):-1!==e.indexOf(",")&&(e=e.substring(0,e.indexOf(",")))),""!==i.radixPoint&&isFinite(i.digits)&&-1!==e.indexOf(i.radixPoint)){var a=e.split(i.radixPoint),n=a[1].match(new RegExp("\\d*"))[0];if(parseInt(i.digits)<n.toString().length){var o=Math.pow(10,parseInt(i.digits));e=e.replace(t.escapeRegex(i.radixPoint),"."),e=Math.round(parseFloat(e)*o)/o,e=e.toString().replace(".",i.radixPoint)}}return e.toString()},canClearPosition:function(i,r,s,a,n){var o=i.validPositions[r].input,l=o!==n.radixPoint||null!==i.validPositions[r].match.fn&&n.decimalProtect===!1||isFinite(o)||r===s||o===n.groupSeparator||o===n.negationSymbol.front||o===n.negationSymbol.back;if(l&&isFinite(o)){var c,d=e.inArray(n.radixPoint,i.buffer),h=!1;if(void 0===i.validPositions[d]&&(i.validPositions[d]={input:n.radixPoint},h=!0),!a&&i.buffer){c=i.buffer.join("").substr(0,r).match(n.regex.integerNPart(n));var u=r+1,p=null==c||0===parseInt(c[0].replace(new RegExp(t.escapeRegex(n.groupSeparator),"g"),""));if(p)for(;i.validPositions[u]&&(i.validPositions[u].input===n.groupSeparator||"0"===i.validPositions[u].input);)delete i.validPositions[u],u++}var f=[];for(var m in i.validPositions)void 0!==i.validPositions[m].input&&f.push(i.validPositions[m].input);if(h&&delete i.validPositions[d],d>0){var g=f.join("");if(c=g.match(n.regex.integerNPart(n)))if(d>=r)if(0===c[0].indexOf("0"))l=c.index!==r||"0"===n.placeholder;else{var v=parseInt(c[0].replace(new RegExp(t.escapeRegex(n.groupSeparator),"g"),"")),b=parseInt(g.split(n.radixPoint)[1]);10>v&&i.validPositions[r]&&("0"!==n.placeholder||b>0)&&(i.validPositions[r].input="0",i.p=n.prefix.length+1,l=!1)}else 0===c[0].indexOf("0")&&3===g.length&&(i.validPositions={},l=!1)}}return l},onKeyDown:function(i,r,s,a){var n=e(this);if(i.ctrlKey)switch(i.keyCode){case t.keyCode.UP:n.val(parseFloat(this.inputmask.unmaskedvalue())+parseInt(a.step)),n.trigger("setvalue.inputmask");break;case t.keyCode.DOWN:n.val(parseFloat(this.inputmask.unmaskedvalue())-parseInt(a.step)),n.trigger("setvalue.inputmask")}}},currency:{prefix:"$ ",groupSeparator:",",alias:"numeric",placeholder:"0",autoGroup:!0,digits:2,digitsOptional:!1,clearMaskOnLostFocus:!1},decimal:{alias:"numeric"},integer:{alias:"numeric",digits:0,radixPoint:""},percentage:{alias:"numeric",digits:2,radixPoint:".",placeholder:"0",autoGroup:!1,min:0,max:100,suffix:" %",allowPlus:!1,allowMinus:!1}}),t}(jQuery,Inputmask),function(e,t){return t.extendAliases({phone:{url:"phone-codes/phone-codes.js",countrycode:"",mask:function(t){t.definitions["#"]=t.definitions[9];var i=[];return e.ajax({url:t.url,async:!1,dataType:"json",success:function(e){i=e},error:function(e,i,r){alert(r+" - "+t.url)}}),i=i.sort(function(e,t){return(e.mask||e)<(t.mask||t)?-1:1})},keepStatic:!1,nojumps:!0,nojumpsThreshold:1,onBeforeMask:function(e,t){var i=e.replace(/^0/g,"");return(i.indexOf(t.countrycode)>1||-1===i.indexOf(t.countrycode))&&(i="+"+t.countrycode+i),i}},phonebe:{alias:"phone",url:"phone-codes/phone-be.js",countrycode:"32",nojumpsThreshold:4}}),t}(jQuery,Inputmask),function(e,t){return t.extendAliases({Regex:{mask:"r",greedy:!1,repeat:"*",regex:null,regexTokens:null,tokenizer:/\[\^?]?(?:[^\\\]]+|\\[\S\s]?)*]?|\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9][0-9]*|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|c[A-Za-z]|[\S\s]?)|\((?:\?[:=!]?)?|(?:[?*+]|\{[0-9]+(?:,[0-9]*)?\})\??|[^.?*+^${[()|\\]+|./g,quantifierFilter:/[0-9]+[^,]/,isComplete:function(e,t){return new RegExp(t.regex).test(e.join(""))},definitions:{r:{validator:function(t,i,r,s,a){function n(e,t){this.matches=[],this.isGroup=e||!1,this.isQuantifier=t||!1,this.quantifier={min:1,max:1},this.repeaterPart=void 0}function o(){var e,t,i=new n,r=[];for(a.regexTokens=[];e=a.tokenizer.exec(a.regex);)switch(t=e[0],t.charAt(0)){case"(":r.push(new n(!0));break;case")":c=r.pop(),r.length>0?r[r.length-1].matches.push(c):i.matches.push(c);break;case"{":case"+":case"*":var s=new n(!1,!0);t=t.replace(/[{}]/g,"");var o=t.split(","),l=isNaN(o[0])?o[0]:parseInt(o[0]),d=1===o.length?l:isNaN(o[1])?o[1]:parseInt(o[1]);if(s.quantifier={min:l,max:d},r.length>0){var h=r[r.length-1].matches;e=h.pop(),e.isGroup||(c=new n(!0),c.matches.push(e),e=c),h.push(e),h.push(s)}else e=i.matches.pop(),e.isGroup||(c=new n(!0),c.matches.push(e),e=c),i.matches.push(e),i.matches.push(s);break;default:r.length>0?r[r.length-1].matches.push(t):i.matches.push(t)}i.matches.length>0&&a.regexTokens.push(i)}function l(t,i){var r=!1;i&&(h+="(",p++);for(var s=0;s<t.matches.length;s++){var a=t.matches[s];if(a.isGroup===!0)r=l(a,!0);else if(a.isQuantifier===!0){var n=e.inArray(a,t.matches),o=t.matches[n-1],c=h;if(isNaN(a.quantifier.max)){for(;a.repeaterPart&&a.repeaterPart!==h&&a.repeaterPart.length>h.length&&!(r=l(o,!0)););r=r||l(o,!0),r&&(a.repeaterPart=h),h=c+a.quantifier.max}else{for(var d=0,u=a.quantifier.max-1;u>d&&!(r=l(o,!0));d++);h=c+"{"+a.quantifier.min+","+a.quantifier.max+"}"}}else if(void 0!==a.matches)for(var m=0;m<a.length&&!(r=l(a[m],i));m++);else{var g;if("["==a.charAt(0)){g=h,g+=a;for(var v=0;p>v;v++)g+=")";var b=new RegExp("^("+g+")$");r=b.test(f)}else for(var k=0,y=a.length;y>k;k++)if("\\"!==a.charAt(k)){g=h,g+=a.substr(0,k+1),g=g.replace(/\|$/,"");for(var v=0;p>v;v++)g+=")";var b=new RegExp("^("+g+")$");if(r=b.test(f))break}h+=a}if(r)break}return i&&(h+=")",p--),r}var c,d=i.buffer.slice(),h="",u=!1,p=0;null===a.regexTokens&&o(),d.splice(r,0,t);for(var f=d.join(""),m=0;m<a.regexTokens.length;m++){var g=a.regexTokens[m];if(u=l(g,g.isGroup))break}return u},cardinality:1}}}}),t}(jQuery,Inputmask),function(e){"use strict";function t(e,i){return new t.prototype.init(e,i)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var i=0;e.fn.redactor=function(i){var r=[],s=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t,a=e.data(this,"redactor");if("-1"!=i.search(/\./)?(t=i.split("."),"undefined"!=typeof a[t[0]]&&(t=a[t[0]][t[1]])):t=a[i],"undefined"!=typeof a&&e.isFunction(t)){var n=t.apply(a,s);void 0!==n&&n!==a&&r.push(n)}else e.error('No such method "'+i+'" for Redactor')}):this.each(function(){e.data(this,"redactor",{}),e.data(this,"redactor",t(this,i))}),0===r.length?this:1===r.length?r[0]:r},e.Redactor=t,e.Redactor.VERSION="10.2.5",e.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],e.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"],["b","strong"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],highContrast:!1,observe:{dropdowns:[]},langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:!1},t.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(t,r){if(this.$element=e(t),this.uuid=i++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(r),this.loadModules(),this.formatting={},e.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),this.opts.deniedTags!==!1)for(var s=["html","head","link","body","meta","applet"],a=0;a<s.length;a++)this.opts.deniedTags.push(s[a]);this.lang.load(),e.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(t){this.opts=e.extend({},e.extend(!0,{},e.Redactor.opts),this.$element.data(),t)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]})},loadModules:function(){for(var t=e.Redactor.modules.length,i=0;t>i;i++)this.bindModuleMethods(e.Redactor.modules[i])},bindModuleMethods:function(e){if("undefined"!=typeof this[e]){this[e]=this[e]();for(var t=this.getModuleMethods(this[e]),i=t.length,r=0;i>r;r++)this[e][t[r]]=this[e][t[r]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(e){this.utils.browser("msie")||this.opts.linebreaks||this.$editor.focus(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=e,this.buffer.set(),this.selection.save(),this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){e.each(this.alignment.blocks,e.proxy(function(e,t){var i=this.utils.getAlignmentElement(t);i&&(this.alignment.isNeedReplaceElement(i)?this.alignment.replaceElement(i):this.alignment.alignElement(i))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(e){return""===this.alignment.type&&"undefined"!=typeof e.data("tagblock")},replaceElement:function(e){e.replaceWith(e.html())},alignElement:function(e){e.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(e,"style")}}},autosave:function(){return{html:!1,enable:function(){this.opts.autosave&&(this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var t={};t.name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t);var i=e.ajax({url:this.opts.autosave,type:"post",data:t});i.done(this.autosave.success)}},getHiddenFields:function(t){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?t:(e.each(this.opts.autosaveFields,e.proxy(function(i,r){null!==r&&0===r.toString().indexOf("#")&&(r=e(r).val()),t[i]=r},this)),t)},success:function(t){var i;try{i=e.parseJSON(t)}catch(r){i=t}var s="undefined"==typeof i.error?"autosave":"autosaveError";this.core.setCallback(s,this.autosave.name,i),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(e){this.block.clearStyle=!1;var t,i;"undefined"!=typeof this.formatting[e].data?t="data":"undefined"!=typeof this.formatting[e].attr?t="attr":"undefined"!=typeof this.formatting[e]["class"]&&(t="class"),"undefined"!=typeof this.formatting[e].clear&&(this.block.clearStyle=!0),t&&(i=this.formatting[e][t]),this.block.format(this.formatting[e].tag,t,i)},format:function(t,i,r){"quote"==t&&(t="blockquote");var s=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if(-1!=e.inArray(t,s)){this.block.isRemoveInline="pre"==t||-1!=t.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus();var a=e.trim(this.$editor.html());if(this.block.isEmpty=this.utils.isEmpty(a),this.utils.browser("mozilla")&&!this.focus.isFocused()&&this.block.isEmpty){var n;this.opts.linebreaks||(n=this.$editor.children().first(),this.caret.setEnd(n))}this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=i,this.block.value=r,this.buffer.set(),this.selection.save(),this.block.set(t),this.selection.restore(),this.code.sync(),this.observe.load()}},set:function(e){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(e):this.block.setMultiple(e)},setCollapsed:function(t){if(this.opts.linebreaks&&this.block.isEmpty&&"p"!=t){var i=document.createElement(t);return this.$editor.html(i),void this.caret.setEnd(i)}var r=this.block.blocks[0];if(r!==!1){if("LI"==r.tagName){if("blockquote"!=t)return;return void this.block.formatListToBlockquote()}var s="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(s&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+t+">"),r=this.selection.getBlock(),this.block.toggle(e(r));else if(r.tagName.toLowerCase()!=t)if(this.opts.linebreaks&&"p"==t)e(r).append("<br>"),this.utils.replaceWithContents(r);else{var a=this.utils.replaceToTag(r,t);this.block.toggle(a),"p"!=t&&"blockquote"!=t&&a.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(a),("p"==t||this.block.headTag)&&a.find("p").contents().unwrap(),this.block.formatTableWrapping(a)}else if("blockquote"==t&&r.tagName.toLowerCase()==t)if(this.opts.linebreaks)e(r).append("<br>"),this.utils.replaceWithContents(r);else{var n=this.utils.replaceToTag(r,"p");this.block.toggle(n)}else r.tagName.toLowerCase()==t&&this.block.toggle(e(r));"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&e(r).removeAttr("class").removeAttr("style")}},setMultiple:function(t){var i=this.block.blocks[0],r="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(i!==!1&&1===this.block.blocksSize)if(i.tagName.toLowerCase()==t&&"blockquote"==t)if(this.opts.linebreaks)e(i).append("<br>"),this.utils.replaceWithContents(i);else{var s=this.utils.replaceToTag(i,"p");this.block.toggle(s)}else if("LI"==i.tagName){if("blockquote"!=t)return;this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(t);else if(this.opts.linebreaks&&(r||this.range.commonAncestorContainer!=i))this.block.formatWrap(t);else if(this.opts.linebreaks&&"p"==t)e(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i);else if("TD"===i.tagName)this.block.formatWrap(t);else{var a=this.utils.replaceToTag(i,t);this.block.toggle(a),this.block.isRemoveInline&&this.utils.removeInlineTags(a),("p"==t||this.block.headTag)&&a.find("p").contents().unwrap()}else if(this.opts.linebreaks||"p"!=t){if("blockquote"==t){for(var n=0,o=0;o<this.block.blocksSize;o++)"BLOCKQUOTE"==this.block.blocks[o].tagName&&n++;if(n==this.block.blocksSize)return void e.each(this.block.blocks,e.proxy(function(t,i){var r=!1;this.opts.linebreaks?(e(i).prepend("<br>").append("<br>"),r=this.utils.replaceWithContents(i)):r=this.utils.replaceToTag(i,"p"),r&&"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&r.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(t)}else{var l=0,c=!1;"class"==this.block.type&&(c="toggle",l=e(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==l?c="toggle":this.block.blocksSize>l?c="set":0===l&&(c="set"));var d=["ul","ol","li","td","th","dl","dt","dd"];e.each(this.block.blocks,e.proxy(function(i,r){if(-1==e.inArray(r.tagName.toLowerCase(),d)){var s=this.utils.replaceToTag(r,t);c?"toggle"==c?this.block.toggle(s):"remove"==c?this.block.remove(s):"set"==c&&this.block.setForce(s):this.block.toggle(s),"p"!=t&&"blockquote"!=t&&s.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(s),("p"==t||this.block.headTag)&&s.find("p").contents().unwrap(),"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&s.removeAttr("class").removeAttr("style")}},this))}},setForce:function(e){return this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?void e.addClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void e.attr(this.block.value.name,this.block.value.value):void 0},toggle:function(e){return this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?void e.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void(e.attr(this.block.value.name)==this.block.value.value?e.removeAttr(this.block.value.name):e.attr(this.block.value.name,this.block.value.value)):void e.removeAttr("style class")},remove:function(e){e.removeClass(this.block.value)},formatListToBlockquote:function(){var t=e(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);e(t).find("ul, ol").contents().unwrap(),e(t).find("li").append(e("<br>")).contents().unwrap();var i=this.utils.replaceToTag(t,"blockquote");this.block.toggle(i)},formatBlockquote:function(t){document.execCommand("outdent"),document.execCommand("formatblock",!1,t),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var i=this.selection.getBlock();"p"!=t&&e(i).find("img").remove(),this.opts.linebreaks||this.block.toggle(e(i)),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==t&&this.utils.replaceWithContents(i)},formatWrap:function(t){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=t)return;this.block.formatListToBlockquote()}var i=this.selection.wrap(t);if(i!==!1){var r=e(i);this.block.formatTableWrapping(r);var s=r.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");if(s.contents().unwrap(),"p"!=t&&"blockquote"!=t&&r.find("img").remove(),e.each(this.block.blocks,e.proxy(this.utils.removeEmpty,this)),r.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(r),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),r.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(r),this.opts.linebreaks&&"p"==t&&this.utils.replaceWithContents(r),this.opts.linebreaks){var a=r.next().next();0!=a.size()&&"BR"===a[0].tagName&&a.remove()}}},formatTableWrapping:function(e){0!==e.closest("table",this.$editor[0]).length&&(0===e.closest("tr",this.$editor[0]).length&&e.wrap("<tr>"),0===e.closest("td",this.$editor[0]).length&&0===e.closest("th").length&&e.wrap("<td>"))},removeData:function(t,i){var r=this.selection.getBlocks();e(r).removeAttr("data-"+t),this.code.sync()},setData:function(t,i){var r=this.selection.getBlocks();e(r).attr("data-"+t,i),this.code.sync()},toggleData:function(t,i){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr("data-"+t)?e(this).removeAttr("data-"+t):e(this).attr("data-"+t,i)})},removeAttr:function(t,i){var r=this.selection.getBlocks();e(r).removeAttr(t),this.code.sync()},setAttr:function(t,i){var r=this.selection.getBlocks();e(r).attr(t,i),this.code.sync()},toggleAttr:function(t,i){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr(name)?e(this).removeAttr(name):e(this).attr(name,i)})},removeClass:function(t){var i=this.selection.getBlocks();e(i).removeClass(t),this.utils.removeEmptyAttr(i,"class"),this.code.sync()},setClass:function(t){var i=this.selection.getBlocks();e(i).addClass(t),this.code.sync()},toggleClass:function(t){var i=this.selection.getBlocks();e(i).toggleClass(t),this.code.sync()}}},buffer:function(){return{set:function(e){"undefined"==typeof e||"undo"==e?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50))}}},build:function(){return{focused:!1,blured:!0,run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=e('<div class="redactor-box" role="application" />')},createTextarea:function(){this.$textarea=e("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var t=this.build.isTextarea()?"val":"html";this.content=e.trim(this.$element[t]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var e=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[e]()},fromTextarea:function(){this.$editor=e("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout(e.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.disableIeLinks(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(e.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){e(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(e){if(e.preventDefault(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){var t=e.dataTransfer.files;this.upload.directUpload(t[0],e)}},setEventDrop:function(e){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},setEvents:function(){this.$editor.on("dragover.redactor dragenter.redactor",function(e){e.preventDefault(),e.stopPropagation()}),this.$editor.on("drop.redactor",e.proxy(function(e){return e=e.originalEvent||e,void 0!==window.FormData&&e.dataTransfer?0===e.dataTransfer.files.length?this.build.setEventDrop(e):(this.build.setEventDropUpload(e),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",e)):!0},this)),this.$editor.on("click.redactor",e.proxy(function(e){var t=this.core.getEvent(),i="click"==t||"arrow"==t?!1:"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.setCallback("click",e)},this)),this.$editor.on("paste.redactor",e.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",e.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",e.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",e.proxy(this.keyup.init,this)),e.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",e.proxy(this.opts.codeKeydownCallback,this)),e.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",e.proxy(this.opts.codeKeyupCallback,this)),this.$editor.on("focus.redactor",e.proxy(function(t){e.isFunction(this.opts.focusCallback)&&this.core.setCallback("focus",t),this.build.focused=!0,this.build.blured=!1,this.selection.getCurrent()===!1&&(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),this.selection.addRange())},this)),e(document).on("mousedown.redactor-blur."+this.uuid,e.proxy(function(t){this.start||this.rtePaste||0===e(t.target).closest(".redactor-editor, .redactor-toolbar, .redactor-dropdown").size()&&(this.utils.disableSelectAll(),!this.build.blured&&e.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",t),this.build.focused=!1,this.build.blured=!0)},this))},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&e.each(this.opts.plugins,e.proxy(function(i,r){var s="undefined"!=typeof RedactorPlugins&&"undefined"!=typeof RedactorPlugins[r]?RedactorPlugins:t.fn;if(e.isFunction(s[r])){this[r]=s[r]();for(var a=this.getModuleMethods(this[r]),n=a.length,o=0;n>o;o++)this[r][a[o]]=this[r][a[o]].bind(this);e.isFunction(this[r].init)&&this[r].init()}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}},disableIeLinks:function(){this.utils.browser("msie")&&document.execCommand("AutoUrlDetect",!1,!1)}}},button:function(){return{build:function(t,i){var r=e('<a href="#" class="re-icon re-'+t+'" rel="'+t+'" />').attr({role:"button",
"aria-label":i.title,tabindex:"-1"});if((i.func||i.command||i.dropdown)&&this.button.setEvent(r,t,i),i.dropdown){r.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var s=e('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">');r.data("dropdown",s),this.dropdown.build(t,s,i.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(r,t,i.title),r},setEvent:function(t,i,r){t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;var s="func",a=r.func;r.command?(s="command",a=r.command):r.dropdown&&(s="dropdown",a=!1),this.button.onClick(e,i,s,a)},this))},createTooltip:function(t,i,r){var s=e("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+this.uuid+" redactor-toolbar-tooltip-"+i).hide().html(r);s.appendTo("body"),t.on("mouseover",function(){if(!e(this).hasClass("redactor-button-disabled")){var i=t.offset();s.css({top:i.top+t.innerHeight()+"px",left:i.left+t.innerWidth()/2-s.innerWidth()/2+"px"}),s.show()}}),t.on("mouseout",function(){s.hide()})},onClick:function(t,i,r,s){this.button.caretOffset=this.caret.getOffset(),t.preventDefault(),e(document).find(".redactor-toolbar-tooltip").hide(),this.utils.browser("msie")&&(t.returnValue=!1),"command"==r?this.inline.format(s):"dropdown"==r?this.dropdown.show(t,i):this.button.onClickCallback(t,s,i)},onClickCallback:function(t,i,r){var s;if(e.isFunction(i))i.call(this,r);else if("-1"!=i.search(/\./)){if(s=i.split("."),"undefined"==typeof this[s[0]])return;this[s[0]][s[1]](r)}else this[i](r);this.observe.buttons(t,r)},get:function(e){return this.$toolbar.find("a.re-"+e)},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){"undefined"==typeof e?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+e).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html, a.re-fullscreen").addClass("redactor-button-disabled")},changeIcon:function(e,t){this.button.get(e).addClass("re-"+t)},removeIcon:function(e,t){this.button.get(e).removeClass("re-"+t)},setAwesome:function(e,t){var i=this.button.get(e);i.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),i.html('<i class="fa '+t+'"></i>')},addCallback:function(t,i){if("buffer"!=t){var r="dropdown"==i?"dropdown":"func",s=t.attr("rel");t.on("touchstart click",e.proxy(function(e){return t.hasClass("redactor-button-disabled")?!1:void this.button.onClick(e,s,r,i)},this))}},addDropdown:function(t,i){t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var r=t.attr("rel");this.button.addCallback(t,"dropdown");var s=e('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+r+'" style="display: none;">');return t.data("dropdown",s),i&&this.dropdown.build(r,s,i),s},add:function(t,i){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(t))return"buffer";var r=this.button.build(t,{title:i});return r.addClass("redactor-btn-image"),this.$toolbar.append(e("<li>").append(r)),r}},addFirst:function(t,i){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(t))return"buffer";var r=this.button.build(t,{title:i});return r.addClass("redactor-btn-image"),this.$toolbar.prepend(e("<li>").append(r)),r}},addAfter:function(t,i,r){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(i))return"buffer";var s=this.button.build(i,{title:r});s.addClass("redactor-btn-image");var a=this.button.get(t);return 0!==a.length?a.parent().after(e("<li>").append(s)):this.$toolbar.append(e("<li>").append(s)),s}},addBefore:function(t,i,r){if(this.opts.toolbar){if(this.button.isMobileUndoRedo(i))return"buffer";var s=this.button.build(i,{title:r});s.addClass("redactor-btn-image");var a=this.button.get(t);return 0!==a.length?a.parent().before(e("<li>").append(s)):this.$toolbar.append(e("<li>").append(s)),s}},remove:function(e){this.button.get(e).remove()},isMobileUndoRedo:function(e){return("undo"==e||"redo"==e)&&!this.utils.isDesktop()}}},caret:function(){return{setStart:function(t){if(this.utils.isBlock(t))this.caret.set(t,0,t,0);else{var i=this.utils.createSpaceElement();e(t).prepend(i),this.caret.setEnd(i)}},setEnd:function(e){return e=e[0]||e,1==e.lastChild.nodeType?this.caret.setAfter(e.lastChild):void this.caret.set(e,1,e,1)},set:function(t,i,r,s){if(t=t[0]||t,r=r[0]||r,this.utils.isBlockTag(t.tagName)&&""===t.innerHTML&&(t.innerHTML=this.opts.invisibleSpace),"BR"==t.tagName&&this.opts.linebreaks===!1){var a=e(this.opts.emptyHtml)[0];e(t).replaceWith(a),t=a,r=t}this.selection.get();try{this.range.setStart(t,i),this.range.setEnd(r,s)}catch(n){}this.selection.addRange()},setAfter:function(t){try{var i=e(t)[0].tagName;if("BR"==i||this.utils.isBlock(t))"BR"!=i&&this.utils.browser("msie")?this.caret.setStart(e(t).next()):this.caret.setAfterOrBefore(t,"after");else{var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}}catch(s){var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}},setBefore:function(t){this.utils.isBlock(t)?this.caret.setEnd(e(t).prev()):this.caret.setAfterOrBefore(t,"before")},setAfterOrBefore:function(e,t){if(this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,this.selection.get(),"after"==t)try{this.range.setStartAfter(e),this.range.setEndAfter(e)}catch(i){}else try{this.range.setStartBefore(e),this.range.setEndBefore(e)}catch(i){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(t){t=t[0]||t,this.selection.get();var i=this.range.cloneRange();return i.selectNodeContents(t),i.setEnd(this.range.endContainer,this.range.endOffset),e.trim(i.toString()).length},getOffset:function(){var e=0,t=window.getSelection();if(t.rangeCount>0){var i=window.getSelection().getRangeAt(0),r=i.cloneRange();r.selectNodeContents(this.$editor[0]),r.setEnd(i.endContainer,i.endOffset),e=r.toString().length}return e},setOffset:function(e,t){"undefined"==typeof t&&(t=e),this.focus.isFocused()||this.focus.setStart();for(var i,r=(this.selection.get(),0),s=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);i=s.nextNode();)if(r+=i.nodeValue.length,r>e&&(this.range.setStart(i,i.nodeValue.length+e-r),e=1/0),r>=t){this.range.setEnd(i,i.nodeValue.length+t-r);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(e,t){this.caret.setOffset(e,t)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&!this.opts.linebreaks&&(t=this.clean.replaceDivs(t)),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.saveFormTags(t);var i=e("<div>");i.html(t);var r=i.find("font[style]");return 0!==r.length&&(r.replaceWith(function(){var t=e(this),i=e("<span>").attr("style",t.attr("style"));return i.append(t.contents())}),t=i.html()),i.remove(),t=t.replace(/<font(.*?)>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.setVerified(t),t=this.clean.convertInline(t),t=t.replace(/&amp;/g,"&")},onSync:function(t){if(t=t.replace(/\u200B/g,""),t=t.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(t=t.replace(/&nbsp;/gi," ")),-1!=t.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";t=t.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),t=this.clean.restoreFormTags(t);var i={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};e.each(i,function(e,i){t=t.replace(new RegExp(e,"g"),i)}),this.utils.browser("mozilla")&&(t=t.replace(/<br\s?\/?>$/gi,"")),t=t.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),t=t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),t=t.replace(/<(.*?)rel="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),t=t.replace(/<(.*?)style="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),t=t.replace(/="">/gi,">"),t=t.replace(/""">/gi,'">'),t=t.replace(/"">/gi,'">'),t=t.replace(/<div(.*?)data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>"),t=t.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");var r=e("<div/>").html(e.parseHTML(t,document,!0));return r.find("span").removeAttr("rel"),r.find("pre .redactor-invisible-space").each(function(){e(this).contents().unwrap()}),t=r.html(),t=t.replace(/<img(.*?[^>])rel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>"),t=t.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1"),t=t.replace(/ data-save-url="(.*?[^>])"/gi,""),t=t.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),t=t.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<font(.*?)>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.linkNofollow&&(t=t.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),t=t.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),t=t.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),t=t.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),t=t.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>"),t=t.replace(/&amp;/g,"&")},onPaste:function(t,i){if(t=e.trim(t),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<span class="s[0-9]">/gi,"<span>"),t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),t=t.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),t=t.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(t);if(!this.utils.isSelectAll()&&"undefined"==typeof i){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(t,!1);if(this.utils.isCurrentOrParent("PRE"))return t=t.replace(/”/g,'"'),t=t.replace(/“/g,'"'),t=t.replace(/‘/g,"'"),t=t.replace(/’/g,"'"),this.clean.getPreCode(t);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(t=this.clean.getOnlyImages(t),!this.utils.browser("msie")){var r=this.selection.getBlock();r&&"P"==r.tagName&&(t=t.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return t}if(this.utils.isCurrentOrParent(["TD"]))return t=this.clean.onPasteTidy(t,"td"),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.replaceDivsToBr(t);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(t,"li")}return t=this.clean.isSingleLine(t,i),this.clean.singleLine||(this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),t=this.clean.saveFormTags(t)),t=this.clean.onPasteWord(t),t=this.clean.onPasteExtra(t),t=this.clean.onPasteTidy(t,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.removeDirtyStyles(t),t=this.clean.onPasteRemoveSpans(t),t=this.clean.onPasteRemoveEmpty(t),t=this.clean.convertInline(t)},onPasteWord:function(t){if(t=t.replace(/<!--[\s\S]*?-->/gi,""),t=t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),t=t.replace(/<o\:p[^>]*>[\s\S]*?<\/o\:p>/gi,""),t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)){t=t.replace(/<!--[\s\S]+?-->/gi,""),t=t.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,""),t=t.replace(/<(\/?)s>/gi,"<$1strike>"),t=t.replace(/ /gi," "),t=t.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}),t=this.clean.onPasteIeFixLinks(t),t=t.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),t=t.replace(/src="file\:\/\/(.*?)"/,'src=""');var i=e("<div/>").html(t),r=!1,s=1,a=[];i.find("p[style]").each(function(){var t=e(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var n=parseInt(t[1]),o=parseInt(t[2]),l=e(this).html().match(/^[\w]+\./)?"ol":"ul",c=e("<li/>").html(e(this).html());if(c.html(c.html().replace(/^([\w\.]+)</,"<")),c.find("span:first").remove(),1==o&&-1==e.inArray(n,a)){var d=e("<"+l+"/>").attr({"data-level":o,"data-list":n}).html(c);e(this).replaceWith(d),r=n,a.push(n)}else{if(o>s){for(var h=i.find('[data-level="'+s+'"][data-list="'+r+'"]'),u=h,p=s;o>p;p++)d=e("<"+l+"/>"),d.appendTo(u.find("li").last()),u=d;u.attr({"data-level":o,"data-list":n}).html(c)}else{var h=i.find('[data-level="'+o+'"][data-list="'+n+'"]').last();h.append(c)}s=o,r=n,e(this).remove()}}}),i.find("[data-level][data-list]").removeAttr("data-level data-list"),t=i.html(),t=t.replace(/·/g,""),t=t.replace(/<p class="Mso(.*?)"/gi,"<p"),t=t.replace(/ class=\"(mso[^\"]*)\"/gi,""),t=t.replace(/ class=(mso\w+)/gi,""),t=t.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),t=t.replace(/\n/g," "),t=t.replace(/<p>\n?<li>/gi,"<li>")}return t},onPasteExtra:function(e){return e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=e.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),e=e.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),e=e.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),e=e.replace(/<img>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),e=e.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),e=e.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),e=e.replace(/<\/p>\s<p/gi,"</p><p"),e=e.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),e=e.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(e=e.replace(/<br\s?\/?>$/gi,"")),e},onPasteTidy:function(e,t){var i=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],r=!1,s=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];"all"==t?(r=["p","span","h1","h2","h3","h4","h5","h6"],s=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==t?i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==t&&(i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var a={deniedTags:this.opts.deniedTags?this.opts.deniedTags:!1,allowedTags:this.opts.allowedTags?this.opts.allowedTags:i,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr?this.opts.removeAttr:!1,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:s,removeEmpty:r};return this.tidy.load(e,a)},onPasteRemoveEmpty:function(e){return e=e.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(e=e.replace(/<br>$/i,"")),e},onPasteRemoveSpans:function(e){return e=e.replace(/<span>(.*?)<\/span>/gi,"$1"),e=e.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(t){if(!this.utils.browser("msie"))return t;var i=e.trim(t);return 0===i.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(t=t.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),t},isSingleLine:function(e,t){if(this.clean.singleLine=!1,!this.utils.isSelectAll()&&"undefined"==typeof t){var i=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),r=e.match(new RegExp("</("+i+")>","gi")),s=e.match(/<\/(p|div)>/gi);if(!r&&(null===s||s&&s.length<=1)){var a=e.match(/<br\s?\/?>/gi);a||(this.clean.singleLine=!0,e=e.replace(/<\/?(p|div)(.*?)>/gi,""))}}return e},stripTags:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(i,function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""})},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e),e=this.clean.restoreSelectionMarker(e)},savePreFormatting:function(t){var i=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==i&&e.each(i,e.proxy(function(e,i){var r=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);r[2]=r[2].replace(/<br\s?\/?>/g,"\n"),r[2]=r[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(r[2]=r[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(i,"<pre"+r[1]+">"+r[2]+"</pre>")},this)),t},saveCodeFormatting:function(t){var i=t.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null!==i&&e.each(i,e.proxy(function(e,i){var r=i.match(/<code(.*?)>([\w\W]*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(i,"<code"+r[1]+">"+r[2]+"</code>")},this)),t},restoreSelectionMarker:function(e){return e=e.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot; data-verified=&quot;redactor&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker" data-verified="redactor">​</span>')},getTextFromHtml:function(t){t=t.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var i=document.createElement("div");return i.innerHTML=t,t=i.textContent||i.innerText,e.trim(t)},getPlainText:function(e,t){return e=this.clean.getTextFromHtml(e),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/\n\n/g,"\n"),e=e.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof t&&!this.utils.browser("mozilla")&&(e=this.paragraphize.load(e)),e},getPreCode:function(e){return e=e.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),e=e.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),e=this.clean.getTextFromHtml(e),this.opts.preSpaces&&(e=e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),e=this.clean.encodeEntities(e)},getOnlyImages:function(e){return e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<([Ss]*?)>/gi,""),e=e.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(e){return e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<(.*?)>/gi,""),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(t){if(this.utils.browser("msie"))return t;var i=document.createElement("div");return i.innerHTML=t,this.clean.clearUnverifiedRemove(e(i)),t=i.innerHTML,e(i).remove(),t},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var e=this.$editor.find("h1, h2, h3, h4, h5, h6");e.find("span").removeAttr("style"),e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()}},clearUnverifiedRemove:function(t){t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),t.find("span").not('[data-verified="redactor"]').removeAttr("style"),t.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(t,i){var r=e(i);r.attr("style",r.attr("rel"))})},cleanEmptyParagraph:function(){},setVerified:function(e){if(this.utils.browser("msie"))return e;e=e.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),e=e.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var t=e.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(t)for(var i=t.length,r=0;i>r;r++)try{var s=t[r].replace(/style="(.*?)"/i,'style="$1" rel="$1"');e=e.replace(t[r],s)}catch(a){}return e},convertInline:function(t){var i=e("<div />").html(t),r=this.opts.inlineTags;return r.push("span"),i.find(r.join(",")).each(function(){var t=e(this),i=this.tagName.toLowerCase();t.attr("data-redactor-tag",i),"span"==i&&(t.attr("style")?t.attr("data-redactor-style",t.attr("style")):t.attr("class")&&t.attr("data-redactor-class",t.attr("class")))}),t=i.html(),i.remove(),t},normalizeLists:function(){this.$editor.find("li").each(function(t,i){var r=e(i).next();0===r.length||"UL"!=r[0].tagName&&"OL"!=r[0].tagName||e(i).append(r)})},removeSpaces:function(e){return e=e.replace(/\n/g,""),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g," "),e=e.replace(/[\s\n]*$/g," "),e=e.replace(/>\s{2,}</g,"> <"),e=e.replace(/\n\n/g,"\n"),e=e.replace(/\u200B/g,"")},replaceDivs:function(e){return this.opts.linebreaks?(e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),e=e.replace(/<div(.*?[^>])>/gi,""),e=e.replace(/<\/div>/gi,"")},replaceDivsToBr:function(e){return e=e.replace(/<div\s(.*?)>/gi,"<p>"),e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),e=e.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(e){return e=e.replace(/<p\s(.*?)>/gi,"<p>"),e=e.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),e=e.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(t){t=e.trim(t.toString()),t=this.clean.onSet(t),this.utils.browser("msie")&&(t=t.replace(/<span(.*?)id="selection-marker-(1|2)"(.*?)><\/span>/gi,"")),this.$editor.html(t),this.code.sync(),""!==t&&this.placeholder.remove(),setTimeout(e.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var e=this.$textarea.val();return this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.tabifier.get(e)},sync:function(){setTimeout(e.proxy(this.code.startSync,this),10)},startSync:function(){var e=this.$editor.html();this.code.syncCode&&this.code.syncCode==e||this.start&&""==e||(this.code.syncCode=e,e=this.core.setCallback("syncBefore",e),e=this.clean.onSync(e),this.$textarea.val(e),this.core.setCallback("sync",e),this.start===!1&&this.core.setCallback("change",e),this.start=!1,0==this.autosave.html&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(t,i){i.CodeMirror.setValue(e)}),this.autosave.onChange(),this.autosave.enable())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.selection.save(),this.code.offset=this.caret.getOffset();var t=e(window).scrollTop(),i=(this.$editor.innerWidth(),this.$editor.innerHeight());this.$editor.hide();var r=this.$textarea.val();this.modified=this.clean.removeSpaces(r),r=this.tabifier.get(r);var s=0,a=0,n=e("<div/>").append(e.parseHTML(this.clean.onSync(this.$editor.html()),document,!0)),o=n.find("span.redactor-selection-marker");if(o.length>0){var l=this.tabifier.get(n.html()).replace(/&amp;/g,"&");1==o.length?(s=this.utils.strpos(l,n.find("#selection-marker-1").prop("outerHTML")),a=s):2==o.length&&(s=this.utils.strpos(l,n.find("#selection-marker-1").prop("outerHTML")),a=this.utils.strpos(l,n.find("#selection-marker-2").prop("outerHTML"))-n.find("#selection-marker-1").prop("outerHTML").toString().length)}this.selection.removeMarkers(),this.$textarea.val(r),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(t,n){e(n).show(),n.CodeMirror.setValue(r),n.CodeMirror.setSize("100%",i),n.CodeMirror.refresh(),s==a?n.CodeMirror.setCursor(n.CodeMirror.posFromIndex(s).line,n.CodeMirror.posFromIndex(a).ch):n.CodeMirror.setSelection({line:n.CodeMirror.posFromIndex(s).line,ch:n.CodeMirror.posFromIndex(s).ch},{line:n.CodeMirror.posFromIndex(a).line,ch:n.CodeMirror.posFromIndex(a).ch}),n.CodeMirror.focus()}):(this.$textarea.height(i).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),e(window).scrollTop(t),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(s,a),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",r)},showVisual:function(){var e;if(!this.opts.visual){var t=0,i=0;if(this.opts.codemirror){var r;this.$textarea.next(".CodeMirror").each(function(s,a){r=a.CodeMirror.listSelections(),t=a.CodeMirror.indexFromPos(r[0].anchor),i=a.CodeMirror.indexFromPos(r[0].head),e=a.CodeMirror.getValue()})}else t=this.$textarea.get(0).selectionStart,i=this.$textarea.get(0).selectionEnd,e=this.$textarea.hide().val();if(t>i&&i>0){var s=i,a=t;t=s,i=a}if(t=this.code.enlargeOffset(e,t),i=this.code.enlargeOffset(e,i),e=e.substr(0,t)+this.selection.getMarkerAsHtml(1)+e.substr(t),i>t){var n=this.selection.getMarkerAsHtml(1).toString().length;e=e.substr(0,i+n)+this.selection.getMarkerAsHtml(2)+e.substr(i+n)}this.modified!==this.clean.removeSpaces(e)&&this.code.set(e),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(e)||this.placeholder.remove(),this.selection.restore(),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",e)}},textareaIndenting:function(e){if(9!==e.keyCode)return!0;var t=this.$textarea,i=t.get(0).selectionStart;return t.val(t.val().substring(0,i)+"	"+t.val().substring(t.get(0).selectionEnd)),t.get(0).selectionStart=t.get(0).selectionEnd=i+1,!1},enlargeOffset:function(e,t){var i=e.length,r=0;if(">"==e[t])r++;else for(var s=t;i>=s&&(r++,">"!=e[s]);s++)if("<"==e[s]||s==i){r=0;break}return t+r}}},core:function(){return{getObject:function(){return e.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},setCallback:function(t,i,r){var s=t+"Callback",a="redactor",n=this.opts[s];if(this.$textarea){var o=!1,l=e._data(this.$textarea[0],"events");if("undefined"!=typeof l&&"undefined"!=typeof l[s]&&e.each(l[s],e.proxy(function(e,t){if(t.namespace==a){var r="undefined"==typeof r?[i]:[i,r];o="undefined"==typeof r?t.handler.call(this,i):t.handler.call(this,i,r)}},this)),o)return o}return e.isFunction(n)?"undefined"==typeof r?n.call(this,i):n.call(this,i,r):"undefined"==typeof r?i:r},destroy:function(){this.opts.destroyed=!0,this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),e(document).off("mousedown.redactor-blur."+this.uuid),e(document).off("mousedown.redactor."+this.uuid),e(document).off("click.redactor-image-delete."+this.uuid),e(document).off("click.redactor-image-resize-hide."+this.uuid),e(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),e("body").off("scroll.redactor."+this.uuid),e(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var t=this.code.get();this.opts.toolbar&&this.$toolbar.find("a").each(function(){var t=e(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(t).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(t).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),e(".redactor-toolbar-tooltip-"+this.uuid).remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(t,i,r){"formatting"==t&&this.opts.formattingAdd&&e.each(this.opts.formattingAdd,e.proxy(function(e,t){var i,s=t.tag;"undefined"!=typeof t["class"]&&(s=s+"-"+t["class"]),t.type=this.utils.isBlockTag(t.tag)?"block":"inline",i="undefined"!=typeof t.func?t.func:"inline"==t.type?"inline.formatting":"block.formatting",this.opts.linebreaks&&"block"==t.type&&"p"==t.tag||(this.formatting[s]={tag:t.tag,style:t.style,"class":t["class"],attr:t.attr,data:t.data,clear:t.clear},r[s]={func:i,title:t.title})},this)),e.each(r,e.proxy(function(r,s){var a=e('<a href="#" class="redactor-dropdown-'+r+'" role="button">'+s.title+"</a>");"formatting"==t&&a.addClass("redactor-formatting-"+r),a.on("click",e.proxy(function(t){t.preventDefault();var i="func",a=s.func;s.command?(i="command",a=s.command):s.dropdown&&(i="dropdown",a=s.dropdown),e(t.target).hasClass("redactor-dropdown-link-inactive")||(this.button.onClick(t,r,i,a),this.dropdown.hideAll())},this)),this.observe.addDropdown(a,r,s),i.append(a)},this))},show:function(t,i){if(!this.opts.visual)return t.preventDefault(),!1;var r=this.button.get(i),s=r.data("dropdown").appendTo(document.body);if(this.opts.highContrast&&s.addClass("redactor-dropdown-contrast"),r.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.observe.dropdowns(),this.core.setCallback("dropdownShow",{dropdown:s,key:i,button:r}),this.button.setActive(i),r.addClass("dropact");var a=r.offset(),n=s.width();a.left+n>e(document).width()&&(a.left=Math.max(0,a.left-n));var o=a.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var l=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,c="fixed";this.opts.toolbarFixedTarget!==document&&(l=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,c="absolute"),s.css({position:c,left:o,top:l+"px"}).show()}else{var l=r.innerHeight()+a.top+"px";s.css({position:"absolute",left:o,top:l}).show()}this.core.setCallback("dropdownShown",{dropdown:s,key:i,button:r}),this.$dropdown=s}e(document).one("click.redactor-dropdown",e.proxy(this.dropdown.hide,this)),this.$editor.one("click.redactor-dropdown",e.proxy(this.dropdown.hide,this)),e(document).one("keyup.redactor-dropdown",e.proxy(this.dropdown.closeHandler,this)),s.on("mouseover.redactor-dropdown",e.proxy(this.utils.disableBodyScroll,this)).on("mouseout.redactor-dropdown",e.proxy(this.utils.enableBodyScroll,this)),t.stopPropagation()},closeHandler:function(e){e.which==this.keyCode.ESC&&(this.dropdown.hideAll(),this.$editor.focus())},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),this.utils.enableBodyScroll(),e(".redactor-dropdown-"+this.uuid).hide(),e(".redactor-dropdown-link-selected").removeClass("redactor-dropdown-link-selected"),
this.$dropdown&&(this.$dropdown.off(".redactor-dropdown"),this.core.setCallback("dropdownHide",this.$dropdown),this.$dropdown=!1)},hide:function(t){var i=e(t.target);i.hasClass("dropact")||i.hasClass("redactor-dropdown-link-inactive")||(i.hasClass("redactor-dropdown")&&(i.removeClass("dropact"),i.off("mouseover mouseout")),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var t=this.sel.toString();e("#redactor-filename").val(t),this.modal.show()},insert:function(t,i,r){if("undefined"!=typeof t.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("fileUploadError",t);var s;if("string"==typeof t)s=t;else{var a=e("#redactor-filename").val();("undefined"==typeof a||""===a)&&(a=t.filename),s='<a href="'+t.filelink+'" id="filelink-marker">'+a+"</a>"}if(i){this.selection.removeMarkers();var n=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,n)}else this.modal.close();if(this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(s),"string"!=typeof t){var o=e(this.$editor.find("a#filelink-marker"));0!==o.length?o.removeAttr("id").removeAttr("style"):o=!1,this.core.setCallback("fileUpload",o,t)}}}},focus:function(){return{setStart:function(){this.$editor.focus();var e=this.$editor.children().first();if(0!==e.length&&0!==e[0].length&&"BR"!=e[0].tagName&&3!=e[0].nodeType){if("UL"==e[0].tagName||"OL"==e[0].tagName){var t=e.find("li").first();if(!this.utils.isBlock(t)&&""===t.text())return void this.caret.setStart(t)}return this.opts.linebreaks&&!this.utils.isBlockTag(e[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange()):void this.caret.setStart(e)}},setEnd:function(){var e=this.$editor.children().last();this.$editor.focus(),0!==e.size()&&(this.utils.isEmpty(this.$editor.html())?(this.selection.get(),this.range.collapse(!0),this.range.setStartAfter(e[0]),this.range.setEnd(e[0],0),this.selection.addRange()):(this.selection.get(),this.range.selectNodeContents(e[0]),this.range.collapse(!1),this.selection.addRange()))},isFocused:function(){return this.$editor[0]===document.activeElement}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(t){var i=t.closest("a",this.$editor[0]);if(this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",e.proxy(function(){this.image.remove(t)},this)),this.image.buttonSave.on("click",e.proxy(function(){this.image.update(t)},this)),e(".redactor-link-tooltip").remove(),e("#redactor-image-title").val(t.attr("alt")),this.opts.imageLink){var r=e("#redactor-image-link");r.attr("href",t.attr("src")),0!==i.length&&(r.val(i.attr("href")),"_blank"==i.attr("target")&&e("#redactor-image-link-blank").prop("checked",!0))}else e(".redactor-image-link-option").hide();if(this.opts.imagePosition){var s="block"==t.css("display")&&"none"==t.css("float")?"center":t.css("float");e("#redactor-image-align").val(s)}else e(".redactor-image-position-option").hide();this.modal.show(),e("#redactor-image-title").focus()},setFloating:function(t){var i=e("#redactor-image-align").val(),r="",s="",a="";switch(i){case"left":r="left",a="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":r="right",a="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":s="block",a="auto"}t.css({"float":r,display:s,margin:a}),t.attr("rel",t.attr("style"))},update:function(t){this.image.hideResize(),this.buffer.set();var i=t.closest("a",this.$editor[0]),r=e("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");t.attr("alt",r),this.image.setFloating(t);var s=e.trim(e("#redactor-image-link").val()),s=s.replace(/(<([^>]+)>)/gi,"");if(""!==s){var a="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",n=new RegExp("^(http|ftp|https)://"+a,"i"),o=new RegExp("^"+a,"i");-1==s.search(n)&&0===s.search(o)&&this.opts.linkProtocol&&(s=this.opts.linkProtocol+"://"+s);var l=e("#redactor-image-link-blank").prop("checked")?!0:!1;if(0===i.length){var c=e('<a href="'+s+'">'+this.utils.getOuterHtml(t)+"</a>");l&&c.attr("target","_blank"),t.replaceWith(c)}else i.attr("href",s),l?i.attr("target","_blank"):i.removeAttr("target")}else 0!==i.length&&i.replaceWith(this.utils.getOuterHtml(t));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(t){this.opts.imageEditable&&t.on("dragstart",e.proxy(this.image.onDrag,this));var i=e.proxy(function(i){this.observe.image=t,this.image.resizer=this.image.loadEditableControls(t),e(document).on("mousedown.redactor-image-resize-hide."+this.uuid,e.proxy(this.image.hideResize,this)),this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",e.proxy(function(e){this.image.setResizable(e,t)},this))},this);t.off("mousedown.redactor").on("mousedown.redactor",e.proxy(this.image.hideResize,this)),t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",i)},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},e=e.originalEvent||e,e.targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){e(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",e.proxy(this.image.moveResize,this)),e(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",e.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;t+=e.targetTouches?e.targetTouches[0].pageY-this.image.resizeHandle.y:e.pageY-this.image.resizeHandle.y;var i=Math.round(t*this.image.resizeHandle.ratio);if(!(50>t||100>i)){var t=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:i,height:t}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(t),this.code.sync()}},stopResize:function(){this.handle=!1,e(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(t){return 0!==this.$editor.find("#redactor-image-box").length?(t.preventDefault(),!1):void this.$editor.on("drop.redactor-image-inside-drop",e.proxy(function(){setTimeout(e.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var t=e(this);t.attr("src",t.attr("data-save-url")),t.removeAttr("data-save-url")})},hideResize:function(t){if(!t||0===e(t.target).closest("#redactor-image-box",this.$editor[0]).length){if(t&&"IMG"==t.target.tagName){var i=e(t.target);i.attr("data-save-url",i.attr("src"))}var r=this.$editor.find("#redactor-image-box");0!==r.length&&(e("#redactor-image-editter").remove(),e("#redactor-image-resizer").remove(),r.find("img").css({marginTop:r[0].style.marginTop,marginBottom:r[0].style.marginBottom,marginLeft:r[0].style.marginLeft,marginRight:r[0].style.marginRight}),r.css("margin",""),r.find("img").css("opacity",""),r.replaceWith(function(){return e(this).contents()}),e(document).off("mousedown.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync())}},loadResizableControls:function(t,i){if(this.opts.imageResizable&&!this.utils.isMobile()){var r=e('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||r.css({width:"15px",height:"15px"}),r.attr("contenteditable",!1),i.append(r),i.append(t),r}return i.append(t),!1},loadEditableControls:function(t){var i=e('<span id="redactor-image-box" data-redactor="verified">');if(i.css("float",t.css("float")).attr("contenteditable",!1),"auto"!=t[0].style.margin?(i.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):i.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(i),this.opts.imageEditable){this.image.editter=e('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",e.proxy(function(){this.image.showEdit(t)},this)),i.append(this.image.editter);var r=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+r/2+"px")}return this.image.loadResizableControls(t,i)},remove:function(t){var i=e(t),r=i.closest("a",this.$editor[0]),s=i.closest("figure",this.$editor[0]),a=i.parent();0!==e("#redactor-image-box").length&&(a=e("#redactor-image-box").parent());var n;0!==s.length?(n=s.next(),s.remove()):0!==r.length?(a=r.parent(),r.remove()):i.remove(),e("#redactor-image-box").remove(),0!==s.length?this.caret.setStart(n):this.caret.setStart(a),this.core.setCallback("imageDelete",i[0].src,i),this.modal.close(),this.code.sync()},insert:function(t,i,r){if("undefined"!=typeof t.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("imageUploadError",t);var s;"string"==typeof t?s=e(t).attr("data-redactor-inserted-image","true"):(s=e("<img>"),s.attr("src",t.filelink).attr("data-redactor-inserted-image","true"));var a=s,n=this.utils.isCurrentOrParent("P");if(n&&(a=e("<blockquote />").append(s)),i){this.selection.removeMarkers();var o=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,o)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(a),!1);var l=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");n?l.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||l.before("<br>"),l.after("<br>")),"string"!=typeof t&&this.core.setCallback("imageUpload",l,t)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.increaseLists():e===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){if("TD"!==t.tagName&&"TH"!==t.tagName){var i=this.utils.getAlignmentElement(t),r=this.utils.normalize(i.css("margin-left"))+this.opts.indentValue;i.css("margin-left",r+"px")}},this))},increaseText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor"),e(t).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var t=this.selection.getCurrent(),i=e(t).closest("li",this.$editor[0]);this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==i.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(e.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){var i=this.utils.getAlignmentElement(t),r=this.utils.normalize(i.css("margin-left"))-this.opts.indentValue;0>=r?this.opts.linebreaks&&"undefined"!=typeof i.data("tagblock")?i.replaceWith(i.html()+"<br />"):(i.css("margin-left",""),this.utils.removeEmptyAttr(i,"style")):i.css("margin-left",r+"px")},this))},fixEmptyIndent:function(){var t=this.selection.getBlock();if(this.range.collapsed&&t&&"LI"==t.tagName&&this.utils.isEmpty(e(t).text())){var i=e(t);i.find("span").not(".redactor-selection-marker").contents().unwrap(),i.append("<br>")}}}},inline:function(){return{formatting:function(e){var t,i;"undefined"!=typeof this.formatting[e].style?t="style":"undefined"!=typeof this.formatting[e]["class"]&&(t="class"),t&&(i=this.formatting[e][t]),this.inline.format(this.formatting[e].tag,t,i)},format:function(t,i,r){var s=this.selection.getCurrent();if(!(s&&"TR"===s.tagName||this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader())){for(var a=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],n=["strong","strong","em","em","u","del","del","sup","sub"],o=0;o<a.length;o++)t==a[o]&&(t=n[o]);if(this.opts.allowedTags){if(-1==e.inArray(t,this.opts.allowedTags))return}else if(-1!==e.inArray(t,this.opts.deniedTags))return;this.inline.type=i||!1,this.inline.value=r||!1,this.buffer.set(),this.utils.browser("msie")||this.opts.linebreaks||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(t):this.inline.formatMultiple(t)}},formatCollapsed:function(t){var i=this.selection.getCurrent(),r=e(i).closest(t+"[data-redactor-tag="+t+"]",this.$editor[0]);if(0!==r.length&&"style"!=this.inline.type&&"SPAN"!=r[0].tagName)return void(this.utils.isEmpty(r.text())?(this.caret.setAfter(r[0]),r.remove(),this.code.sync()):this.utils.isEndOfElement(r)&&this.caret.setAfter(r[0]));var s=e("<"+t+">").attr("data-verified","redactor").attr("data-redactor-tag",t);s.html(this.opts.invisibleSpace),s=this.inline.setFormat(s);var s=this.insert.node(s);this.caret.setEnd(s),this.code.sync()},formatMultiple:function(t){if(this.inline.formatConvert(t),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(e.proxy(function(i,r){var s=e(r);this.inline.formatRemoveSameChildren(s,t);var a;this.inline.type?(a=e("<span>").attr("data-redactor-tag",t).attr("data-verified","redactor"),a=this.inline.setFormat(a)):a=e("<"+t+">").attr("data-redactor-tag",t).attr("data-verified","redactor"),s.replaceWith(a.html(s.contents()));var n=a.parent();if("A"===a[0].tagName&&n&&"U"===n[0].tagName&&a.parent().replaceWith(a),"span"==t&&n&&"SPAN"===n[0].tagName&&"style"===this.inline.type)for(var o=this.inline.value.split(";"),l=0;l<o.length;l++){if(""===o[l])return;var c=o[l].split(":");n.css(c[0],""),this.utils.removeEmptyAttr(n,"style")&&n.replaceWith(n.contents())}},this)),"span"!=t&&this.$editor.find(this.opts.inlineTags.join(", ")).each(e.proxy(function(t,i){var r=e(i);if("U"===i.tagName&&0===i.attributes.length)return void r.replaceWith(r.contents());var s=r.css("text-decoration");"line-through"===s&&(r.css("text-decoration",""),this.utils.removeEmptyAttr(r,"style"))},this)),"del"!=t){var i=this;this.$editor.find("inline").each(function(e,t){i.utils.replaceToTag(t,"del")})}if("u"!=t){var i=this;this.$editor.find("unline").each(function(e,t){i.utils.replaceToTag(t,"u")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(t,i){var r=this;t.children(i).each(function(){var t=e(this);if(!t.hasClass("redactor-selection-marker"))if("style"==r.inline.type)for(var i=r.inline.value.split(";"),s=0;s<i.length;s++){if(""===i[s])return;var a=i[s].split(":");t.css(a[0],""),r.utils.removeEmptyAttr(t,"style")&&t.replaceWith(t.contents())}else t.contents().unwrap()})},formatConvert:function(t){this.selection.save();var i="";"class"==this.inline.type?i="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(i='[data-redactor-style="'+this.inline.value+'"]');var r=this;"del"!=t&&this.$editor.find("del").each(function(e,t){r.utils.replaceToTag(t,"inline")}),"u"!=t&&this.$editor.find("u").each(function(e,t){r.utils.replaceToTag(t,"unline")}),"span"!=t&&this.$editor.find(t).each(function(){var t=e(this);t.replaceWith(e("<strike />").html(t.contents()))}),this.$editor.find('[data-redactor-tag="'+t+'"]'+i).each(function(){if(""!==i||"span"!=t||this.tagName.toLowerCase()!=t){var r=e(this);r.replaceWith(e("<strike />").html(r.contents()))}}),this.selection.restore()},setFormat:function(e){switch(this.inline.type){case"class":e.hasClass(this.inline.value)?(e.removeClass(this.inline.value),e.removeAttr("data-redactor-class")):(e.addClass(this.inline.value),e.attr("data-redactor-class",this.inline.value));break;case"style":e[0].style.cssText=this.inline.value,e.attr("data-redactor-style",this.inline.value)}return e},removeStyle:function(){this.buffer.set();var t=this.selection.getCurrent(),i=this.selection.getInlines();if(this.selection.save(),t&&"SPAN"===t.tagName){var r=e(t);r.removeAttr("style"),0===r[0].attributes.length&&r.replaceWith(r.contents())}e.each(i,e.proxy(function(t,i){var r=e(i);-1==e.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)||r.hasClass("redactor-selection-marker")||(r.removeAttr("style"),0===r[0].attributes.length&&r.replaceWith(r.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(t){this.buffer.set();var i=this.selection.getParent(),r=this.selection.getInlines();if(this.selection.save(),i&&"SPAN"===i.tagName){var s=e(i);s.css(t,""),this.utils.removeEmptyAttr(s,"style"),0===s[0].attributes.length&&s.replaceWith(s.contents())}e.each(r,e.proxy(function(i,r){var s=e(r);-1==e.inArray(r.tagName.toLowerCase(),this.opts.inlineTags)||s.hasClass("redactor-selection-marker")||(s.css(t,""),this.utils.removeEmptyAttr(s,"style"),0===s[0].attributes.length&&s.replaceWith(s.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var t=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),t&&"SPAN"===t.tagName&&e(t).replaceWith(e(t).contents()),e.each(this.selection.getNodes(),e.proxy(function(t,i){var r=e(i);-1==e.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)||r.hasClass("redactor-selection-marker")||r.replaceWith(r.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(e){this.inline.format("span","class",e)},toggleStyle:function(e){this.inline.format("span","style",e)}}},insert:function(){return{set:function(t,i){this.placeholder.remove(),t=this.clean.setVerified(t),"undefined"==typeof i&&(t=this.clean.onPaste(t,!1)),this.$editor.html(t),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),"undefined"==typeof i&&setTimeout(e.proxy(this.clean.clearUnverified,this),10)},text:function(t){if(this.placeholder.remove(),t=t.toString(),t=e.trim(t),t=this.clean.getPlainText(t,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(t);else{this.selection.get(),this.range.deleteContents();var i=document.createElement("div");i.innerHTML=t;for(var r,s,a=document.createDocumentFragment();r=i.firstChild;)s=a.appendChild(r);if(this.range.insertNode(a),s){var n=this.range.cloneRange();n.setStartAfter(s),n.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(n)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(e){this.insert.html(e,!1)},html:function(t,i){this.placeholder.remove(),"undefined"==typeof i&&(i=!0),this.opts.linebreaks||this.$editor.focus(),t=this.clean.setVerified(t),i&&(t=this.clean.onPaste(t)),this.utils.browser("msie")?this.insert.htmlIe(t):(this.clean.singleLine?this.insert.execHtml(t):document.execCommand("insertHTML",!1,t),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(e.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),i&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var t=e(this.selection.getBlock()).next();t.length>0&&"P"==t[0].tagName&&""===t.html()&&t.remove()}},htmlIe:function(t){if(this.utils.isIe11()){var i=this.utils.isCurrentOrParent("P"),r=e("<div>").append(t),s=r.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return void(i&&s?this.insert.ie11FixInserting(i,t):this.insert.ie11PasteFrag(t))}document.selection.createRange().pasteHTML(t)},execHtml:function(e){e=this.clean.setVerified(e),this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,r,s=document.createDocumentFragment();i=t.firstChild;)r=s.appendChild(i);this.range.insertNode(s),this.range.collapse(!0),this.caret.setAfter(r)},node:function(t,i){t=t[0]||t;var r=this.caret.getOffset(),s=this.utils.getOuterHtml(t);return s=this.clean.setVerified(s),null!==s.match(/</g)&&(t=e(s)[0]),this.selection.get(),i!==!1&&this.range.deleteContents(),this.range.insertNode(t),this.range.collapse(!1),this.selection.addRange(),this.caret.setOffset(r),t},nodeToPoint:function(e,t,i){e=e[0]||e,this.selection.get();var r;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(t,i);this.range.setStart(s.offsetNode,s.offset),this.range.collapse(!0),this.range.insertNode(e)}else if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(t,i),r.insertNode(e);else if("undefined"!=typeof document.body.createTextRange){r=document.body.createTextRange(),r.moveToPoint(t,i);var a=r.duplicate();a.moveToPoint(t,i),r.setEndPoint("EndToEnd",a),r.select()}},nodeToCaretPositionFromPoint:function(e,t){t=t[0]||t;var i,r=e.clientX,s=e.clientY;if(document.caretPositionFromPoint){var a=document.caretPositionFromPoint(r,s),n=document.getSelection();i=n.getRangeAt(0),i.setStart(a.offsetNode,a.offset),i.collapse(!0),i.insertNode(t)}else if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(r,s),i.insertNode(t);else if("undefined"!=typeof document.body.createTextRange){i=document.body.createTextRange(),i.moveToPoint(r,s);var o=i.duplicate();o.moveToPoint(r,s),i.setEndPoint("EndToEnd",o),i.select()}},ie11FixInserting:function(t,i){var r=document.createElement("span");r.className="redactor-ie-paste",this.insert.node(r);var s=e(t).html();s="<p>"+s.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+i+"<p>")+"</p>",s=s.replace(/<p><\/p>/gi,""),e(t).replaceWith(s)},ie11PasteFrag:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,r,s=document.createDocumentFragment();i=t.firstChild;)r=s.appendChild(i);this.range.insertNode(s),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(t){if(!this.rtePaste){var i=t.which,r=i>=37&&40>=i;this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(t,i),this.utils.isDesktop()&&(this.keydown.checkEvents(r,i),this.keydown.setupBuffer(t,i)),this.keydown.addArrowsEvent(r),this.keydown.setupSelectAll(t,i);var s=this.core.setCallback("keydown",t);if(s===!1)return t.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(i===this.keyCode.DOWN||i===this.keyCode.RIGHT)){var a=!1,n=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(n=e(this.keydown.block).closest("table",this.$editor[0])),n&&n.find("td").last()[0]===this.keydown.block&&(a=!0),this.utils.isEndOfElement()&&a){var o=e(this.opts.emptyHtml);n.after(o),this.caret.setStart(o)}}if(this.opts.enterKey&&i===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&i===this.keyCode.ENTER)return t.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(i==this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){var l=this.core.setCallback("enter",t);if(l===!1)return t.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(t)===!0)return!1;var c,d;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return c=this.selection.getCurrent(),d=e(c).next(),0!==d.length&&"BR"==d[0].tagName?this.keydown.insertBreakLine(t):this.utils.isEndOfElement()&&c&&"SPAN"!=c?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&!this.keydown.block)return c=this.selection.getCurrent(),d=e(this.keydown.current).next(),0!==d.length&&"BR"==d[0].tagName?this.keydown.insertBreakLine(t):c!==!1&&e(c).hasClass("redactor-invisible-space")?(this.caret.setAfter(c),e(c).contents().unwrap(),this.keydown.insertDblBreakLine(t)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(t):0===d.length&&c===!1&&"undefined"!=typeof d.context?this.keydown.insertBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&this.keydown.block)setTimeout(e.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block){if(setTimeout(e.proxy(this.keydown.replaceDivToParagraph,this),1),"LI"===this.keydown.block.tagName){c=this.selection.getCurrent();var h=e(c).closest("li",this.$editor[0]),u=h.closest("ul,ol",this.$editor[0]);if(0!==h.length&&this.utils.isEmpty(h.html())&&0===u.next().length&&this.utils.isEmpty(u.find("li").last().html())){u.find("li").last().remove();var o=e(this.opts.emptyHtml);return u.after(o),this.caret.setStart(o),!1}}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(t)}if(i===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return this.keydown.onShiftEnter(t);if(i===this.keyCode.TAB||t.metaKey&&221===i||t.metaKey&&219===i)return this.keydown.onTab(t,i);if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){var p=this.selection.getNodes();if(p)for(var f,m=p.length,g=0;m>g;g++){var v=e(p[g]).children("img");if(0!==v.length){var b=this;e.each(v,function(t,i){var r=e(i);"none"==r.css("float")&&(b.core.setCallback("imageDelete",i.src,r),f=i)})}else"IMG"==p[g].tagName&&f!=p[g]&&(this.core.setCallback("imageDelete",p[g].src,e(p[g])),f=p[g])}}if(i===this.keyCode.BACKSPACE){var k=this.selection.getBlock(),y="0px"!==e(k).css("margin-left");if(k&&y&&this.range.collapsed&&this.utils.isStartOfElement())return this.indent.decrease(),void t.preventDefault();if(this.utils.browser("mozilla")){var x=this.selection.getPrev(),w=e(x).prev()[0];x&&"HR"===x.tagName&&e(x).remove(),w&&"HR"===w.tagName&&e(w).remove()}this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}this.code.sync()}},checkEvents:function(e,t){e||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(t){var i=this.keyCode,r=[i.BACKSPACE,i.DELETE,i.ENTER,i.ESC,i.TAB,i.CTRL,i.META,i.ALT,i.SHIFT];return-1==e.inArray(t,r)?!0:!1},addArrowsEvent:function(e){return e?"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow"):void 0},setupBuffer:function(e,t){return this.keydown.ctrl&&90===t&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length?(e.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===t&&e.shiftKey&&!e.altKey&&0!==this.opts.rebuffer.length?(e.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||(t==this.keyCode.BACKSPACE||t==this.keyCode.DELETE||t==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey)&&this.buffer.set())},setupSelectAll:function(e,t){this.keydown.ctrl&&65===t?this.utils.enableSelectAll():t==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onShiftEnter:function(e){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e)},onTab:function(e,t){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;e.preventDefault();var i;return this.keydown.pre&&!e.shiftKey?(i=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	"),this.insert.node(i),this.code.sync()):this.opts.tabAsSpaces!==!1?(i=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(i),this.code.sync()):e.metaKey&&219===t?this.indent.decrease():e.metaKey&&221===t?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var t=this.selection.getBlock(),i=t.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===t.tagName||"P"===t.tagName)&&""===i&&!e(t).hasClass("redactor-editor")){var r=document.createElement("br");return e(t).replaceWith(r),this.caret.setBefore(r),this.code.sync(),!1}},replaceDivToParagraph:function(){var t=this.selection.getBlock(),i=t.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===t.tagName&&this.utils.isEmpty(i)&&!e(t).hasClass("redactor-editor")){var r=document.createElement("p");return r.innerHTML=this.opts.invisibleSpace,e(t).replaceWith(r),this.caret.setStart(r),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&"P"==t.tagName&&e(t).removeAttr("class").removeAttr("style")},insertParagraph:function(e){e.preventDefault(),this.selection.get();var t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(t),this.caret.setStart(t),this.code.sync(),!1},exitFromBlockquote:function(t){if(this.utils.isEndOfElement()){var i=e.trim(e(this.keydown.block).html());if(-1!=i.search(/(<br\s?\/?>){2}$/i)){if(t.preventDefault(),this.opts.linebreaks){var r=document.createElement("br");e(this.keydown.blockquote).after(r),this.caret.setBefore(r),e(this.keydown.block).html(i.replace(/<br\s?\/?>$/i,""))}else{var s=e(this.opts.emptyHtml);e(this.keydown.blockquote).after(s),this.caret.setStart(s)}return!0}}},insertAfterLastElement:function(t){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var i=e("<div>").append(e.trim(this.$editor.html())).contents(),r=i.last()[0];if("SPAN"==r.tagName&&""===r.innerHTML&&(r=i.prev()[0]),this.utils.getOuterHtml(r)!=this.utils.getOuterHtml(t))return;var s=document.createElement("br");e(t).after(s),this.caret.setAfter(s)}else{if(this.$editor.contents().last()[0]!==t)return;var a=e(this.opts.emptyHtml);e(t).after(a),this.caret.setStart(a)}},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(t),this.caret.setAfter(t),this.code.sync(),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(t,i){t.stopPropagation(),this.selection.get();var r=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(r);var s=e(r).parent("a");if(s.length>0&&(s.find(r).remove(),s.after(r)),i===!0){var a=e(r).next();if(0!==a.length&&"BR"===a[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(r),this.code.sync(),!1;var n=document.createElement("br");this.range.insertNode(n),this.caret.setAfter(n)}else if(this.utils.browser("msie")){var o=document.createElement("span");
o.innerHTML="&#x200b;",e(r).after(o),this.range.setStartAfter(o),this.range.setEndAfter(o),e(o).remove()}else{var l=document.createRange();l.setStartAfter(r),l.collapse(!0);var c=window.getSelection();c.removeAllRanges(),c.addRange(l)}return this.code.sync(),!1},removeInvisibleSpace:function(){var t=e(this.keydown.current);0===t.text().search(/^\u200B$/g)&&t.remove()},removeEmptyListInTable:function(t){var i=e(this.keydown.current),r=e(this.keydown.parent),s=i.closest("td",this.$editor[0]);if(0!==s.length&&i.closest("li",this.$editor[0])&&1===r.children("li").length){if(!this.utils.isEmpty(i.text()))return;t.preventDefault(),i.remove(),r.remove(),this.caret.setStart(s)}}}},keyup:function(){return{init:function(t){if(!this.rtePaste){var i=t.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var r=this.utils.isRedactorParent(e(this.keyup.parent).parent()),s=this.core.setCallback("keyup",t);if(s===!1)return t.preventDefault(),!1;if(!this.opts.linebreaks&&3===this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!e(this.keyup.parent).hasClass("redactor-invisible-space")||r!==!1&&"BODY"!=r[0].tagName||(e(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(i)&&this.linkify.format(),i===this.keyCode.DELETE||i===this.keyCode.BACKSPACE){if(this.utils.browser("mozilla")){var a=e(this.keydown.current).closest("td",this.$editor[0]);if(0!==a.size()&&""!==a.text())return t.preventDefault(),!1}return this.clean.clearUnverified(),this.observe.image?(t.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(e.proxy(function(t,i){this.utils.removeEmpty(t,e(i).html())},this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(e(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),e(this.keyup.current).remove()),this.keyup.removeEmptyLists(),this.keyup.formatEmpty(t))}}},replaceToParagraph:function(t){var i,r=e(this.keyup.current);i=t===!1?e("<p>").append(r.html()):e("<p>").append(r.clone()),r.replaceWith(i);var s=e(i).next();"undefined"!=typeof s[0]&&"BR"==s[0].tagName&&s.remove(),this.caret.setEnd(i)},removeEmptyLists:function(){var t=function(){var t=e.trim(this.innerHTML).replace(/\/t\/n/g,"");""===t&&e(this).remove()};this.$editor.find("li").each(t),this.$editor.find("ul, ol").each(t)},formatEmpty:function(t){var i=e.trim(this.$editor.html());if(this.utils.isEmpty(i))return t.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(this.$editor.html(this.opts.emptyHtml),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return"undefined"!=typeof this.opts.curLang[e]?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set();var e=this.selection.getBlocks();return e[0]!==!1&&this.line.isExceptLastOrFirst(e)?void(this.utils.browser("msie")||this.$editor.focus()):void(this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers())},isExceptLastOrFirst:function(t){var i=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],r=t[0].tagName.toLowerCase(),s=this.selection.getLastBlock();s="undefined"==typeof s?r:s.tagName.toLowerCase();var a=-1!=e.inArray(r,i),n=-1!=e.inArray(s,i);return a&&n||a?!0:void 0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var e='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(e='<br id="redactor-insert-line">'),document.execCommand("insertHtml",!1,"<hr>"+e),this.line.setFocus(),this.code.sync()},setFocus:function(){var t=this.$editor.find("#redactor-insert-line"),i=e(t).next()[0],r=i;this.utils.browser("mozilla")&&i&&""===i.innerHTML&&(r=e(i).next()[0],e(i).remove()),r?(t.remove(),this.opts.linebreaks||(this.$editor.focus(),this.line.setStart(r))):(t.removeAttr("id"),this.line.setStart(t[0]))},setStart:function(e){if("undefined"!=typeof e){var t=document.createTextNode("​");this.selection.get(),this.range.setStart(e,0),this.range.insertNode(t),this.range.collapse(!0),this.selection.addRange()}}}},link:function(){return{show:function(t){"undefined"!=typeof t&&t.preventDefault&&t.preventDefault(),this.observe.isCurrent("a")?this.modal.load("link",this.lang.get("link_edit"),600):this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton();var i=this.observe.isCurrent("a")?this.lang.get("edit"):this.lang.get("insert");this.link.buttonInsert=this.modal.createActionButton(i),this.selection.get(),this.link.getData(),this.link.cleanUrl(),"_blank"==this.link.target&&e("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=e("#redactor-link-url"),this.link.$inputText=e("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",e.proxy(this.link.insert,this)),e(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var e=self.location.href.replace(/\/$/i,"");if("undefined"!=typeof this.link.url&&(this.link.url=this.link.url.replace(e,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),!this.opts.linkProtocol)){var t=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(t,"")}},getData:function(){this.link.$node=!1;var t=e(this.selection.getCurrent()).closest("a",this.$editor[0]);0!==t.length&&"A"===t[0].tagName?(this.link.$node=t,this.link.url=t.attr("href"),this.link.text=t.text(),this.link.target=t.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){this.placeholder.remove();var t="",i=this.link.$inputUrl.val(),r=this.link.$inputText.val().replace(/(<([^>]+)>)/gi,"");if(""===e.trim(i))return void this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){e(this).removeClass("redactor-input-error"),e(this).off("keyup")});if(-1!=i.search("@")&&/(http|ftp|https):\/\//i.test(i)===!1)i=i.replace("mailto:",""),i="mailto:"+i;else if(0!==i.search("#")){e("#redactor-link-blank").prop("checked")&&(t="_blank");var s="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",a=new RegExp("^(http|ftp|https)://"+s,"i"),n=new RegExp("^"+s,"i"),o=new RegExp(".(html|php)$","i");-1==i.search(a)&&-1==i.search(o)&&0===i.search(n)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+"://"+i)}this.link.set(r,i,t),this.modal.close()},set:function(t,i,r){t=e.trim(t.replace(/<|>/g,"")),this.selection.restore();var s=this.selection.getBlocks();if(""!==t||""!==i){if(""===t&&""!==i&&(t=i),this.link.$node){this.buffer.set();var a=this.link.$node,n=a.children();if(n.length>0){for(;n.length;)n=n.children();n=n.end()}else n=a;a.attr("href",i),n.text(t),""!==r?a.attr("target",r):a.removeAttr("target"),this.selection.selectElement(a),this.code.sync()}else{if(this.utils.browser("mozilla")&&""===this.link.text){var o=e("<a />").attr("href",i).text(t);""!==r&&o.attr("target",r),o=e(this.insert.node(o)),this.opts.linebreaks&&o.after("&nbsp;"),this.selection.selectElement(o)}else{var o;this.utils.browser("msie")?(o=e('<a href="'+i+'">').text(t),""!==r&&o.attr("target",r),o=e(this.insert.node(o)),this.selection.getText().match(/\s$/)&&o.after(" "),this.selection.selectElement(o)):(document.execCommand("createLink",!1,i),o=e(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(o=e('a[_moz_dirty=""]')),""!==r&&o.attr("target",r),o.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&o.after(" "),(""!==this.link.text||this.link.text!=t)&&(!this.opts.linebreaks&&s&&s.length<=1?o.text(t):this.opts.linebreaks&&o.text(t),this.selection.selectElement(o)))}this.code.sync(),this.core.setCallback("insertedLink",o)}setTimeout(e.proxy(function(){this.observe.links()},this),5)}},unlink:function(t){"undefined"!=typeof t&&t.preventDefault&&t.preventDefault();var i=this.selection.getNodes();if(i){this.buffer.set();for(var r=i.length,s=[],a=0;r>a;a++){"A"===i[a].tagName&&s.push(i[a]);var n=e(i[a]).closest("a",this.$editor[0]);n.replaceWith(n.contents())}this.core.setCallback("deletedLink",s),e(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(e){this.link.setClass(e,"toggleClass")},addClass:function(e){this.link.setClass(e,"addClass")},removeClass:function(e){this.link.setClass(e,"removeClass")},setClass:function(t,i){var r=this.selection.getInlinesTags(["a"]);r!==!1&&e.each(r,function(){e(this)[i](t)})}}},linkify:function(){return{isKey:function(e){return e==this.keyCode.ENTER||e==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var t=this.linkify,i=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return 3===this.nodeType&&""!=e.trim(this.nodeValue)&&!e(this).parent().is("pre")&&(this.nodeValue.match(i.linkify.regexps.youtube)||this.nodeValue.match(i.linkify.regexps.vimeo)||this.nodeValue.match(i.linkify.regexps.image)||this.nodeValue.match(i.linkify.regexps.url))}).each(function(){var r=e(this).text(),s=r;i.convertVideoLinks&&(s.match(i.linkify.regexps.youtube)||s.match(i.linkify.regexps.vimeo))?s=t.convertVideoLinks(s):i.convertImageLinks&&s.match(i.linkify.regexps.image)?s=t.convertImages(s):i.convertUrlLinks&&(s=t.convertLinks(s)),e(this).before(r.replace(r,s)).remove()});var r=this.$editor.find(".redactor-linkify-object").each(function(){var t=e(this);return t.removeClass("redactor-linkify-object"),""===t.attr("class")&&t.removeAttr("class"),t[0]});setTimeout(e.proxy(function(){this.observe.load(),this.core.setCallback("linkify",r)},this),100),this.code.sync()},convertVideoLinks:function(e){var t='<iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe>';return e.match(this.opts.linkify.regexps.youtube)&&(e=e.replace(this.opts.linkify.regexps.youtube,t+"//www.youtube.com/embed/$1"+i)),e.match(this.opts.linkify.regexps.vimeo)&&(e=e.replace(this.opts.linkify.regexps.vimeo,t+"//player.vimeo.com/video/$2"+i)),e},convertImages:function(e){var t=e.match(this.opts.linkify.regexps.image);return t&&(e=e.replace(e,'<img src="'+t+'" class="redactor-linkify-object" />'),this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||(e="<br>"+e)),e+="<br>"),e},convertLinks:function(t){var i=t.match(this.opts.linkify.regexps.url);if(i){i=e.grep(i,function(t,r){return e.inArray(t,i)===r});for(var r=i.length,s=0;r>s;s++){var a=i[s],n=a,o=this.opts.linkProtocol+"://";null!==a.match(/(https?|ftp):\/\//i)&&(o=""),n.length>this.opts.linkSize&&(n=n.substring(0,this.opts.linkSize)+"..."),-1===n.search("%")&&(n=decodeURIComponent(n));var l="\\b";-1!=e.inArray(a.slice(-1),["/","&","="])&&(l="");var c=new RegExp("("+a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")","g");t=t.replace(c,'<a href="'+o+e.trim(a)+'" class="redactor-linkify-object">'+e.trim(n)+"</a>")}}return t}}},list:function(){return{toggle:function(t){this.placeholder.remove(),this.utils.browser("msie")||this.opts.linebreaks||this.$editor.focus(),this.buffer.set(),this.selection.save();var i=this.selection.getParent(),r=e(i).closest("ol, ul",this.$editor[0]);this.utils.isRedactorParent(r)||0===r.length||(r=!1);var s,a,n=!1;if(r&&r.length){n=!0;var o=r[0].tagName;s="orderedlist"===t&&"UL"===o,a="unorderedlist"===t&&"OL"===o}s?this.utils.replaceToTag(r,"ol"):a?this.utils.replaceToTag(r,"ul"):n?this.list.remove(t,r):this.list.insert(t),this.selection.restore(),this.code.sync()},insert:function(t){var i=this.selection.getCurrent(),r=e(i).closest("td, th",this.$editor[0]);this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(t):document.execCommand("insert"+t);var s=this.selection.getParent(),a=e(s).closest("ol, ul",this.$editor[0]);if(0!==r.length){var n=r.clone();r.after(n).remove("")}if(this.utils.isEmpty(a.find("li").text())){var o=a.children("li");o.find("br").remove(),o.append(this.selection.getMarkerAsHtml()),this.opts.linebreaks&&this.utils.browser("mozilla")&&2==o.size()&&this.utils.isEmpty(o.eq(1).text())&&o.eq(1).remove()}if(a.length){var l=a.parent();this.utils.isRedactorParent(l)&&"LI"!=l[0].tagName&&this.utils.isBlock(l[0])&&l.replaceWith(l.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(t){var i=this.selection.wrap("div"),r=e(i).html(),s=e("orderedlist"==t?"<ol>":"<ul>"),a=e("<li>");if(""===e.trim(r))a.append(this.selection.getMarkerAsHtml()),s.append(a),this.$editor.find("#selection-marker-1").replaceWith(s);else{var n=r.split(/<br\s?\/?>/gi);if(n)for(var o=0;o<n.length;o++)""!==e.trim(n[o])&&s.append(e("<li>").html(n[o]));else a.append(r),s.append(a);e(i).replaceWith(s)}},remove:function(t,i){e.inArray("ul",this.selection.getBlocks())&&(t="unorderedlist"),document.execCommand("insert"+t);var r=e(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==r.closest("li, th, td",this.$editor[0]).length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(e.proxy(this.utils.removeEmpty,this)));var s=e(this.selection.getCurrent()).closest("table",this.$editor[0]),a=s.prev();this.opts.linebreaks||0===s.length||0===a.length||"BR"!=a[0].tagName||a.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /><label class="redactor-image-link-option">'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" class="redactor-image-link-option" aria-label="'+this.lang.get("link")+'" /><label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link_new_tab")+'"> '+this.lang.get("link_new_tab")+'</label><label class="redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image_position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></section>",image:String()+'<section id="redactor-modal-image-insert"><div id="redactor-modal-image-droparea"></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-modal-file-upload-box"><label>'+this.lang.get("filename")+'</label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br><div id="redactor-modal-file-upload"></div></div></section>',link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /><label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label></section>"},e.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},createTabber:function(t){this.modal.$tabber=e("<div>").attr("id","redactor-modal-tabber"),t.prepend(this.modal.$tabber)},addTab:function(t,i,r){var s=e('<a href="#" rel="tab'+t+'">').text(i);r&&s.addClass("active");var a=this;s.on("click",function(t){t.preventDefault(),e(".redactor-tab").hide(),e(".redactor-"+e(this).attr("rel")).show(),a.modal.$tabber.find("a").removeClass("active"),e(this).addClass("active")}),this.modal.$tabber.append(s)},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody.find("section")},load:function(e,t,i){this.modal.templateName=e,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[e]&&this.modal.callbacks[e].call(this)},show:function(){this.utils.disableBodyScroll(),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.opts.highContrast&&this.$modalBox.addClass("redactor-modal-contrast"),this.$modalOverlay.show(),this.$modalBox.show(),this.$modal.attr("tabindex","-1"),this.$modal.focus(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(e.proxy(this.modal.showOnDesktop,this),0),e(window).on("resize.redactor-modal",e.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),e(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",e.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var t=this.$modal.outerHeight(),i=e(window).height(),r=e(window).width();return this.modal.width>r?void this.$modal.css({width:"96%",marginTop:i/2-t/2+"px"}):void(t>i?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:i/2-t/2+"px"}))},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){"undefined"!=typeof e.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(e){13==e.which&&(e.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var t=e("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));t.on("click",e.proxy(this.modal.close,this)),this.$modalFooter.append(t)},createDeleteButton:function(e){return this.modal.createButton(e,"delete")},createActionButton:function(e){return this.modal.createButton(e,"action")},createButton:function(t,i){var r=e("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+i+"-btn").html(t);return this.$modalFooter.append(r),r},setButtonsWidth:function(){var e=this.$modalFooter.find("button"),t=e.length;0!==t&&e.css("width",100/t+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=e('<div id="redactor-modal-box"/>').hide(),this.$modal=e('<div id="redactor-modal" role="dialog" aria-labelledby="redactor-modal-header" />'),this.$modalHeader=e('<header id="redactor-modal-header"/>'),this.$modalClose=e('<button type="button" id="redactor-modal-close" tabindex="1" aria-label="Close" />').html("&times;"),this.$modalBody=e('<div id="redactor-modal-body" />'),this.$modalFooter=e("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=e('<div id="redactor-modal-overlay">').hide(),e("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",e.proxy(this.modal.close,this)),e(document).on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",e.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),e(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),e(window).off("resize.redactor-modal")},closeHandler:function(e){e.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(t){if(t){if(!e(t.target).hasClass("redactor-modal-close-btn")&&t.target!=this.$modalClose[0]&&t.target!=this.$modalBox[0])return;t.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.utils.enableBodyScroll(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",e.proxy(function(){this.$modalBox.remove(),setTimeout(e.proxy(this.utils.restoreScroll,this),0),void 0!==t&&this.selection.restore(),e(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){if("undefined"==typeof this.opts.destroyed){if(this.utils.browser("msie")){var t=this;this.$editor.find("pre, code").on("mouseover",function(){t.$editor.attr("contenteditable",!1),e(this).attr("contenteditable",!0)}).on("mouseout",function(){t.$editor.attr("contenteditable",!0),e(this).removeAttr("contenteditable")})}this.observe.images(),this.observe.links()}},toolbar:function(e,t){this.observe.buttons(e,t),this.observe.dropdowns()},isCurrent:function(t,i){if("undefined"==typeof i)var i=e(this.selection.getCurrent());return i.is(t)||i.parents(t).length>0},dropdowns:function(){var t=e(this.selection.getCurrent());e.each(this.opts.observe.dropdowns,e.proxy(function(e,i){var r=i.observe,s=r.element,a=i.item,n="undefined"!=typeof r["in"]?r["in"]:!1,o="undefined"!=typeof r.out?r.out:!1;t.closest(s).size()>0?this.observe.setDropdownProperties(a,n,o):this.observe.setDropdownProperties(a,o,n)},this))},setDropdownProperties:function(e,t,i){i&&"undefined"!=typeof i.attr&&this.observe.setDropdownAttr(e,i.attr,!0),"undefined"!=typeof t.attr&&this.observe.setDropdownAttr(e,t.attr),"undefined"!=typeof t.title&&e.text(t.title)},setDropdownAttr:function(t,i,r){e.each(i,function(e,i){"class"==e?r?t.removeClass(i):t.addClass(i):r?t.removeAttr(e):t.attr(e,i)})},addDropdown:function(e,t,i){"undefined"!=typeof i.observe&&(i.item=e,this.opts.observe.dropdowns.push(i))},buttons:function(t,i){var r=this.selection.getCurrent(),s=this.selection.getParent();if(t!==!1?this.button.setInactiveAll():this.button.setInactiveAll(i),t===!1&&"html"!==i)return void(-1!=e.inArray(i,this.opts.activeButtons)&&this.button.toggleActive(i));e.each(this.opts.activeButtonsStates,e.proxy(function(t,i){var a=e(s).closest(t,this.$editor[0]),n=e(r).closest(t,this.$editor[0]);(0===a.length||this.utils.isRedactorParent(a))&&this.utils.isRedactorParent(n)&&(0!==a.length||0!==n.closest(t,this.$editor[0]).length)&&this.button.setActive(i)},this));var a=e(s).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(s)&&a.length){var n=""===a.css("text-align")?"left":a.css("text-align");this.button.setActive("align"+n)}},addButton:function(e,t){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},images:function(){this.$editor.find("img").each(e.proxy(function(t,i){var r=e(i);r.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()}),this.utils.browser("msie")&&r.attr("unselectable","on"),this.image.setEditable(r)},this)),e(document).on("click.redactor-image-delete."+this.uuid,e.proxy(function(e){this.observe.image=!1,"IMG"==e.target.tagName&&this.utils.isRedactorParent(e.target)&&(this.observe.image=this.observe.image&&this.observe.image==e.target?!1:e.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)),e(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(t){var i=e(t.target);if("IMG"!=i[0].tagName&&("A"!==i[0].tagName&&(i=i.closest("a",this.$editor[0])),"A"===i[0].tagName)){var r=i,s=this.observe.getTooltipPosition(r),a=e('<span class="redactor-link-tooltip"></span>'),n=r.attr("href");void 0===n&&(n=""),n.length>24&&(n=n.substring(0,24)+"...");var o=e('<a href="'+r.attr("href")+'" target="_blank" />').html(n).addClass("redactor-link-tooltip-action"),l=e('<a href="#" />').html(this.lang.get("edit")).on("click",e.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),c=e('<a href="#" />').html(this.lang.get("unlink")).on("click",e.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");a.append(o).append(" | ").append(l).append(" | ").append(c),a.css({top:s.top+parseInt(r.css("line-height"),10)+"px",left:s.left+"px"}),e(".redactor-link-tooltip").remove(),e("body").append(a)}},closeTooltip:function(t){t=t.originalEvent||t;var i=t.target,r=e(i).closest("a",this.$editor[0]);(0===r.length||"A"!==r[0].tagName||"A"===i.tagName)&&("A"===i.tagName&&this.utils.isRedactorParent(i)||e(i).hasClass("redactor-link-tooltip-action")||e(".redactor-link-tooltip").remove())}}},paragraphize:function(){return{load:function(t){return this.opts.linebreaks?t:""===t||"<p></p>"===t?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),t=this.paragraphize.getSafes(t),t=this.paragraphize.getSafesComments(t),t=this.paragraphize.replaceBreaksToNewLines(t),t=this.paragraphize.replaceBreaksToParagraphs(t),t=this.paragraphize.clear(t),t=this.paragraphize.restoreSafes(t),t=t.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),e.trim(t))},getSafes:function(t){var i=e("<div />").append(t);return i.find("blockquote p").replaceWith(function(){return e(this).append("<br />").contents()}),t=i.html(),i.find(this.opts.paragraphizeBlocks.join(", ")).each(e.proxy(function(e,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,t=t.replace(i.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),t},getSafesComments:function(t){var i=t.match(/<!--([\w\W]*?)-->/gi);return i?(e.each(i,e.proxy(function(e,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i,t=t.replace(i,"\n{replace"+this.paragraphize.z+"}")},this)),t):t},restoreSafes:function(t){return e.each(this.paragraphize.safes,function(e,i){i="undefined"!=typeof i?i.replace(/\$/g,"&#36;"):i,t=t.replace("{replace"+e+"}",i)}),t},replaceBreaksToParagraphs:function(e){var t=e.split(new RegExp("\n","g"),-1);if(e="",t)for(var i=t.length,r=0;i>r;r++){if(!t.hasOwnProperty(r))return;-1==t[r].search("{replace")?(t[r]=t[r].replace(/<p>\n\t?<\/p>/gi,""),t[r]=t[r].replace(/<p><\/p>/gi,""),""!==t[r]&&(e+="<p>"+t[r].replace(/^\n+|\n+$/g,"")+"</p>")):e+=t[r]}return e},replaceBreaksToNewLines:function(e){return e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n"),e=e.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),e=e.replace(new RegExp("\r\n","g"),"\n"),e=e.replace(new RegExp("\r","g"),"\n"),e=e.replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(e){return e=e.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),e=e.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),e=e.replace(new RegExp("<p><p ","gi"),"<p "),e=e.replace(new RegExp("<p><p>","gi"),"<p>"),e=e.replace(new RegExp("</p></p>","gi"),"</p>"),e=e.replace(new RegExp("<p>\\s?</p>","gi"),""),e=e.replace(new RegExp("\n</p>","gi"),"</p>"),e=e.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),e=e.replace(new RegExp("<p>	*</p>","gi"),"")}}},paste:function(){return{init:function(t){return this.opts.cleanOnPaste?(this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),e(window).on("scroll.redactor-freeze",e.proxy(function(){e(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout(e.proxy(function(){var t=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(t),e(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)):void setTimeout(e.proxy(this.code.sync,this),1)},createPasteBox:function(){if(this.$pasteBox=e("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie"))this.$box.append(this.$pasteBox);else{var t=e(".modal-body:visible");t.length>0?t.append(this.$pasteBox):e("body").append(this.$pasteBox)}this.$pasteBox.get(0).focus()},insert:function(t){t=this.core.setCallback("pasteBefore",t),t=this.utils.isSelectAll()?this.clean.onPaste(t,!1):this.clean.onPaste(t),t=this.core.setCallback("paste",t),this.utils.isSelectAll()?this.insert.set(t,!1):this.insert.html(t,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(e.proxy(this.clean.clearUnverified,this),10),setTimeout(e.proxy(function(){var t=this.$editor.find("span");e.each(t,function(t,i){var r=i.innerHTML.replace(/\u200B/,"");""===r&&0===i.attributes.length&&e(i).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keydown.redactor-placeholder",e.proxy(this.placeholder.toggle,this)))},toggle:function(){setTimeout(e.proxy(function(){var e=this.utils.isEmpty(this.$editor.html(),!1)?"addClass":"removeClass";this.$editor[e]("redactor-placeholder")},this),5)},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!("undefined"==typeof this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){e(document.body).append(e('<div id="redactor-progress"><span></span></div>')),e("#redactor-progress").fadeIn()},hide:function(){e("#redactor-progress").fadeOut(1500,function(){e(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var e=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(e=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(e)},getParent:function(t){return t=t||this.selection.getCurrent(),t?this.utils.isRedactorParent(e(t).parent()[0]):!1},getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlock:function(t){for(t=t||this.selection.getCurrent();t;){if(this.utils.isBlockTag(t.tagName))return e(t).hasClass("redactor-editor")?!1:t;t=t.parentNode}return!1},getInlines:function(t,i){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var r=[];t="undefined"==typeof t||t===!1?this.selection.getNodes():t;var s=this.opts.inlineTags;if(s.push("span"),"undefined"!=typeof i)for(var a=0;a<i.length;a++)s.push(i[a]);return e.each(t,e.proxy(function(t,i){-1!=e.inArray(i.tagName.toLowerCase(),s)&&r.push(i)},this)),0===r.length?!1:r},getInlinesTags:function(t){if(this.selection.get(),
this.range&&this.range.collapsed)return!1;var i=[],r=this.selection.getNodes();return e.each(r,e.proxy(function(r,s){-1!=e.inArray(s.tagName.toLowerCase(),t)&&i.push(s)},this)),0===i.length?!1:i},getBlocks:function(t){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var i=[];return t="undefined"==typeof t?this.selection.getNodes():t,e.each(t,e.proxy(function(e,t){this.utils.isBlock(t)&&i.push(t)},this)),0===i.length?[this.selection.getBlock()]:i},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var t=this.selection.getNodesMarker(1),i=this.selection.getNodesMarker(2);if(this.range.collapsed===!1){if(window.getSelection){var r=window.getSelection();if(r.rangeCount>0){var s=r.getRangeAt(0),a=s.startContainer,n=s.startOffset,o=s.cloneRange();o.collapse(!1),o.insertNode(i),o.setStart(a,n),o.collapse(!0),o.insertNode(t),s.setStartAfter(t),s.setEndBefore(i),r.removeAllRanges(),r.addRange(s)}}}else this.selection.setNodesMarker(this.range,t,!0),i=t;var l=[],c=0,d=this;this.$editor.find("*").each(function(){if(this==t){var r=e(this).parent();0!==r.length&&"BODY"!=r[0].tagName&&d.utils.isRedactorParent(r[0])&&l.push(r[0]),l.push(this),c=1}else c>0&&(l.push(this),c+=1);return this==i?!1:void 0});for(var h=[],u=l.length,p=0;u>p;p++)"nodes-marker-1"!=l[p].id&&"nodes-marker-2"!=l[p].id&&h.push(l[p]);return this.selection.removeNodesMarkers(),h},getNodesMarker:function(t){return e('<span id="nodes-marker-'+t+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(e,t,i){var e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(r){}},removeNodesMarkers:function(){e(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,t){this.caret.setOffset(e,t)},wrap:function(e){if(this.selection.get(),this.range.collapsed)return!1;var t=document.createElement(e);return t.appendChild(this.range.extractContents()),this.range.insertNode(t),t},selectElement:function(e){if(this.utils.browser("mozilla")){e=e[0]||e;var t=document.createRange();t.selectNodeContents(e)}else this.caret.set(e,0,e,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e=this.selection.getMarker(1);if(this.selection.setMarker(this.range,e,!0),this.range.collapsed===!1){var t=this.selection.getMarker(2);this.selection.setMarker(this.range,t,!1)}this.savedSel=this.$editor.html()},getMarker:function(t){return"undefined"==typeof t&&(t=1),e('<span id="selection-marker-'+t+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(e){return this.utils.getOuterHtml(this.selection.getMarker(e))},setMarker:function(e,t,i){e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(r){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");this.utils.browser("mozilla")&&this.$editor.focus(),0!==e.length&&0!==t.length?this.caret.set(e,0,t,0):0!==e.length?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(t,i){var r=e(i).text().replace(/\u200B/g,"");""===r?e(i).remove():e(i).replaceWith(function(){return e(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var e="";if(this.selection.get(),this.sel.rangeCount){for(var t=document.createElement("div"),i=this.sel.rangeCount,r=0;i>r;++r)t.appendChild(this.sel.getRangeAt(r).cloneContents());e=t.innerHTML}return this.clean.onSync(e)},replaceSelection:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i,r=document.createDocumentFragment();i=t.firstChild;)r.appendChild(i);this.range.insertNode(r)},replaceWithHtml:function(e){e=this.selection.getMarkerAsHtml(1)+e+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(e):document.selection&&document.selection.createRange&&this.range.pasteHTML(e),this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(t,i){return this.opts.shortcuts?void e.each(this.opts.shortcuts,e.proxy(function(i,r){for(var s=i.split(","),a=s.length,n=0;a>n;n++)"string"==typeof s[n]&&this.shortcuts.handler(t,e.trim(s[n]),e.proxy(function(){var e;"-1"!=r.func.search(/\./)?(e=r.func.split("."),"undefined"!=typeof this[e[0]]&&this[e[0]][e[1]].apply(this,r.params)):this[r.func].apply(this,r.params)},this))},this)):(!t.ctrlKey&&!t.metaKey||66!==i&&73!==i||t.preventDefault(),!1)},handler:function(t,i,r){var s={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};i=i.toLowerCase().split(" ");var n=s[t.keyCode],o=String.fromCharCode(t.which).toLowerCase(),l="",c={};e.each(["alt","ctrl","meta","shift"],function(e,i){t[i+"Key"]&&n!==i&&(l+=i+"+")}),n&&(c[l+n]=!0),o&&(c[l+o]=!0,c[l+a[o]]=!0,"shift+"===l&&(c[a[o]]=!0));for(var d=0,h=i.length;h>d;d++)if(c[i[d]])return t.preventDefault(),r.apply(this,arguments)}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier)return e;var t=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],i=["li","dt","dt","h[1-6]","option","script"],r=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+t.join("|/?")+"|"+i.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+t.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+r.join("|")+")[ >]");var s=0,a=e.length,n=0,o=null,l=null,c="",d="",h="";for(this.tabifier.cleanlevel=0;a>s;s++){if(n=s,-1==e.substr(s).indexOf("<"))return d+=e.substr(s),this.tabifier.finish(d);for(;a>n&&"<"!=e.charAt(n);)n++;for(s!=n&&(h=e.substr(s,n-s),h.match(/^\s{2,}$/g)||("\n"==d.charAt(d.length-1)?d+=this.tabifier.getTabs():"\n"==h.charAt(0)&&(d+="\n"+this.tabifier.getTabs(),h=h.replace(/^\s+/,"")),d+=h),h.match(/\n/)&&(d+="\n"+this.tabifier.getTabs())),o=n;a>n&&">"!=e.charAt(n);)n++;c=e.substr(o,n-o),s=n;var u;if("!--"==c.substr(1,3)){if(!c.match(/--$/)){for(;"-->"!=e.substr(n,3);)n++;n+=2,c=e.substr(o,n-o),s=n}"\n"!=d.charAt(d.length-1)&&(d+="\n"),d+=this.tabifier.getTabs(),d+=c+">\n"}else"!"==c[1]?d=this.tabifier.placeTag(c+">",d):"?"==c[1]?d+=c+">\n":(u=c.match(/^<(script|style|pre)/i))?(u[1]=u[1].toLowerCase(),c=this.tabifier.cleanTag(c),d=this.tabifier.placeTag(c,d),l=String(e.substr(s+1)).toLowerCase().indexOf("</"+u[1]),l&&(h=e.substr(s+1,l),s+=l,d+=h)):(c=this.tabifier.cleanTag(c),d=this.tabifier.placeTag(c,d))}return this.tabifier.finish(d)},getTabs:function(){for(var e="",t=0;t<this.tabifier.cleanlevel;t++)e+="	";return e},finish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var i="";e.match(/\/$/)&&(i="/",e=e.replace(/\/+$/,""));for(var r;r=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e);)r[2]?t+=r[1].toLowerCase()+"="+r[2]:r[1]&&(t+=r[1].toLowerCase()),t+=" ",e=e.substr(r[0].length);return t.replace(/\s*$/,"")+i+">"},placeTag:function(e,t){var i=e.match(this.tabifier.newLevel);return(e.match(this.tabifier.lineBefore)||i)&&(t=t.replace(/\s*$/,""),t+="\n"),i&&"/"==e.charAt(1)&&this.tabifier.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.tabifier.getTabs()),i&&"/"!=e.charAt(1)&&this.tabifier.cleanlevel++,t+=e,(e.match(this.tabifier.lineAfter)||e.match(this.tabifier.newLevel))&&(t=t.replace(/ *$/,"")),t}}},tidy:function(){return{setupAllowed:function(){var t=e.inArray("span",this.opts.removeEmpty);if(-1!==t&&this.opts.removeEmpty.splice(t,1),this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var i=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(i),this.opts.deniedTags&&this.tidy.removeFromDenied(i)}},addToAllowed:function(t){for(var i=t.length,r=0;i>r;r++)-1==e.inArray(t[r],this.opts.allowedTags)&&this.opts.allowedTags.push(t[r])},removeFromDenied:function(t){for(var i=t.length,r=0;i>r;r++){var s=e.inArray(t[r],this.opts.deniedTags);-1!=s&&this.opts.deniedTags.splice(s,1)}},load:function(t,i){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},e.extend(this.tidy.settings,i),t=this.tidy.removeComments(t),this.tidy.$div=e("<div />").append(t),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),t=this.tidy.$div.html(),this.tidy.$div.remove(),t},removeComments:function(e){return this.tidy.settings.removeComments?e.replace(/<!--[\s\S]*?-->/gi,""):e},replaceTags:function(t){if(!this.tidy.settings.replaceTags)return t;for(var i=this.tidy.settings.replaceTags.length,r=[],s=[],a=0;i>a;a++)s.push(this.tidy.settings.replaceTags[a][1]),r.push(this.tidy.settings.replaceTags[a][0]);e.each(r,e.proxy(function(t,i){this.tidy.$div.find(i).replaceWith(function(){return e("<"+s[t]+" />",{html:e(this).html()})})},this))},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var t=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(e.proxy(function(i,r){for(var s=e(r),a=s.attr("style"),n=0;t>n;n++)if(a&&a.match(new RegExp("^"+this.tidy.settings.replaceStyles[n][0],"i"))){var o=this.tidy.settings.replaceStyles[n][1];s.replaceWith(function(){var t=document.createElement(o);return e(t).append(e(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(t,i){""===i.innerHTML?e(i).remove():e(i).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(t,i){e(i).hasClass("redactor-script-tag")||e(i).hasClass("redactor-selection-marker")||(""===i.innerHTML?e(i).remove():e(i).contents().unwrap())})},removeAttr:function(){var t;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var i=[],r=[];t=this.tidy.settings.allowedAttr.length;for(var s=0;t>s;s++)i.push(this.tidy.settings.allowedAttr[s][0]),r.push(this.tidy.settings.allowedAttr[s][1]);this.tidy.$div.find("*").each(e.proxy(function(t,s){var a=e(s),n=e.inArray(a[0].tagName.toLowerCase(),i),o=this.tidy.removeAttrGetRemoves(n,r,a);o&&e.each(o,function(e,t){a.removeAttr(t)})},this))}if(this.tidy.settings.removeAttr){t=this.tidy.settings.removeAttr.length;for(var s=0;t>s;s++){var a=this.tidy.settings.removeAttr[s][1];e.isArray(a)&&(a=a.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[s][0]).removeAttr(a)}}},removeAttrGetRemoves:function(t,i,r){var s=[];return-1==t?e.each(r[0].attributes,function(e,t){s.push(t.name)}):"*"==i[t]?s=[]:e.each(r[0].attributes,function(r,a){e.isArray(i[t])?-1==e.inArray(a.name,i[t])&&s.push(a.name):i[t]!=a.name&&s.push(a.name)}),s},removeAttrs:function(t,i){return i=new RegExp(i,"g"),t.each(function(){for(var t=e(this),r=this.attributes.length-1,s=r;s>=0;s--){var a=this.attributes[s];a&&a.specified&&a.name.search(i)>=0&&t.removeAttr(a.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var t=e(this),i=t.text();i=i.replace(/\u200B/g,""),i=i.replace(/&nbsp;/gi,""),i=i.replace(/\s/g,""),""===i&&0===t.children().length&&t.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var t=this.tidy.settings.removeDataAttr;e.isArray(this.tidy.settings.removeDataAttr)&&(t=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(t),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&e(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link_edit")},out:{title:this.lang.get("link_insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",e.proxy(this.observe.toolbar,this)))},createContainer:function(){return e("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},setFormattingTags:function(){e.each(this.opts.toolbar.formatting.dropdown,e.proxy(function(t,i){-1==e.inArray(t,this.opts.formatting)&&delete this.opts.toolbar.formatting.dropdown[t]},this))},loadButtons:function(){e.each(this.opts.buttons,e.proxy(function(t,i){if(this.opts.toolbar[i]){if("file"===i){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if("image"===i){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var r=this.opts.toolbar[i];this.$toolbar.append(e("<li>").append(this.button.build(i,r)))}},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),e(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){this.utils.isDesktop()&&(this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),e(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,e.proxy(this.toolbar.observeScroll,this))))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(!this.opts.source){var e=this.opts.buttons.indexOf("html");-1!==e&&this.opts.buttons.splice(e,1)}},hideButtons:function(){0!==this.opts.buttonsHide.length&&e.each(this.opts.buttonsHide,e.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);this.opts.buttons.splice(i,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&e.each(this.opts.buttonsHideOnMobile,e.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);this.opts.buttons.splice(i,1)},this))},observeScroll:function(){var t=e(this.opts.toolbarFixedTarget).scrollTop(),i=1;this.opts.toolbarFixedTarget===document&&(i=this.$box.offset().top),t+this.opts.toolbarFixedTopOffset>i?this.toolbar.observeScrollEnable(t,i):this.toolbar.observeScrollDisable()},observeScrollEnable:function(t,i){var r=this.opts.toolbarFixedTopOffset+t-i,s=0,a=i+this.$box.height()-32,n=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:n,top:r+"px",left:s}),t>a&&e(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",a>t?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,i="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,i="absolute"),e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:i,top:t+"px"})})},unsetDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.$toolbar.offset().top;e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:"absolute",top:t+"px"})})}}},upload:function(){return{init:function(t,i,r){this.upload.direct=!1,this.upload.callback=r,this.upload.url=i,this.upload.$el=e(t),this.upload.$droparea=e('<div id="redactor-droparea" />'),this.upload.$placeholdler=e('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=e('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",e.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",e.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",e.proxy(function(e){e=e.originalEvent||e,this.upload.traverseFile(this.upload.$input[0].files[0],e)},this)),this.upload.$droparea.on("drop.redactor.upload",e.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){e=e.originalEvent||e;var t=e.dataTransfer.files;this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3)return this.upload.setConfig(e),void this.upload.s3uploadFile(e);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var r="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(r,e)}this.progress.show(),this.core.setCallback("uploadStart",t,i),this.upload.sendData(i,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"==this.upload.type?this.image.insert:this.file.insert)},getType:function(e){this.upload.type="image",-1==this.opts.imageTypes.indexOf(e.type)&&(this.upload.type="file"),null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(t,i){return t===!1||"object"!=typeof t?i:(e.each(t,e.proxy(function(t,r){null!==r&&0===r.toString().indexOf("#")&&(r=e(r).val()),i.append(t,r)},this)),i)},sendData:function(t,i){"image"==this.upload.type?(t=this.upload.getHiddenFields(this.opts.uploadImageFields,t),t=this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.upload.getHiddenFields(this.opts.uploadFileFields,t),t=this.upload.getHiddenFields(this.upload.fileFields,t));var r=new XMLHttpRequest;r.open("POST",this.upload.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=e.proxy(function(){if(4==r.readyState){var t=r.responseText;t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var s;try{s="string"==typeof t?e.parseJSON(t):t}catch(a){s={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(s,this.upload.direct,i)}},this),r.send(t)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]},s3uploadFile:function(t){this.upload.s3executeOnSignedUrl(t,e.proxy(function(e){this.upload.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(e,t){var i=new XMLHttpRequest,r="-1"!==this.opts.s3.search(/\?/)?"?":"&";i.open("GET",this.opts.s3+r+"name="+e.name+"&type="+e.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var s=this;i.onreadystatechange=function(e){4==this.readyState&&200==this.status?(s.progress.show(),t(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},i.send()},s3createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i},s3uploadToS3:function(t,i){var r=this.upload.s3createCORSRequest("PUT",i);r&&(r.onload=e.proxy(function(){if(200==r.status){this.progress.hide();var e=i.split("?");if(!e[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var t={filelink:e[0]};if("file"==this.upload.type){var s=e[0].split("/");t.filename=s[s.length-1]}this.upload.callback(t,this.upload.direct,!1)}},this),r.onerror=function(){},r.upload.onprogress=function(e){},r.setRequestHeader("Content-Type",t.type),r.setRequestHeader("x-amz-acl","public-read"),r.send(t))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isEmpty:function(t,i){return t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&nbsp;/gi,""),t=t.replace(/<\/?br\s?\/?>/g,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),t=t.replace(/<iframe(.*?[^>])>$/i,"iframe"),t=t.replace(/<source(.*?[^>])>$/i,"source"),i!==!1&&(t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),t=e.trim(t),""===t},normalize:function(e){return"undefined"==typeof e?0:parseInt(e.replace("px",""),10)},hexToRgb:function(e){if("undefined"!=typeof e){if(-1==e.search(/^#/))return e;var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,r){return t+t+i+i+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(i[1],16)+", "+parseInt(i[2],16)+", "+parseInt(i[3],16)+")"}},getOuterHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},getAlignmentElement:function(t){return-1!==e.inArray(t.tagName,this.opts.alignmentTags)?e(t):e(t).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(t,i){var r=e(t);return"undefined"==typeof r.attr(i)?!0:""===r.attr(i)?(r.removeAttr(i),!0):!1},removeEmpty:function(t,i){var r=e(e.parseHTML(i));if(r.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===r.find("hr, br, img, iframe, source").length){var s=e.trim(r.text());this.utils.isEmpty(s,!1)&&r.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=e(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=e(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){("undefined"!=typeof this.saveScroll||"undefined"!=typeof this.saveBodyScroll)&&(e(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&e(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML=this.opts.invisibleSpace,e},removeInlineTags:function(t){var i=this.opts.inlineTags;i.push("span"),"PRE"==t.tagName&&i.push("a"),e(t).find(i.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(t,i){var r=this;return e(t).replaceWith(function(){return i===!0&&r.utils.removeInlineTags(this),e(this).contents()}),e(t)},replaceToTag:function(t,i,r){var s,a=this;return e(t).replaceWith(function(){s=e("<"+i+" />").append(e(this).contents());for(var t=0;t<this.attributes.length;t++)s.attr(this.attributes[t].name,this.attributes[t].value);return r===!0&&a.utils.removeInlineTags(s),s}),s},isStartOfElement:function(){var e=this.selection.getBlock();if(!e)return!1;var t=this.caret.getOffsetOfElement(e);return 0===t?!0:!1},isEndOfElement:function(t){if("undefined"==typeof t){var t=this.selection.getBlock();if(!t)return!1}var i=this.caret.getOffsetOfElement(t),r=e.trim(e(t).text()).replace(/\n\r\n/g,"");return i==r.length?!0:!1},isStartOfEditor:function(){var e=this.caret.getOffsetOfElement(this.$editor[0]);return 0===e?!0:!1},isEndOfEditor:function(){var t=this.$editor[0],i=this.caret.getOffsetOfElement(t),r=e.trim(e(t).html().replace(/(<([^>]+)>)/gi,""));return i==r.length?!0:!1},isBlock:function(e){return e=e[0]||e,e&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return"undefined"==typeof e?!1:this.reIsBlock.test(e)},isTag:function(t,i){var r=e(t).closest(i,this.$editor[0]);return 1==r.length?r[0]:!1},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(t){return t?0===e(t).parents(".redactor-editor").length||e(t).hasClass("redactor-editor")?!1:t:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var i=this.selection.getParent(),r=this.selection.getCurrent();if(e.isArray(t)){var s=0;return e.each(t,e.proxy(function(e,t){this.utils.isCurrentOrParentOne(r,i,t)&&s++},this)),0===s?!1:!0}return this.utils.isCurrentOrParentOne(r,i,t)},isCurrentOrParentOne:function(e,t,i){return i=i.toUpperCase(),t&&t.tagName===i?t:e&&e.tagName===i?e:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var t=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"safari"==e?"undefined"!=typeof i[3]?"safari"==i[3]:!1:"version"==e?i[2]:"webkit"==e?"chrome"==i[1]||"opr"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==e:"opr"==i[1]?"webkit"==e:e==i[1]},strpos:function(e,t,i){var r=e.indexOf(t,i);return r>=0?r:!1},disableBodyScroll:function(){var t=e("html"),i=window.innerWidth;if(!i){var r=document.documentElement.getBoundingClientRect();i=r.right-Math.abs(r.left)}var s=document.body.clientWidth<i,a=this.utils.measureScrollbar();t.css("overflow","hidden"),s&&t.css("padding-right",a)},measureScrollbar:function(){var t=e("body"),i=document.createElement("div");i.className="redactor-scrollbar-measure",t.append(i);var r=i.offsetWidth-i.clientWidth;return t[0].removeChild(i),r},enableBodyScroll:function(){e("html").css({overflow:"","padding-right":""}),e("body").remove("redactor-scrollbar-measure")}}}},e(window).on("load.tools.redactor",function(){e('[data-tools="redactor"]').redactor()}),t.prototype.init.prototype=t.prototype}(jQuery);